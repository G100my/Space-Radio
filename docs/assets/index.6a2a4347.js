var e=Object.assign;import{r as t,o as n,c as r,a as i,w as o,b as a,F as s,d as u,e as l,t as c,f as h,g as p,h as d,v as f,i as y,j as m,k as v,l as g,m as _,n as b,p as w,T as C,q as T,s as S,u as E,x as k}from"./vendor.074003e4.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(n){const r=new URL(e,location),i=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((n,o)=>{const a=new URL(e,r);if(self[t].moduleMap[a])return n(self[t].moduleMap[a]);const s=new Blob([`import * as m from '${a}';`,`${t}.moduleMap['${a}']=m;`],{type:"text/javascript"}),u=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(s),onerror(){o(new Error(`Failed to import: ${e}`)),i(u)},onload(){n(self[t].moduleMap[a]),i(u)}});document.head.appendChild(u)})),self[t].moduleMap={}}}("/Space-Radio/assets/");const I={};I.render=function(e,o,a,s,u,l){const c=t("router-view");return n(),r("main",null,[i(c)])};
/*!
 * vuex v4.0.0
 * (c) 2021 Evan You
 * @license MIT
 */
var P=("undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).__VUE_DEVTOOLS_GLOBAL_HOOK__;function N(e,t){if(void 0===t&&(t=[]),null===e||"object"!=typeof e)return e;var n,r=(n=function(t){return t.original===e},t.filter(n)[0]);if(r)return r.copy;var i=Array.isArray(e)?[]:{};return t.push({original:e,copy:i}),Object.keys(e).forEach((function(n){i[n]=N(e[n],t)})),i}function D(e,t){Object.keys(e).forEach((function(n){return t(e[n],n)}))}function x(e){return null!==e&&"object"==typeof e}var R=function(e,t){this.runtime=t,this._children=Object.create(null),this._rawModule=e;var n=e.state;this.state=("function"==typeof n?n():n)||{}},A={namespaced:{configurable:!0}};A.namespaced.get=function(){return!!this._rawModule.namespaced},R.prototype.addChild=function(e,t){this._children[e]=t},R.prototype.removeChild=function(e){delete this._children[e]},R.prototype.getChild=function(e){return this._children[e]},R.prototype.hasChild=function(e){return e in this._children},R.prototype.update=function(e){this._rawModule.namespaced=e.namespaced,e.actions&&(this._rawModule.actions=e.actions),e.mutations&&(this._rawModule.mutations=e.mutations),e.getters&&(this._rawModule.getters=e.getters)},R.prototype.forEachChild=function(e){D(this._children,e)},R.prototype.forEachGetter=function(e){this._rawModule.getters&&D(this._rawModule.getters,e)},R.prototype.forEachAction=function(e){this._rawModule.actions&&D(this._rawModule.actions,e)},R.prototype.forEachMutation=function(e){this._rawModule.mutations&&D(this._rawModule.mutations,e)},Object.defineProperties(R.prototype,A);var O=function(e){this.register([],e,!1)};function L(e,t,n){if(t.update(n),n.modules)for(var r in n.modules){if(!t.getChild(r))return;L(e.concat(r),t.getChild(r),n.modules[r])}}O.prototype.get=function(e){return e.reduce((function(e,t){return e.getChild(t)}),this.root)},O.prototype.getNamespace=function(e){var t=this.root;return e.reduce((function(e,n){return e+((t=t.getChild(n)).namespaced?n+"/":"")}),"")},O.prototype.update=function(e){L([],this.root,e)},O.prototype.register=function(e,t,n){var r=this;void 0===n&&(n=!0);var i=new R(t,n);0===e.length?this.root=i:this.get(e.slice(0,-1)).addChild(e[e.length-1],i);t.modules&&D(t.modules,(function(t,i){r.register(e.concat(i),t,n)}))},O.prototype.unregister=function(e){var t=this.get(e.slice(0,-1)),n=e[e.length-1],r=t.getChild(n);r&&r.runtime&&t.removeChild(n)},O.prototype.isRegistered=function(e){var t=this.get(e.slice(0,-1)),n=e[e.length-1];return!!t&&t.hasChild(n)};var M=function(e){var t=this;void 0===e&&(e={});var n=e.plugins;void 0===n&&(n=[]);var r=e.strict;void 0===r&&(r=!1),this._committing=!1,this._actions=Object.create(null),this._actionSubscribers=[],this._mutations=Object.create(null),this._wrappedGetters=Object.create(null),this._modules=new O(e),this._modulesNamespaceMap=Object.create(null),this._subscribers=[],this._makeLocalGettersCache=Object.create(null);var i=this,o=this.dispatch,a=this.commit;this.dispatch=function(e,t){return o.call(i,e,t)},this.commit=function(e,t,n){return a.call(i,e,t,n)},this.strict=r;var s=this._modules.root.state;Q(this,s,[],this._modules.root),U(this,s),n.forEach((function(e){return e(t)})),(void 0===e.devtools||e.devtools)&&function(e){P&&(e._devtoolHook=P,P.emit("vuex:init",e),P.on("vuex:travel-to-state",(function(t){e.replaceState(t)})),e.subscribe((function(e,t){P.emit("vuex:mutation",e,t)}),{prepend:!0}),e.subscribeAction((function(e,t){P.emit("vuex:action",e,t)}),{prepend:!0}))}(this)},F={state:{configurable:!0}};function j(e,t,n){return t.indexOf(e)<0&&(n&&n.prepend?t.unshift(e):t.push(e)),function(){var n=t.indexOf(e);n>-1&&t.splice(n,1)}}function q(e,t){e._actions=Object.create(null),e._mutations=Object.create(null),e._wrappedGetters=Object.create(null),e._modulesNamespaceMap=Object.create(null);var n=e.state;Q(e,n,[],e._modules.root,!0),U(e,n,t)}function U(e,t,n){var r=e._state;e.getters={},e._makeLocalGettersCache=Object.create(null);var i=e._wrappedGetters,s={};D(i,(function(t,n){s[n]=function(e,t){return function(){return e(t)}}(t,e),Object.defineProperty(e.getters,n,{get:function(){return s[n]()},enumerable:!0})})),e._state=a({data:t}),e.strict&&function(e){o((function(){return e._state.data}),(function(){}),{deep:!0,flush:"sync"})}(e),r&&n&&e._withCommit((function(){r.data=null}))}function Q(e,t,n,r,i){var o=!n.length,a=e._modules.getNamespace(n);if(r.namespaced&&(e._modulesNamespaceMap[a],e._modulesNamespaceMap[a]=r),!o&&!i){var s=V(t,n.slice(0,-1)),u=n[n.length-1];e._withCommit((function(){s[u]=r.state}))}var l=r.context=function(e,t,n){var r=""===t,i={dispatch:r?e.dispatch:function(n,r,i){var o=W(n,r,i),a=o.payload,s=o.options,u=o.type;return s&&s.root||(u=t+u),e.dispatch(u,a)},commit:r?e.commit:function(n,r,i){var o=W(n,r,i),a=o.payload,s=o.options,u=o.type;s&&s.root||(u=t+u),e.commit(u,a,s)}};return Object.defineProperties(i,{getters:{get:r?function(){return e.getters}:function(){return function(e,t){if(!e._makeLocalGettersCache[t]){var n={},r=t.length;Object.keys(e.getters).forEach((function(i){if(i.slice(0,r)===t){var o=i.slice(r);Object.defineProperty(n,o,{get:function(){return e.getters[i]},enumerable:!0})}})),e._makeLocalGettersCache[t]=n}return e._makeLocalGettersCache[t]}(e,t)}},state:{get:function(){return V(e.state,n)}}}),i}(e,a,n);r.forEachMutation((function(t,n){!function(e,t,n,r){(e._mutations[t]||(e._mutations[t]=[])).push((function(t){n.call(e,r.state,t)}))}(e,a+n,t,l)})),r.forEachAction((function(t,n){var r=t.root?n:a+n,i=t.handler||t;!function(e,t,n,r){(e._actions[t]||(e._actions[t]=[])).push((function(t){var i,o=n.call(e,{dispatch:r.dispatch,commit:r.commit,getters:r.getters,state:r.state,rootGetters:e.getters,rootState:e.state},t);return(i=o)&&"function"==typeof i.then||(o=Promise.resolve(o)),e._devtoolHook?o.catch((function(t){throw e._devtoolHook.emit("vuex:error",t),t})):o}))}(e,r,i,l)})),r.forEachGetter((function(t,n){!function(e,t,n,r){if(e._wrappedGetters[t])return;e._wrappedGetters[t]=function(e){return n(r.state,r.getters,e.state,e.getters)}}(e,a+n,t,l)})),r.forEachChild((function(r,o){Q(e,t,n.concat(o),r,i)}))}function V(e,t){return t.reduce((function(e,t){return e[t]}),e)}function W(e,t,n){return x(e)&&e.type&&(n=t,t=e,e=e.type),{type:e,payload:t,options:n}}M.prototype.install=function(e,t){e.provide(t||"store",this),e.config.globalProperties.$store=this},F.state.get=function(){return this._state.data},F.state.set=function(e){},M.prototype.commit=function(e,t,n){var r=this,i=W(e,t,n),o=i.type,a=i.payload,s={type:o,payload:a},u=this._mutations[o];u&&(this._withCommit((function(){u.forEach((function(e){e(a)}))})),this._subscribers.slice().forEach((function(e){return e(s,r.state)})))},M.prototype.dispatch=function(e,t){var n=this,r=W(e,t),i=r.type,o=r.payload,a={type:i,payload:o},s=this._actions[i];if(s){try{this._actionSubscribers.slice().filter((function(e){return e.before})).forEach((function(e){return e.before(a,n.state)}))}catch(l){}var u=s.length>1?Promise.all(s.map((function(e){return e(o)}))):s[0](o);return new Promise((function(e,t){u.then((function(t){try{n._actionSubscribers.filter((function(e){return e.after})).forEach((function(e){return e.after(a,n.state)}))}catch(l){}e(t)}),(function(e){try{n._actionSubscribers.filter((function(e){return e.error})).forEach((function(t){return t.error(a,n.state,e)}))}catch(l){}t(e)}))}))}},M.prototype.subscribe=function(e,t){return j(e,this._subscribers,t)},M.prototype.subscribeAction=function(e,t){return j("function"==typeof e?{before:e}:e,this._actionSubscribers,t)},M.prototype.watch=function(e,t,n){var r=this;return o((function(){return e(r.state,r.getters)}),t,Object.assign({},n))},M.prototype.replaceState=function(e){var t=this;this._withCommit((function(){t._state.data=e}))},M.prototype.registerModule=function(e,t,n){void 0===n&&(n={}),"string"==typeof e&&(e=[e]),this._modules.register(e,t),Q(this,this.state,e,this._modules.get(e),n.preserveState),U(this,this.state)},M.prototype.unregisterModule=function(e){var t=this;"string"==typeof e&&(e=[e]),this._modules.unregister(e),this._withCommit((function(){delete V(t.state,e.slice(0,-1))[e[e.length-1]]})),q(this)},M.prototype.hasModule=function(e){return"string"==typeof e&&(e=[e]),this._modules.isRegistered(e)},M.prototype.hotUpdate=function(e){this._modules.update(e),q(this,!0)},M.prototype._withCommit=function(e){var t=this._committing;this._committing=!0,e(),this._committing=t},Object.defineProperties(M.prototype,F);var H=K((function(e,t){var n={};return $(t).forEach((function(t){var r=t.key,i=t.val;n[r]=function(){var t=this.$store.state,n=this.$store.getters;if(e){var r=z(this.$store,"mapState",e);if(!r)return;t=r.context.state,n=r.context.getters}return"function"==typeof i?i.call(this,t,n):t[i]},n[r].vuex=!0})),n})),B=K((function(e,t){var n={};return $(t).forEach((function(t){var r=t.key,i=t.val;i=e+i,n[r]=function(){if(!e||z(this.$store,"mapGetters",e))return this.$store.getters[i]},n[r].vuex=!0})),n}));function $(e){return function(e){return Array.isArray(e)||x(e)}(e)?Array.isArray(e)?e.map((function(e){return{key:e,val:e}})):Object.keys(e).map((function(t){return{key:t,val:e[t]}})):[]}function K(e){return function(t,n){return"string"!=typeof t?(n=t,t=""):"/"!==t.charAt(t.length-1)&&(t+="/"),e(t,n)}}function z(e,t,n){return e._modulesNamespaceMap[n]}function G(e,t,n){var r=n?e.groupCollapsed:e.group;try{r.call(e,t)}catch(i){e.log(t)}}function Y(e){try{e.groupEnd()}catch(t){e.log("—— log end ——")}}function J(){var e=new Date;return" @ "+X(e.getHours(),2)+":"+X(e.getMinutes(),2)+":"+X(e.getSeconds(),2)+"."+X(e.getMilliseconds(),3)}function X(e,t){return n="0",r=t-e.toString().length,new Array(r+1).join(n)+e;var n,r}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Z=function(e,t){return(Z=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function ee(e,t){function n(){this.constructor=e}Z(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var te=function(){return(te=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function ne(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))}function re(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(s){o=[6,s],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function ie(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function oe(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function ae(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(oe(arguments[t]));return e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var se=!1,ue="${JSCORE_VERSION}",le=function(e,t){if(!e)throw ce(t)},ce=function(e){return new Error("Firebase Database ("+ue+") INTERNAL ASSERT FAILED: "+e)},he=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},pe={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<e.length;i+=3){var o=e[i],a=i+1<e.length,s=a?e[i+1]:0,u=i+2<e.length,l=u?e[i+2]:0,c=o>>2,h=(3&o)<<4|s>>4,p=(15&s)<<2|l>>6,d=63&l;u||(d=64,a||(p=64)),r.push(n[c],n[h],n[p],n[d])}return r.join("")},encodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(he(e),t)},decodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){for(var t=[],n=0,r=0;n<e.length;){var i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){var o=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(i>239&&i<365){var a=((7&i)<<18|(63&(o=e[n++]))<<12|(63&(s=e[n++]))<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(a>>10)),t[r++]=String.fromCharCode(56320+(1023&a))}else{o=e[n++];var s=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&s)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray:function(e,t){this.init_();for(var n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<e.length;){var o=n[e.charAt(i++)],a=i<e.length?n[e.charAt(i)]:0,s=++i<e.length?n[e.charAt(i)]:64,u=++i<e.length?n[e.charAt(i)]:64;if(++i,null==o||null==a||null==s||null==u)throw Error();var l=o<<2|a>>4;if(r.push(l),64!==s){var c=a<<4&240|s>>2;if(r.push(c),64!==u){var h=s<<6&192|u;r.push(h)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},de=function(e){try{return pe.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function fe(e){return ye(void 0,e)}function ye(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(var n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=ye(e[n],t[n]));return e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var me=function(){function e(){var e=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(t,n){e.resolve=t,e.reject=n}))}return e.prototype.wrapCallback=function(e){var t=this;return function(n,r){n?t.reject(n):t.resolve(r),"function"==typeof e&&(t.promise.catch((function(){})),1===e.length?e(n):e(n,r))}},e}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ve(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")}function ge(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return!1}}function _e(){var e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function be(){return!0===se}function we(){return"indexedDB"in self&&null!=indexedDB}function Ce(){return new Promise((function(e,t){try{var n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=window.indexedDB.open(r);i.onsuccess=function(){i.result.close(),n||window.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=function(){n=!1},i.onerror=function(){var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(o){t(o)}}))}function Te(){return!(!navigator||!navigator.cookieEnabled)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Se=function(e){function t(n,r,i){var o=e.call(this,r)||this;return o.code=n,o.customData=i,o.name="FirebaseError",Object.setPrototypeOf(o,t.prototype),Error.captureStackTrace&&Error.captureStackTrace(o,Ee.prototype.create),o}return ee(t,e),t}(Error),Ee=function(){function e(e,t,n){this.service=e,this.serviceName=t,this.errors=n}return e.prototype.create=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=t[0]||{},i=this.service+"/"+e,o=this.errors[e],a=o?ke(o,r):"Error",s=this.serviceName+": "+a+" ("+i+").",u=new Se(i,s,r);return u},e}();function ke(e,t){return e.replace(Ie,(function(e,n){var r=t[n];return null!=r?String(r):"<"+n+"?>"}))}var Ie=/\{\$([^}]+)}/g;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pe(e){return JSON.parse(e)}function Ne(e){return JSON.stringify(e)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var De=function(e){var t={},n={},r={},i="";try{var o=e.split(".");t=Pe(de(o[0])||""),n=Pe(de(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch(a){}return{header:t,claims:n,data:r,signature:i}};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function xe(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Re(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function Ae(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function Oe(e,t,n){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Le=function(){function e(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}return e.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},e.prototype.compress_=function(e,t){t||(t=0);var n=this.W_;if("string"==typeof e)for(var r=0;r<16;r++)n[r]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(r=0;r<16;r++)n[r]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,a,s=this.chain_[0],u=this.chain_[1],l=this.chain_[2],c=this.chain_[3],h=this.chain_[4];for(r=0;r<80;r++){r<40?r<20?(o=c^u&(l^c),a=1518500249):(o=u^l^c,a=1859775393):r<60?(o=u&l|c&(u|l),a=2400959708):(o=u^l^c,a=3395469782);i=(s<<5|s>>>27)+o+h+a+n[r]&4294967295;h=c,c=l,l=4294967295&(u<<30|u>>>2),u=s,s=i}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+u&4294967295,this.chain_[2]=this.chain_[2]+l&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+h&4294967295},e.prototype.update=function(e,t){if(null!=e){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<t;){if(0===o)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(i[o]=e.charCodeAt(r),++r,++o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<t;)if(i[o]=e[r],++r,++o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=t}},e.prototype.digest=function(){var e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&t,t/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;i>=0;i-=8)e[r]=this.chain_[n]>>i&255,++r;return e},e}();function Me(e,t){var n=new Fe(e,t);return n.subscribe.bind(n)}var Fe=function(){function e(e,t){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((function(){e(n)})).catch((function(e){n.error(e)}))}return e.prototype.next=function(e){this.forEachObserver((function(t){t.next(e)}))},e.prototype.error=function(e){this.forEachObserver((function(t){t.error(e)})),this.close(e)},e.prototype.complete=function(){this.forEachObserver((function(e){e.complete()})),this.close()},e.prototype.subscribe=function(e,t,n){var r,i=this;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(e,t){if("object"!=typeof e||null===e)return!1;for(var n=0,r=t;n<r.length;n++){var i=r[n];if(i in e&&"function"==typeof e[i])return!0}return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n}).next&&(r.next=je),void 0===r.error&&(r.error=je),void 0===r.complete&&(r.complete=je);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(e){}})),this.observers.push(r),o},e.prototype.unsubscribeOne=function(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},e.prototype.forEachObserver=function(e){if(!this.finalized)for(var t=0;t<this.observers.length;t++)this.sendOne(t,e)},e.prototype.sendOne=function(e,t){var n=this;this.task.then((function(){if(void 0!==n.observers&&void 0!==n.observers[e])try{t(n.observers[e])}catch(r){"undefined"!=typeof console&&console.error&&console.error(r)}}))},e.prototype.close=function(e){var t=this;this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((function(){t.observers=void 0,t.onNoObservers=void 0})))},e}();function je(){}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var qe=function(e,t,n,r){var i;if(r<t?i="at least "+t:r>n&&(i=0===n?"none":"no more than "+n),i)throw new Error(e+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")};function Ue(e,t,n){var r="";switch(t){case 1:r=n?"first":"First";break;case 2:r=n?"second":"Second";break;case 3:r=n?"third":"Third";break;case 4:r=n?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var i=e+" failed: ";return i+=r+" argument "}function Qe(e,t,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(Ue(e,t,r)+"must be a valid function.")}function Ve(e,t,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(Ue(e,t,r)+"must be a valid context object.")}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var We=function(e){for(var t=0,n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t};function He(e,t,n){void 0===t&&(t=1e3),void 0===n&&(n=2);var r=t*Math.pow(n,e),i=Math.round(.5*r*(Math.random()-.5)*2);return Math.min(144e5,r+i)}var Be=function(){function e(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return e.prototype.setInstantiationMode=function(e){return this.instantiationMode=e,this},e.prototype.setMultipleInstances=function(e){return this.multipleInstances=e,this},e.prototype.setServiceProps=function(e){return this.serviceProps=e,this},e}(),$e=function(){function e(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map}return e.prototype.get=function(e){void 0===e&&(e="[DEFAULT]");var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){var n=new me;this.instancesDeferred.set(t,n);try{var r=this.getOrInitializeService(t);r&&n.resolve(r)}catch(i){}}return this.instancesDeferred.get(t).promise},e.prototype.getImmediate=function(e){var t=te({identifier:"[DEFAULT]",optional:!1},e),n=t.identifier,r=t.optional,i=this.normalizeInstanceIdentifier(n);try{var o=this.getOrInitializeService(i);if(!o){if(r)return null;throw Error("Service "+this.name+" is not available")}return o}catch(a){if(r)return null;throw a}},e.prototype.getComponent=function(){return this.component},e.prototype.setComponent=function(e){var t,n;if(e.name!==this.name)throw Error("Mismatching Component "+e.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=e,function(e){return"EAGER"===e.instantiationMode}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e))try{this.getOrInitializeService("[DEFAULT]")}catch(c){}try{for(var r=ie(this.instancesDeferred.entries()),i=r.next();!i.done;i=r.next()){var o=oe(i.value,2),a=o[0],s=o[1],u=this.normalizeInstanceIdentifier(a);try{var l=this.getOrInitializeService(u);s.resolve(l)}catch(c){}}}catch(h){t={error:h}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},e.prototype.clearInstance=function(e){void 0===e&&(e="[DEFAULT]"),this.instancesDeferred.delete(e),this.instances.delete(e)},e.prototype.delete=function(){return ne(this,void 0,void 0,(function(){var e;return re(this,(function(t){switch(t.label){case 0:return e=Array.from(this.instances.values()),[4,Promise.all(ae(e.filter((function(e){return"INTERNAL"in e})).map((function(e){return e.INTERNAL.delete()})),e.filter((function(e){return"_delete"in e})).map((function(e){return e._delete()}))))];case 1:return t.sent(),[2]}}))}))},e.prototype.isComponentSet=function(){return null!=this.component},e.prototype.isInitialized=function(e){return void 0===e&&(e="[DEFAULT]"),this.instances.has(e)},e.prototype.getOrInitializeService=function(e){var t=this.instances.get(e);return!t&&this.component&&(t=this.component.instanceFactory(this.container,function(e){return"[DEFAULT]"===e?void 0:e}(e)),this.instances.set(e,t)),t||null},e.prototype.normalizeInstanceIdentifier=function(e){return this.component?this.component.multipleInstances?e:"[DEFAULT]":e},e}();
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ke,ze=function(){function e(e){this.name=e,this.providers=new Map}return e.prototype.addComponent=function(e){var t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component "+e.name+" has already been registered with "+this.name);t.setComponent(e)},e.prototype.addOrOverwriteComponent=function(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)},e.prototype.getProvider=function(e){if(this.providers.has(e))return this.providers.get(e);var t=new $e(e,this);return this.providers.set(e,t),t},e.prototype.getProviders=function(){return Array.from(this.providers.values())},e}();
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Ge(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ye,Je,Xe=[];(Je=Ye||(Ye={}))[Je.DEBUG=0]="DEBUG",Je[Je.VERBOSE=1]="VERBOSE",Je[Je.INFO=2]="INFO",Je[Je.WARN=3]="WARN",Je[Je.ERROR=4]="ERROR",Je[Je.SILENT=5]="SILENT";var Ze,et={debug:Ye.DEBUG,verbose:Ye.VERBOSE,info:Ye.INFO,warn:Ye.WARN,error:Ye.ERROR,silent:Ye.SILENT},tt=Ye.INFO,nt=((Ke={})[Ye.DEBUG]="log",Ke[Ye.VERBOSE]="log",Ke[Ye.INFO]="info",Ke[Ye.WARN]="warn",Ke[Ye.ERROR]="error",Ke),rt=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(t<e.logLevel)){var i=(new Date).toISOString(),o=nt[t];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+t+")");console[o].apply(console,Ge(["["+i+"]  "+e.name+":"],n))}},it=function(){function e(e){this.name=e,this._logLevel=tt,this._logHandler=rt,this._userLogHandler=null,Xe.push(this)}return Object.defineProperty(e.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){if(!(e in Ye))throw new TypeError('Invalid value "'+e+'" assigned to `logLevel`');this._logLevel=e},enumerable:!1,configurable:!0}),e.prototype.setLogLevel=function(e){this._logLevel="string"==typeof e?et[e]:e},Object.defineProperty(e.prototype,"logHandler",{get:function(){return this._logHandler},set:function(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(e){this._userLogHandler=e},enumerable:!1,configurable:!0}),e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,Ge([this,Ye.DEBUG],e)),this._logHandler.apply(this,Ge([this,Ye.DEBUG],e))},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,Ge([this,Ye.VERBOSE],e)),this._logHandler.apply(this,Ge([this,Ye.VERBOSE],e))},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,Ge([this,Ye.INFO],e)),this._logHandler.apply(this,Ge([this,Ye.INFO],e))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,Ge([this,Ye.WARN],e)),this._logHandler.apply(this,Ge([this,Ye.WARN],e))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,Ge([this,Ye.ERROR],e)),this._logHandler.apply(this,Ge([this,Ye.ERROR],e))},e}();function ot(e){Xe.forEach((function(t){t.setLogLevel(e)}))}var at,st=((Ze={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",Ze["bad-app-name"]="Illegal App name: '{$appName}",Ze["duplicate-app"]="Firebase App named '{$appName}' already exists",Ze["app-deleted"]="Firebase App named '{$appName}' already deleted",Ze["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",Ze["invalid-log-argument"]="First argument to `onLog` must be null or a function.",Ze),ut=new Ee("app","Firebase",st),lt=((at={})["@firebase/app"]="fire-core",at["@firebase/analytics"]="fire-analytics",at["@firebase/auth"]="fire-auth",at["@firebase/database"]="fire-rtdb",at["@firebase/functions"]="fire-fn",at["@firebase/installations"]="fire-iid",at["@firebase/messaging"]="fire-fcm",at["@firebase/performance"]="fire-perf",at["@firebase/remote-config"]="fire-rc",at["@firebase/storage"]="fire-gcs",at["@firebase/firestore"]="fire-fst",at["fire-js"]="fire-js",at["firebase-wrapper"]="fire-js-all",at),ct=new it("@firebase/app"),ht=function(){function e(e,t,n){var r=this;this.firebase_=n,this.isDeleted_=!1,this.name_=t.name,this.automaticDataCollectionEnabled_=t.automaticDataCollectionEnabled||!1,this.options_=fe(e),this.container=new ze(t.name),this._addComponent(new Be("app",(function(){return r}),"PUBLIC")),this.firebase_.INTERNAL.components.forEach((function(e){return r._addComponent(e)}))}return Object.defineProperty(e.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(e){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!1,configurable:!0}),e.prototype.delete=function(){var e=this;return new Promise((function(t){e.checkDestroyed_(),t()})).then((function(){return e.firebase_.INTERNAL.removeApp(e.name_),Promise.all(e.container.getProviders().map((function(e){return e.delete()})))})).then((function(){e.isDeleted_=!0}))},e.prototype._getService=function(e,t){return void 0===t&&(t="[DEFAULT]"),this.checkDestroyed_(),this.container.getProvider(e).getImmediate({identifier:t})},e.prototype._removeServiceInstance=function(e,t){void 0===t&&(t="[DEFAULT]"),this.container.getProvider(e).clearInstance(t)},e.prototype._addComponent=function(e){try{this.container.addComponent(e)}catch(t){ct.debug("Component "+e.name+" failed to register with FirebaseApp "+this.name,t)}},e.prototype._addOrOverwriteComponent=function(e){this.container.addOrOverwriteComponent(e)},e.prototype.toJSON=function(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}},e.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw ut.create("app-deleted",{appName:this.name_})},e}();ht.prototype.name&&ht.prototype.options||ht.prototype.delete||console.log("dc");
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function pt(e){var t={},n=new Map,r={__esModule:!0,initializeApp:function(n,i){void 0===i&&(i={});if("object"!=typeof i||null===i){i={name:i}}var o=i;void 0===o.name&&(o.name="[DEFAULT]");var a=o.name;if("string"!=typeof a||!a)throw ut.create("bad-app-name",{appName:String(a)});if(xe(t,a))throw ut.create("duplicate-app",{appName:a});var s=new e(n,o,r);return t[a]=s,s},app:i,registerVersion:function(e,t,n){var r,i=null!==(r=lt[e])&&void 0!==r?r:e;n&&(i+="-"+n);var a=i.match(/\s|\//),s=t.match(/\s|\//);if(a||s){var u=['Unable to register library "'+i+'" with version "'+t+'":'];return a&&u.push('library name "'+i+'" contains illegal characters (whitespace or "/")'),a&&s&&u.push("and"),s&&u.push('version name "'+t+'" contains illegal characters (whitespace or "/")'),void ct.warn(u.join(" "))}o(new Be(i+"-version",(function(){return{library:i,version:t}}),"VERSION"))},setLogLevel:ot,onLog:function(e,t){if(null!==e&&"function"!=typeof e)throw ut.create("invalid-log-argument");!function(e,t){for(var n=function(n){var r=null;t&&t.level&&(r=et[t.level]),n.userLogHandler=null===e?null:function(t,n){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];var a=i.map((function(e){if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(t){return null}})).filter((function(e){return e})).join(" ");n>=(null!=r?r:t.logLevel)&&e({level:Ye[n].toLowerCase(),message:a,args:i,type:t.name})}},r=0,i=Xe;r<i.length;r++)n(i[r])}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e,t)},apps:null,SDK_VERSION:"8.2.9",INTERNAL:{registerComponent:o,removeApp:function(e){delete t[e]},components:n,useAsService:function(e,t){if("serverAuth"===t)return null;return t}}};function i(e){if(!xe(t,e=e||"[DEFAULT]"))throw ut.create("no-app",{appName:e});return t[e]}function o(o){var a=o.name;if(n.has(a))return ct.debug("There were multiple attempts to register component "+a+"."),"PUBLIC"===o.type?r[a]:null;if(n.set(a,o),"PUBLIC"===o.type){var s=function(e){if(void 0===e&&(e=i()),"function"!=typeof e[a])throw ut.create("invalid-app-argument",{appName:a});return e[a]()};void 0!==o.serviceProps&&ye(s,o.serviceProps),r[a]=s,e.prototype[a]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this._getService.bind(this,a);return n.apply(this,o.multipleInstances?e:[])}}for(var u=0,l=Object.keys(t);u<l.length;u++){var c=l[u];t[c]._addComponent(o)}return"PUBLIC"===o.type?r[a]:null}return r.default=r,Object.defineProperty(r,"apps",{get:function(){return Object.keys(t).map((function(e){return t[e]}))}}),i.App=e,r}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var dt=function e(){var t=pt(ht);return t.INTERNAL=te(te({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){ye(t,e)},createSubscribe:Me,ErrorFactory:Ee,deepExtend:ye}),t}(),ft=function(){function e(e){this.container=e}return e.prototype.getPlatformInfoString=function(){return this.container.getProviders().map((function(e){if(function(e){var t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e)){var t=e.getImmediate();return t.library+"/"+t.version}return null})).filter((function(e){return e})).join(" ")},e}();
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
if("object"==typeof self&&self.self===self&&void 0!==self.firebase){ct.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var yt=self.firebase.SDK_VERSION;yt&&yt.indexOf("LITE")>=0&&ct.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var mt=dt.initializeApp;dt.initializeApp=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return ge()&&ct.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the @rollup/plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/@rollup/plugin-node-resolve\n      '),mt.apply(void 0,e)};var vt,gt,_t=dt;(vt=_t).INTERNAL.registerComponent(new Be("platform-logger",(function(e){return new ft(e)}),"PRIVATE")),vt.registerVersion("@firebase/app","0.6.15",gt),vt.registerVersion("fire-js","");
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
_t.registerVersion("firebase","8.2.10","app");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var bt,wt=function(){function e(e){this.domStorage_=e,this.prefix_="firebase:"}return e.prototype.set=function(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Ne(t))},e.prototype.get=function(e){var t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:Pe(t)},e.prototype.remove=function(e){this.domStorage_.removeItem(this.prefixedName_(e))},e.prototype.prefixedName_=function(e){return this.prefix_+e},e.prototype.toString=function(){return this.domStorage_.toString()},e}(),Ct=function(){function e(){this.cache_={},this.isInMemoryStorage=!0}return e.prototype.set=function(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t},e.prototype.get=function(e){return xe(this.cache_,e)?this.cache_[e]:null},e.prototype.remove=function(e){delete this.cache_[e]},e}(),Tt=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){var t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new wt(t)}}catch(n){}return new Ct},St=Tt("localStorage"),Et=Tt("sessionStorage"),kt=new it("@firebase/database"),It=(bt=1,function(){return bt++}),Pt=function(e){var t=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);if(i>=55296&&i<=56319){var o=i-55296;r++,le(r<e.length,"Surrogate pair missing trail surrogate."),i=65536+(o<<10)+(e.charCodeAt(r)-56320)}i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):i<65536?(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t}(e),n=new Le;n.update(t);var r=n.digest();return pe.encodeByteArray(r)},Nt=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n="",r=0;r<e.length;r++){var i=e[r];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?n+=Nt.apply(null,i):n+="object"==typeof i?Ne(i):i,n+=" "}return n},Dt=null,xt=!0,Rt=function(e,t){le(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(kt.logLevel=Ye.VERBOSE,Dt=kt.log.bind(kt),t&&Et.set("logging_enabled",!0)):"function"==typeof e?Dt=e:(Dt=null,Et.remove("logging_enabled"))},At=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(!0===xt&&(xt=!1,null===Dt&&!0===Et.get("logging_enabled")&&Rt(!0)),Dt){var n=Nt.apply(null,e);Dt(n)}},Ot=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];At.apply(void 0,ae([e],t))}},Lt=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE INTERNAL ERROR: "+Nt.apply(void 0,ae(e));kt.error(n)},Mt=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE FATAL ERROR: "+Nt.apply(void 0,ae(e));throw kt.error(n),new Error(n)},Ft=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE WARNING: "+Nt.apply(void 0,ae(e));kt.warn(n)},jt=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},qt="[MIN_NAME]",Ut="[MAX_NAME]",Qt=function(e,t){if(e===t)return 0;if(e===qt||t===Ut)return-1;if(t===qt||e===Ut)return 1;var n=Gt(e),r=Gt(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null!==r?1:e<t?-1:1},Vt=function(e,t){return e===t?0:e<t?-1:1},Wt=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+Ne(t))},Ht=function(e){if("object"!=typeof e||null===e)return Ne(e);var t=[];for(var n in e)t.push(n);t.sort();for(var r="{",i=0;i<t.length;i++)0!==i&&(r+=","),r+=Ne(t[i]),r+=":",r+=Ht(e[t[i]]);return r+="}"},Bt=function(e,t){var n=e.length;if(n<=t)return[e];for(var r=[],i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $t(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])}var Kt=function(e){le(!jt(e),"Invalid JSON number");var t,n,r,i,o,a=1023;0===e?(n=0,r=0,t=1/e==-1/0?1:0):(t=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(e)/Math.LN2),a))+a,r=Math.round(e*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,r=Math.round(e/Math.pow(2,-1074))));var s=[];for(o=52;o;o-=1)s.push(r%2?1:0),r=Math.floor(r/2);for(o=11;o;o-=1)s.push(n%2?1:0),n=Math.floor(n/2);s.push(t?1:0),s.reverse();var u=s.join(""),l="";for(o=0;o<64;o+=8){var c=parseInt(u.substr(o,8),2).toString(16);1===c.length&&(c="0"+c),l+=c}return l.toLowerCase()},zt=new RegExp("^-?(0*)\\d{1,10}$"),Gt=function(e){if(zt.test(e)){var t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},Yt=function(e){try{e()}catch(t){setTimeout((function(){var e=t.stack||"";throw Ft("Exception was thrown by user callback.",e),t}),Math.floor(0))}},Jt=function(e,t){var n=setTimeout(e,t);return"object"==typeof n&&n.unref&&n.unref(),n},Xt=function(){function e(e,t){if(void 0===t){this.pieces_=e.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}return e.prototype.toString=function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"},e}();function Zt(){return new Xt("")}function en(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function tn(e){return e.pieces_.length-e.pieceNum_}function nn(e){var t=e.pieceNum_;return t<e.pieces_.length&&t++,new Xt(e.pieces_,t)}function rn(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function on(e){for(var t="",n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}function an(e,t){return void 0===t&&(t=0),e.pieces_.slice(e.pieceNum_+t)}function sn(e){if(e.pieceNum_>=e.pieces_.length)return null;for(var t=[],n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new Xt(t,0)}function un(e,t){for(var n=[],r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);if(t instanceof Xt)for(r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);else{var i=t.split("/");for(r=0;r<i.length;r++)i[r].length>0&&n.push(i[r])}return new Xt(n,0)}function ln(e){return e.pieceNum_>=e.pieces_.length}function cn(e,t){var n=en(e),r=en(t);if(null===n)return t;if(n===r)return cn(nn(e),nn(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function hn(e,t){for(var n=an(e,0),r=an(t,0),i=0;i<n.length&&i<r.length;i++){var o=Qt(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1}function pn(e,t){if(tn(e)!==tn(t))return!1;for(var n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function dn(e,t){var n=e.pieceNum_,r=t.pieceNum_;if(tn(e)>tn(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}var fn=function(){function e(e,t){this.errorPrefix_=t,this.parts_=an(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=We(this.parts_[n]);this.checkValid_()}return Object.defineProperty(e,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!1,configurable:!0}),Object.defineProperty(e,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!1,configurable:!0}),e.prototype.push=function(e){this.parts_.length>0&&(this.byteLength_+=1),this.parts_.push(e),this.byteLength_+=We(e),this.checkValid_()},e.prototype.pop=function(){var e=this.parts_.pop();this.byteLength_-=We(e),this.parts_.length>0&&(this.byteLength_-=1)},e.prototype.checkValid_=function(){if(this.byteLength_>e.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+e.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>e.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+e.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},e.prototype.toErrorString=function(){return 0===this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},e}(),yn=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,mn=function(){function e(e,t,n,r,i,o,a){void 0===i&&(i=!1),void 0===o&&(o=""),void 0===a&&(a=!1),this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.host=e.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=St.get("host:"+e)||this.host}return e.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()||this.includeNamespaceInQueryParams},e.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},e.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},e.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},e.prototype.updateHost=function(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&St.set("host:"+this.host,this.internalHost))},e.prototype.connectionURL=function(e,t){var n;if(le("string"==typeof e,"typeof type must == string"),le("object"==typeof t,"typeof params must == object"),"websocket"===e)n=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if("long_polling"!==e)throw new Error("Unknown connection type: "+e);n=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(t.ns=this.namespace);var r=[];return $t(t,(function(e,t){r.push(e+"="+t)})),n+r.join("&")},e.prototype.toString=function(){var e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e},e.prototype.toURLString=function(){var e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?"?ns="+this.namespace:"";return""+e+this.host+"/"+t},e}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var vn,gn,_n,bn,wn=function(e,t){var n=Cn(e),r=n.namespace;"firebase.com"===n.domain&&Mt(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||Mt("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Ft("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new mn(n.host,n.secure,r,t,i,"",r!==n.subdomain),path:new Xt(n.pathString)}},Cn=function(e){var t="",n="",r="",i="",o="",a=!0,s="https",u=443;if("string"==typeof e){var l=e.indexOf("//");l>=0&&(s=e.substring(0,l-1),e=e.substring(l+2));var c=e.indexOf("/");-1===c&&(c=e.length);var h=e.indexOf("?");-1===h&&(h=e.length),t=e.substring(0,Math.min(c,h)),c<h&&(i=
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(e){for(var t="",n=e.split("/"),r=0;r<n.length;r++)if(n[r].length>0){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(o){}t+="/"+i}return t}(e.substring(c,h)));var p=function(e){var t,n,r={};"?"===e.charAt(0)&&(e=e.substring(1));try{for(var i=ie(e.split("&")),o=i.next();!o.done;o=i.next()){var a=o.value;if(0!==a.length){var s=a.split("=");2===s.length?r[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):Ft("Invalid query segment '"+a+"' in query '"+e+"'")}}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r}(e.substring(Math.min(e.length,h)));(l=t.indexOf(":"))>=0?(a="https"===s||"wss"===s,u=parseInt(t.substring(l+1),10)):l=t.length;var d=t.slice(0,l);if("localhost"===d.toLowerCase())n="localhost";else if(d.split(".").length<=2)n=d;else{var f=t.indexOf(".");r=t.substring(0,f).toLowerCase(),n=t.substring(f+1),o=r}"ns"in p&&(o=p.ns)}return{host:t,port:u,domain:n,subdomain:r,secure:a,scheme:s,pathString:i,namespace:o}},Tn=/[\[\].#$\/\u0000-\u001F\u007F]/,Sn=/[\[\].#$\u0000-\u001F\u007F]/,En=function(e){return"string"==typeof e&&0!==e.length&&!Tn.test(e)},kn=function(e){return"string"==typeof e&&0!==e.length&&!Sn.test(e)},In=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!jt(e)||e&&"object"==typeof e&&xe(e,".sv")},Pn=function(e,t,n,r,i){i&&void 0===n||Nn(Ue(e,t,i),n,r)},Nn=function(e,t,n){var r=n instanceof Xt?new fn(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+r.toErrorString());if("function"==typeof t)throw new Error(e+"contains a function "+r.toErrorString()+" with contents = "+t.toString());if(jt(t))throw new Error(e+"contains "+t.toString()+" "+r.toErrorString());if("string"==typeof t&&t.length>10485760/3&&We(t)>10485760)throw new Error(e+"contains a string greater than 10485760 utf8 bytes "+r.toErrorString()+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){var i=!1,o=!1;if($t(t,(function(t,n){if(".value"===t)i=!0;else if(".priority"!==t&&".sv"!==t&&(o=!0,!En(t)))throw new Error(e+" contains an invalid key ("+t+") "+r.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.push(t),Nn(e,n,r),r.pop()})),i&&o)throw new Error(e+' contains ".value" child '+r.toErrorString()+" in addition to actual children.")}},Dn=function(e,t,n,r,i){if(!i||void 0!==n){var o=Ue(e,t,i);if(!n||"object"!=typeof n||Array.isArray(n))throw new Error(o+" must be an object containing the children to replace.");var a=[];$t(n,(function(e,t){var n=new Xt(e);if(Nn(o,t,un(r,n)),".priority"===rn(n)&&!In(t))throw new Error(o+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");a.push(n)})),function(e,t){var n,r;for(n=0;n<t.length;n++)for(var i=an(r=t[n]),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!En(i[o]))throw new Error(e+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');t.sort(hn);var a=null;for(n=0;n<t.length;n++){if(r=t[n],null!==a&&dn(a,r))throw new Error(e+"contains a path "+a.toString()+" that is ancestor of another path "+r.toString());a=r}}(o,a)}},xn=function(e,t,n,r){if(!r||void 0!==n){if(jt(n))throw new Error(Ue(e,t,r)+"is "+n.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!In(n))throw new Error(Ue(e,t,r)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},Rn=function(e,t,n,r){if(!r||void 0!==n)switch(n){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Ue(e,t,r)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},An=function(e,t,n,r){if(!(r&&void 0===n||En(n)))throw new Error(Ue(e,t,r)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},On=function(e,t,n,r){if(!(r&&void 0===n||kn(n)))throw new Error(Ue(e,t,r)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},Ln=function(e,t,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),On(e,t,n,r)},Mn=function(e,t){if(".info"===en(t))throw new Error(e+" failed = Can't modify data under /.info/")},Fn=function(e,t,n){var r=n.path.toString();if("string"!=typeof n.repoInfo.host||0===n.repoInfo.host.length||!En(n.repoInfo.namespace)&&"localhost"!==n.repoInfo.host.split(":")[0]||0!==r.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),kn(e)}(r))throw new Error(Ue(e,t,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},jn=function(e,t,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(Ue(e,t,r)+"must be a boolean.")},qn=function(){function e(e,t){this.repo_=e,this.path_=t}return e.prototype.cancel=function(e){qe("OnDisconnect.cancel",0,1,arguments.length),Qe("OnDisconnect.cancel",1,e,!0);var t=new me;return this.repo_.onDisconnectCancel(this.path_,t.wrapCallback(e)),t.promise},e.prototype.remove=function(e){qe("OnDisconnect.remove",0,1,arguments.length),Mn("OnDisconnect.remove",this.path_),Qe("OnDisconnect.remove",1,e,!0);var t=new me;return this.repo_.onDisconnectSet(this.path_,null,t.wrapCallback(e)),t.promise},e.prototype.set=function(e,t){qe("OnDisconnect.set",1,2,arguments.length),Mn("OnDisconnect.set",this.path_),Pn("OnDisconnect.set",1,e,this.path_,!1),Qe("OnDisconnect.set",2,t,!0);var n=new me;return this.repo_.onDisconnectSet(this.path_,e,n.wrapCallback(t)),n.promise},e.prototype.setWithPriority=function(e,t,n){qe("OnDisconnect.setWithPriority",2,3,arguments.length),Mn("OnDisconnect.setWithPriority",this.path_),Pn("OnDisconnect.setWithPriority",1,e,this.path_,!1),xn("OnDisconnect.setWithPriority",2,t,!1),Qe("OnDisconnect.setWithPriority",3,n,!0);var r=new me;return this.repo_.onDisconnectSetWithPriority(this.path_,e,t,r.wrapCallback(n)),r.promise},e.prototype.update=function(e,t){if(qe("OnDisconnect.update",1,2,arguments.length),Mn("OnDisconnect.update",this.path_),Array.isArray(e)){for(var n={},r=0;r<e.length;++r)n[""+r]=e[r];e=n,Ft("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Dn("OnDisconnect.update",1,e,this.path_,!1),Qe("OnDisconnect.update",2,t,!0);var i=new me;return this.repo_.onDisconnectUpdate(this.path_,e,i.wrapCallback(t)),i.promise},e}(),Un=function(){function e(e,t){this.committed=e,this.snapshot=t}return e.prototype.toJSON=function(){return qe("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},e}(),Qn="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Vn=(vn=0,gn=[],function(e){var t,n=e===vn;vn=e;var r=new Array(8);for(t=7;t>=0;t--)r[t]=Qn.charAt(e%64),e=Math.floor(e/64);le(0===e,"Cannot push at time == 0");var i=r.join("");if(n){for(t=11;t>=0&&63===gn[t];t--)gn[t]=0;gn[t]++}else for(t=0;t<12;t++)gn[t]=Math.floor(64*Math.random());for(t=0;t<12;t++)i+=Qn.charAt(gn[t]);return le(20===i.length,"nextPushId: Length should be 20."),i}),Wn=function(e){if("2147483647"===e)return"-";var t=Gt(e);if(null!=t)return""+(t+1);for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e.charAt(r);if(n.length<786)return n.push("-"),n.join("");for(var i=n.length-1;i>=0&&"z"===n[i];)i--;if(-1===i)return Ut;var o=n[i],a=Qn.charAt(Qn.indexOf(o)+1);return n[i]=a,n.slice(0,i+1).join("")},Hn=function(e){if("-2147483648"===e)return qt;var t=Gt(e);if(null!=t)return""+(t-1);for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e.charAt(r);return"-"===n[n.length-1]?1===n.length?"2147483647":(delete n[n.length-1],n.join("")):(n[n.length-1]=Qn.charAt(Qn.indexOf(n[n.length-1])-1),n.join("")+"z".repeat(786-n.length))},Bn=function(){function e(e,t){this.name=e,this.node=t}return e.Wrap=function(t,n){return new e(t,n)},e}(),$n=function(){function e(){}return e.prototype.getCompare=function(){return this.compare.bind(this)},e.prototype.indexedValueChanged=function(e,t){var n=new Bn(qt,e),r=new Bn(qt,t);return 0!==this.compare(n,r)},e.prototype.minPost=function(){return Bn.MIN},e}(),Kn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ee(t,e),Object.defineProperty(t,"__EMPTY_NODE",{get:function(){return _n},set:function(e){_n=e},enumerable:!1,configurable:!0}),t.prototype.compare=function(e,t){return Qt(e.name,t.name)},t.prototype.isDefinedOn=function(e){throw ce("KeyIndex.isDefinedOn not expected to be called.")},t.prototype.indexedValueChanged=function(e,t){return!1},t.prototype.minPost=function(){return Bn.MIN},t.prototype.maxPost=function(){return new Bn(Ut,_n)},t.prototype.makePost=function(e,t){return le("string"==typeof e,"KeyIndex indexValue must always be a string."),new Bn(e,_n)},t.prototype.toString=function(){return".key"},t}($n),zn=new Kn;var Gn,Yn,Jn,Xn=function(e){return"number"==typeof e?"number:"+Kt(e):"string:"+e},Zn=function(e){if(e.isLeafNode()){var t=e.val();le("string"==typeof t||"number"==typeof t||"object"==typeof t&&xe(t,".sv"),"Priority must be a string or number.")}else le(e===bn||e.isEmpty(),"priority of unexpected type.");le(e===bn||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},er=function(){function e(t,n){void 0===n&&(n=e.__childrenNodeConstructor.EMPTY_NODE),this.value_=t,this.priorityNode_=n,this.lazyHash_=null,le(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Zn(this.priorityNode_)}return Object.defineProperty(e,"__childrenNodeConstructor",{get:function(){return Gn},set:function(e){Gn=e},enumerable:!1,configurable:!0}),e.prototype.isLeafNode=function(){return!0},e.prototype.getPriority=function(){return this.priorityNode_},e.prototype.updatePriority=function(t){return new e(this.value_,t)},e.prototype.getImmediateChild=function(t){return".priority"===t?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE},e.prototype.getChild=function(t){return ln(t)?this:".priority"===en(t)?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE},e.prototype.hasChild=function(){return!1},e.prototype.getPredecessorChildName=function(e,t){return null},e.prototype.updateImmediateChild=function(t,n){return".priority"===t?this.updatePriority(n):n.isEmpty()&&".priority"!==t?this:e.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,n).updatePriority(this.priorityNode_)},e.prototype.updateChild=function(t,n){var r=en(t);return null===r?n:n.isEmpty()&&".priority"!==r?this:(le(".priority"!==r||1===tn(t),".priority must be the last token in a path"),this.updateImmediateChild(r,e.__childrenNodeConstructor.EMPTY_NODE.updateChild(nn(t),n)))},e.prototype.isEmpty=function(){return!1},e.prototype.numChildren=function(){return 0},e.prototype.forEachChild=function(e,t){return!1},e.prototype.val=function(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},e.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.priorityNode_.isEmpty()||(e+="priority:"+Xn(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":",e+="number"===t?Kt(this.value_):this.value_,this.lazyHash_=Pt(e)}return this.lazyHash_},e.prototype.getValue=function(){return this.value_},e.prototype.compareTo=function(t){return t===e.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof e.__childrenNodeConstructor?-1:(le(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))},e.prototype.compareToLeafNode_=function(t){var n=typeof t.value_,r=typeof this.value_,i=e.VALUE_TYPE_ORDER.indexOf(n),o=e.VALUE_TYPE_ORDER.indexOf(r);return le(i>=0,"Unknown leaf type: "+n),le(o>=0,"Unknown leaf type: "+r),i===o?"object"===r?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-i},e.prototype.withIndex=function(){return this},e.prototype.isIndexed=function(){return!0},e.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode()){var t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1},e.VALUE_TYPE_ORDER=["object","boolean","number","string"],e}();var tr,nr,rr=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ee(t,e),t.prototype.compare=function(e,t){var n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?Qt(e.name,t.name):i},t.prototype.isDefinedOn=function(e){return!e.getPriority().isEmpty()},t.prototype.indexedValueChanged=function(e,t){return!e.getPriority().equals(t.getPriority())},t.prototype.minPost=function(){return Bn.MIN},t.prototype.maxPost=function(){return new Bn(Ut,new er("[PRIORITY-POST]",Jn))},t.prototype.makePost=function(e,t){var n=Yn(e);return new Bn(t,new er("[PRIORITY-POST]",n))},t.prototype.toString=function(){return".priority"},t}($n)),ir=function(){function e(e,t,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!e.isEmpty();)if(e=e,o=t?n(e.key,t):1,r&&(o*=-1),o<0)e=this.isReverse_?e.left:e.right;else{if(0===o){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}return e.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e},e.prototype.hasNext=function(){return this.nodeStack_.length>0},e.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}},e}(),or=function(){function e(t,n,r,i,o){this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=i?i:sr.EMPTY_NODE,this.right=null!=o?o:sr.EMPTY_NODE}return e.prototype.copy=function(t,n,r,i,o){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},e.prototype.count=function(){return this.left.count()+1+this.right.count()},e.prototype.isEmpty=function(){return!1},e.prototype.inorderTraversal=function(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)},e.prototype.reverseTraversal=function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)},e.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},e.prototype.minKey=function(){return this.min_().key},e.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},e.prototype.insert=function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp_()},e.prototype.removeMin_=function(){if(this.left.isEmpty())return sr.EMPTY_NODE;var e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()},e.prototype.remove=function(e,t){var n,r;if(t(e,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return sr.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()},e.prototype.isRed_=function(){return this.color},e.prototype.fixUp_=function(){var e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e},e.prototype.moveRedLeft_=function(){var e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e},e.prototype.moveRedRight_=function(){var e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e},e.prototype.rotateLeft_=function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},e.prototype.rotateRight_=function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},e.prototype.colorFlip_=function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)},e.prototype.checkMaxDepth_=function(){var e=this.check_();return Math.pow(2,e)<=this.count()+1},e.prototype.check_=function(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)},e.RED=!0,e.BLACK=!1,e}(),ar=function(){function e(){}return e.prototype.copy=function(e,t,n,r,i){return this},e.prototype.insert=function(e,t,n){return new or(e,t,null)},e.prototype.remove=function(e,t){return this},e.prototype.count=function(){return 0},e.prototype.isEmpty=function(){return!0},e.prototype.inorderTraversal=function(e){return!1},e.prototype.reverseTraversal=function(e){return!1},e.prototype.minKey=function(){return null},e.prototype.maxKey=function(){return null},e.prototype.check_=function(){return 0},e.prototype.isRed_=function(){return!1},e}(),sr=function(){function e(t,n){void 0===n&&(n=e.EMPTY_NODE),this.comparator_=t,this.root_=n}return e.prototype.insert=function(t,n){return new e(this.comparator_,this.root_.insert(t,n,this.comparator_).copy(null,null,or.BLACK,null,null))},e.prototype.remove=function(t){return new e(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,or.BLACK,null,null))},e.prototype.get=function(e){for(var t,n=this.root_;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null},e.prototype.getPredecessorKey=function(e){for(var t,n=this.root_,r=null;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},e.prototype.isEmpty=function(){return this.root_.isEmpty()},e.prototype.count=function(){return this.root_.count()},e.prototype.minKey=function(){return this.root_.minKey()},e.prototype.maxKey=function(){return this.root_.maxKey()},e.prototype.inorderTraversal=function(e){return this.root_.inorderTraversal(e)},e.prototype.reverseTraversal=function(e){return this.root_.reverseTraversal(e)},e.prototype.getIterator=function(e){return new ir(this.root_,null,this.comparator_,!1,e)},e.prototype.getIteratorFrom=function(e,t){return new ir(this.root_,e,this.comparator_,!1,t)},e.prototype.getReverseIteratorFrom=function(e,t){return new ir(this.root_,e,this.comparator_,!0,t)},e.prototype.getReverseIterator=function(e){return new ir(this.root_,null,this.comparator_,!0,e)},e.EMPTY_NODE=new ar,e}(),ur=Math.log(2),lr=function(){function e(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/ur,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=e+1&r}return e.prototype.nextBitIsOne=function(){var e=!(this.bits_&1<<this.current_);return this.current_--,e},e}(),cr=function(e,t,n,r){e.sort(t);var i=function(t,r){var o,a,s=r-t;if(0===s)return null;if(1===s)return o=e[t],a=n?n(o):o,new or(a,o.node,or.BLACK,null,null);var u=parseInt(s/2,10)+t,l=i(t,u),c=i(u+1,r);return o=e[u],a=n?n(o):o,new or(a,o.node,or.BLACK,l,c)},o=function(t){for(var r=null,o=null,a=e.length,s=function(t,r){var o=a-t,s=a;a-=t;var l=i(o+1,s),c=e[o],h=n?n(c):c;u(new or(h,c.node,r,null,l))},u=function(e){r?(r.left=e,r=e):(o=e,r=e)},l=0;l<t.count;++l){var c=t.nextBitIsOne(),h=Math.pow(2,t.count-(l+1));c?s(h,or.BLACK):(s(h,or.BLACK),s(h,or.RED))}return o}(new lr(e.length));return new sr(r||t,o)},hr={},pr=function(){function e(e,t){this.indexes_=e,this.indexSet_=t}return Object.defineProperty(e,"Default",{get:function(){return le(hr&&rr,"ChildrenNode.ts has not been loaded"),tr=tr||new e({".priority":hr},{".priority":rr})},enumerable:!1,configurable:!0}),e.prototype.get=function(e){var t=Re(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof sr?t:null},e.prototype.hasIndex=function(e){return xe(this.indexSet_,e.toString())},e.prototype.addIndex=function(t,n){le(t!==zn,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var r,i=[],o=!1,a=n.getIterator(Bn.Wrap),s=a.getNext();s;)o=o||t.isDefinedOn(s.node),i.push(s),s=a.getNext();r=o?cr(i,t.getCompare()):hr;var u=t.toString(),l=te({},this.indexSet_);l[u]=t;var c=te({},this.indexes_);return c[u]=r,new e(c,l)},e.prototype.addToIndexes=function(t,n){var r=this;return new e(Oe(this.indexes_,(function(e,i){var o=Re(r.indexSet_,i);if(le(o,"Missing index implementation for "+i),e===hr){if(o.isDefinedOn(t.node)){for(var a=[],s=n.getIterator(Bn.Wrap),u=s.getNext();u;)u.name!==t.name&&a.push(u),u=s.getNext();return a.push(t),cr(a,o.getCompare())}return hr}var l=n.get(t.name),c=e;return l&&(c=c.remove(new Bn(t.name,l))),c.insert(t,t.node)})),this.indexSet_)},e.prototype.removeFromIndexes=function(t,n){return new e(Oe(this.indexes_,(function(e){if(e===hr)return e;var r=n.get(t.name);return r?e.remove(new Bn(t.name,r)):e})),this.indexSet_)},e}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function dr(e,t){return Qt(e.name,t.name)}function fr(e,t){return Qt(e,t)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var yr=function(){function e(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Zn(this.priorityNode_),this.children_.isEmpty()&&le(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(e,"EMPTY_NODE",{get:function(){return nr||(nr=new e(new sr(fr),null,pr.Default))},enumerable:!1,configurable:!0}),e.prototype.isLeafNode=function(){return!1},e.prototype.getPriority=function(){return this.priorityNode_||nr},e.prototype.updatePriority=function(t){return this.children_.isEmpty()?this:new e(this.children_,t,this.indexMap_)},e.prototype.getImmediateChild=function(e){if(".priority"===e)return this.getPriority();var t=this.children_.get(e);return null===t?nr:t},e.prototype.getChild=function(e){var t=en(e);return null===t?this:this.getImmediateChild(t).getChild(nn(e))},e.prototype.hasChild=function(e){return null!==this.children_.get(e)},e.prototype.updateImmediateChild=function(t,n){if(le(n,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(n);var r=new Bn(t,n),i=void 0,o=void 0;n.isEmpty()?(i=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(t,n),o=this.indexMap_.addToIndexes(r,this.children_));var a=i.isEmpty()?nr:this.priorityNode_;return new e(i,a,o)},e.prototype.updateChild=function(e,t){var n=en(e);if(null===n)return t;le(".priority"!==en(e)||1===tn(e),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(nn(e),t);return this.updateImmediateChild(n,r)},e.prototype.isEmpty=function(){return this.children_.isEmpty()},e.prototype.numChildren=function(){return this.children_.count()},e.prototype.val=function(t){if(this.isEmpty())return null;var n={},r=0,i=0,o=!0;if(this.forEachChild(rr,(function(a,s){n[a]=s.val(t),r++,o&&e.INTEGER_REGEXP_.test(a)?i=Math.max(i,Number(a)):o=!1})),!t&&o&&i<2*r){var a=[];for(var s in n)a[s]=n[s];return a}return t&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n},e.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.getPriority().isEmpty()||(e+="priority:"+Xn(this.getPriority().val())+":"),this.forEachChild(rr,(function(t,n){var r=n.hash();""!==r&&(e+=":"+t+":"+r)})),this.lazyHash_=""===e?"":Pt(e)}return this.lazyHash_},e.prototype.getPredecessorChildName=function(e,t,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new Bn(e,t));return i?i.name:null}return this.children_.getPredecessorKey(e)},e.prototype.getFirstChildName=function(e){var t=this.resolveIndex_(e);if(t){var n=t.minKey();return n&&n.name}return this.children_.minKey()},e.prototype.getFirstChild=function(e){var t=this.getFirstChildName(e);return t?new Bn(t,this.children_.get(t)):null},e.prototype.getLastChildName=function(e){var t=this.resolveIndex_(e);if(t){var n=t.maxKey();return n&&n.name}return this.children_.maxKey()},e.prototype.getLastChild=function(e){var t=this.getLastChildName(e);return t?new Bn(t,this.children_.get(t)):null},e.prototype.forEachChild=function(e,t){var n=this.resolveIndex_(e);return n?n.inorderTraversal((function(e){return t(e.name,e.node)})):this.children_.inorderTraversal(t)},e.prototype.getIterator=function(e){return this.getIteratorFrom(e.minPost(),e)},e.prototype.getIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(function(e){return e}));for(var r=this.children_.getIteratorFrom(e.name,Bn.Wrap),i=r.peek();null!=i&&t.compare(i,e)<0;)r.getNext(),i=r.peek();return r},e.prototype.getReverseIterator=function(e){return this.getReverseIteratorFrom(e.maxPost(),e)},e.prototype.getReverseIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(function(e){return e}));for(var r=this.children_.getReverseIteratorFrom(e.name,Bn.Wrap),i=r.peek();null!=i&&t.compare(i,e)>0;)r.getNext(),i=r.peek();return r},e.prototype.compareTo=function(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===mr?-1:0},e.prototype.withIndex=function(t){if(t===zn||this.indexMap_.hasIndex(t))return this;var n=this.indexMap_.addIndex(t,this.children_);return new e(this.children_,this.priorityNode_,n)},e.prototype.isIndexed=function(e){return e===zn||this.indexMap_.hasIndex(e)},e.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode())return!1;var t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){for(var n=this.getIterator(rr),r=t.getIterator(rr),i=n.getNext(),o=r.getNext();i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=n.getNext(),o=r.getNext()}return null===i&&null===o}return!1}return!1},e.prototype.resolveIndex_=function(e){return e===zn?null:this.indexMap_.get(e.toString())},e.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,e}(),mr=new(function(e){function t(){return e.call(this,new sr(fr),yr.EMPTY_NODE,pr.Default)||this}return ee(t,e),t.prototype.compareTo=function(e){return e===this?0:1},t.prototype.equals=function(e){return e===this},t.prototype.getPriority=function(){return this},t.prototype.getImmediateChild=function(e){return yr.EMPTY_NODE},t.prototype.isEmpty=function(){return!1},t}(yr));Object.defineProperties(Bn,{MIN:{value:new Bn(qt,yr.EMPTY_NODE)},MAX:{value:new Bn(Ut,mr)}}),Kn.__EMPTY_NODE=yr.EMPTY_NODE,er.__childrenNodeConstructor=yr,bn=mr,function(e){Jn=e}(mr);function vr(e,t){if(void 0===t&&(t=null),null===e)return yr.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),le(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new er(e,vr(t));if(e instanceof Array){var n=yr.EMPTY_NODE;return $t(e,(function(t,r){if(xe(e,t)&&"."!==t.substring(0,1)){var i=vr(r);!i.isLeafNode()&&i.isEmpty()||(n=n.updateImmediateChild(t,i))}})),n.updatePriority(vr(t))}var r=[],i=!1;if($t(e,(function(e,t){if("."!==e.substring(0,1)){var n=vr(t);n.isEmpty()||(i=i||!n.getPriority().isEmpty(),r.push(new Bn(e,n)))}})),0===r.length)return yr.EMPTY_NODE;var o=cr(r,dr,(function(e){return e.name}),fr);if(i){var a=cr(r,rr.getCompare());return new yr(o,vr(t),new pr({".priority":a},{".priority":rr}))}return new yr(o,vr(t),pr.Default)}!function(e){Yn=e}(vr);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var gr=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ee(t,e),t.prototype.compare=function(e,t){var n=e.node.compareTo(t.node);return 0===n?Qt(e.name,t.name):n},t.prototype.isDefinedOn=function(e){return!0},t.prototype.indexedValueChanged=function(e,t){return!e.equals(t)},t.prototype.minPost=function(){return Bn.MIN},t.prototype.maxPost=function(){return Bn.MAX},t.prototype.makePost=function(e,t){var n=vr(e);return new Bn(t,n)},t.prototype.toString=function(){return".value"},t}($n)),_r=function(e){function t(t){var n=e.call(this)||this;return n.indexPath_=t,le(!ln(t)&&".priority"!==en(t),"Can't create PathIndex with empty path or .priority key"),n}return ee(t,e),t.prototype.extractChild=function(e){return e.getChild(this.indexPath_)},t.prototype.isDefinedOn=function(e){return!e.getChild(this.indexPath_).isEmpty()},t.prototype.compare=function(e,t){var n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?Qt(e.name,t.name):i},t.prototype.makePost=function(e,t){var n=vr(e),r=yr.EMPTY_NODE.updateChild(this.indexPath_,n);return new Bn(t,r)},t.prototype.maxPost=function(){var e=yr.EMPTY_NODE.updateChild(this.indexPath_,mr);return new Bn(Ut,e)},t.prototype.toString=function(){return an(this.indexPath_,0).join("/")},t}($n),br=function(){function e(e,t,n){this.node_=e,this.ref_=t,this.index_=n}return e.prototype.val=function(){return qe("DataSnapshot.val",0,0,arguments.length),this.node_.val()},e.prototype.exportVal=function(){return qe("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},e.prototype.toJSON=function(){return qe("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},e.prototype.exists=function(){return qe("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},e.prototype.child=function(t){qe("DataSnapshot.child",0,1,arguments.length),t=String(t),On("DataSnapshot.child",1,t,!1);var n=new Xt(t),r=this.ref_.child(n);return new e(this.node_.getChild(n),r,rr)},e.prototype.hasChild=function(e){qe("DataSnapshot.hasChild",1,1,arguments.length),On("DataSnapshot.hasChild",1,e,!1);var t=new Xt(e);return!this.node_.getChild(t).isEmpty()},e.prototype.getPriority=function(){return qe("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},e.prototype.forEach=function(t){var n=this;if(qe("DataSnapshot.forEach",1,1,arguments.length),Qe("DataSnapshot.forEach",1,t,!1),this.node_.isLeafNode())return!1;var r=this.node_;return!!r.forEachChild(this.index_,(function(r,i){return t(new e(i,n.ref_.child(r),rr))}))},e.prototype.hasChildren=function(){return qe("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(e.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!1,configurable:!0}),e.prototype.numChildren=function(){return qe("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},e.prototype.getRef=function(){return qe("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(e.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),e}(),wr=function(){function e(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}return e.prototype.getPath=function(){var e=this.snapshot.getRef();return"value"===this.eventType?e.path:e.getParent().path},e.prototype.getEventType=function(){return this.eventType},e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},e.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+Ne(this.snapshot.exportVal())},e}(),Cr=function(){function e(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}return e.prototype.getPath=function(){return this.path},e.prototype.getEventType=function(){return"cancel"},e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},e.prototype.toString=function(){return this.path.toString()+":cancel"},e}(),Tr=function(){function e(e,t,n){this.callback_=e,this.cancelCallback_=t,this.context_=n}return e.prototype.respondsTo=function(e){return"value"===e},e.prototype.createEvent=function(e,t){var n=t.getQueryParams().getIndex();return new wr("value",this,new br(e.snapshotNode,t.getRef(),n))},e.prototype.getEventRunner=function(e){var t=this.context_;if("cancel"===e.getEventType()){le(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(t,e.error)}}var r=this.callback_;return function(){r.call(t,e.snapshot)}},e.prototype.createCancelEvent=function(e,t){return this.cancelCallback_?new Cr(this,e,t):null},e.prototype.matches=function(t){return t instanceof e&&(!t.callback_||!this.callback_||t.callback_===this.callback_&&t.context_===this.context_)},e.prototype.hasAnyCallback=function(){return null!==this.callback_},e}(),Sr=function(){function e(e,t,n){this.callbacks_=e,this.cancelCallback_=t,this.context_=n}return e.prototype.respondsTo=function(e){var t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,xe(this.callbacks_,t)},e.prototype.createCancelEvent=function(e,t){return this.cancelCallback_?new Cr(this,e,t):null},e.prototype.createEvent=function(e,t){le(null!=e.childName,"Child events should have a childName.");var n=t.getRef().child(e.childName),r=t.getQueryParams().getIndex();return new wr(e.type,this,new br(e.snapshotNode,n,r),e.prevName)},e.prototype.getEventRunner=function(e){var t=this.context_;if("cancel"===e.getEventType()){le(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(t,e.error)}}var r=this.callbacks_[e.eventType];return function(){r.call(t,e.snapshot,e.prevName)}},e.prototype.matches=function(t){var n=this;if(t instanceof e){if(!this.callbacks_||!t.callbacks_)return!0;if(this.context_===t.context_){var r=Object.keys(t.callbacks_),i=Object.keys(this.callbacks_),o=r.length;if(o===i.length){if(1===o){var a=r[0],s=i[0];return!(s!==a||t.callbacks_[a]&&this.callbacks_[s]&&t.callbacks_[a]!==this.callbacks_[s])}return i.every((function(e){return t.callbacks_[e]===n.callbacks_[e]}))}}}return!1},e.prototype.hasAnyCallback=function(){return null!==this.callbacks_},e}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Er(e){return{type:"value",snapshotNode:e}}function kr(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function Ir(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function Pr(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Nr,Dr=function(){function e(e){this.index_=e}return e.prototype.updateChild=function(e,t,n,r,i,o){le(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");var a=e.getImmediateChild(t);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()===n.isEmpty()?e:(null!=o&&(n.isEmpty()?e.hasChild(t)?o.trackChildChange(Ir(t,a)):le(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(kr(t,n)):o.trackChildChange(Pr(t,n,a))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))},e.prototype.updateFullNode=function(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(rr,(function(e,r){t.hasChild(e)||n.trackChildChange(Ir(e,r))})),t.isLeafNode()||t.forEachChild(rr,(function(t,r){if(e.hasChild(t)){var i=e.getImmediateChild(t);i.equals(r)||n.trackChildChange(Pr(t,r,i))}else n.trackChildChange(kr(t,r))}))),t.withIndex(this.index_)},e.prototype.updatePriority=function(e,t){return e.isEmpty()?yr.EMPTY_NODE:e.updatePriority(t)},e.prototype.filtersNodes=function(){return!1},e.prototype.getIndexedFilter=function(){return this},e.prototype.getIndex=function(){return this.index_},e}(),xr=function(){function e(t){this.indexedFilter_=new Dr(t.getIndex()),this.index_=t.getIndex(),this.startPost_=e.getStartPost_(t),this.endPost_=e.getEndPost_(t)}return e.prototype.getStartPost=function(){return this.startPost_},e.prototype.getEndPost=function(){return this.endPost_},e.prototype.matches=function(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0},e.prototype.updateChild=function(e,t,n,r,i,o){return this.matches(new Bn(t,n))||(n=yr.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,o)},e.prototype.updateFullNode=function(e,t,n){t.isLeafNode()&&(t=yr.EMPTY_NODE);var r=t.withIndex(this.index_);r=r.updatePriority(yr.EMPTY_NODE);var i=this;return t.forEachChild(rr,(function(e,t){i.matches(new Bn(e,t))||(r=r.updateImmediateChild(e,yr.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(e,r,n)},e.prototype.updatePriority=function(e,t){return e},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.indexedFilter_},e.prototype.getIndex=function(){return this.index_},e.getStartPost_=function(e){if(e.hasStart()){var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()},e.getEndPost_=function(e){if(e.hasEnd()){var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()},e}(),Rr=function(){function e(e){this.rangedFilter_=new xr(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}return e.prototype.updateChild=function(e,t,n,r,i,o){return this.rangedFilter_.matches(new Bn(t,n))||(n=yr.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,o):this.fullLimitUpdateChild_(e,t,n,i,o)},e.prototype.updateFullNode=function(e,t,n){var r;if(t.isLeafNode()||t.isEmpty())r=yr.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){r=yr.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var a=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),a)<=0:this.index_.compare(a,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(a.name,a.node),o++}}else{r=(r=t.withIndex(this.index_)).updatePriority(yr.EMPTY_NODE);var s=void 0,u=void 0,l=void 0;i=void 0;if(this.reverse_){i=r.getReverseIterator(this.index_),s=this.rangedFilter_.getEndPost(),u=this.rangedFilter_.getStartPost();var c=this.index_.getCompare();l=function(e,t){return c(t,e)}}else i=r.getIterator(this.index_),s=this.rangedFilter_.getStartPost(),u=this.rangedFilter_.getEndPost(),l=this.index_.getCompare();o=0;for(var h=!1;i.hasNext();){a=i.getNext();!h&&l(s,a)<=0&&(h=!0),h&&o<this.limit_&&l(a,u)<=0?o++:r=r.updateImmediateChild(a.name,yr.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)},e.prototype.updatePriority=function(e,t){return e},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},e.prototype.getIndex=function(){return this.index_},e.prototype.fullLimitUpdateChild_=function(e,t,n,r,i){var o;if(this.reverse_){var a=this.index_.getCompare();o=function(e,t){return a(t,e)}}else o=this.index_.getCompare();var s=e;le(s.numChildren()===this.limit_,"");var u=new Bn(t,n),l=this.reverse_?s.getFirstChild(this.index_):s.getLastChild(this.index_),c=this.rangedFilter_.matches(u);if(s.hasChild(t)){for(var h=s.getImmediateChild(t),p=r.getChildAfterChild(this.index_,l,this.reverse_);null!=p&&(p.name===t||s.hasChild(p.name));)p=r.getChildAfterChild(this.index_,p,this.reverse_);var d=null==p?1:o(p,u);if(c&&!n.isEmpty()&&d>=0)return null!=i&&i.trackChildChange(Pr(t,n,h)),s.updateImmediateChild(t,n);null!=i&&i.trackChildChange(Ir(t,h));var f=s.updateImmediateChild(t,yr.EMPTY_NODE);return null!=p&&this.rangedFilter_.matches(p)?(null!=i&&i.trackChildChange(kr(p.name,p.node)),f.updateImmediateChild(p.name,p.node)):f}return n.isEmpty()?e:c&&o(l,u)>=0?(null!=i&&(i.trackChildChange(Ir(l.name,l.node)),i.trackChildChange(kr(t,n))),s.updateImmediateChild(t,n).updateImmediateChild(l.name,yr.EMPTY_NODE)):e},e}(),Ar=function(){function e(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=rr}return e.prototype.hasStart=function(){return this.startSet_},e.prototype.hasStartAfter=function(){return this.startAfterSet_},e.prototype.hasEndBefore=function(){return this.endBeforeSet_},e.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_},e.prototype.getIndexStartValue=function(){return le(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},e.prototype.getIndexStartName=function(){return le(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:qt},e.prototype.hasEnd=function(){return this.endSet_},e.prototype.getIndexEndValue=function(){return le(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},e.prototype.getIndexEndName=function(){return le(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Ut},e.prototype.hasLimit=function(){return this.limitSet_},e.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},e.prototype.getLimit=function(){return le(this.limitSet_,"Only valid if limit has been set"),this.limit_},e.prototype.getIndex=function(){return this.index_},e.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},e.prototype.isDefault=function(){return this.loadsAllData()&&this.index_===rr},e.prototype.copy=function(){var t=new e;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t},e}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Or(e,t){var n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="l",n}function Lr(e,t){var n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="r",n}function Mr(e,t,n){var r=e.copy();return r.startSet_=!0,void 0===t&&(t=null),r.indexStartValue_=t,null!=n?(r.startNameSet_=!0,r.indexStartName_=n):(r.startNameSet_=!1,r.indexStartName_=""),r}function Fr(e,t,n){var r;if(e.index_===zn)"string"==typeof t&&(t=Wn(t)),r=Mr(e,t,n);else{r=Mr(e,t,null==n?Ut:Wn(n))}return r.startAfterSet_=!0,r}function jr(e,t,n){var r=e.copy();return r.endSet_=!0,void 0===t&&(t=null),r.indexEndValue_=t,void 0!==n?(r.endNameSet_=!0,r.indexEndName_=n):(r.endNameSet_=!1,r.indexEndName_=""),r}function qr(e,t,n){var r;return e.index_===zn?("string"==typeof t&&(t=Hn(t)),r=jr(e,t,n)):r=jr(e,t,null==n?qt:Hn(n)),r.endBeforeSet_=!0,r}function Ur(e,t){var n=e.copy();return n.index_=t,n}function Qr(e){var t,n={};return e.isDefault()||(e.index_===rr?t="$priority":e.index_===gr?t="$value":e.index_===zn?t="$key":(le(e.index_ instanceof _r,"Unrecognized index type!"),t=e.index_.toString()),n.orderBy=Ne(t),e.startSet_&&(n.startAt=Ne(e.indexStartValue_),e.startNameSet_&&(n.startAt+=","+Ne(e.indexStartName_))),e.endSet_&&(n.endAt=Ne(e.indexEndValue_),e.endNameSet_&&(n.endAt+=","+Ne(e.indexEndName_))),e.limitSet_&&(e.isViewFromLeft()?n.limitToFirst=e.limit_:n.limitToLast=e.limit_)),n}var Vr=function(){function e(e,t,n,r){this.repo=e,this.path=t,this.queryParams_=n,this.orderByCalled_=r}return Object.defineProperty(e,"__referenceConstructor",{get:function(){return le(Nr,"Reference.ts has not been loaded"),Nr},set:function(e){Nr=e},enumerable:!1,configurable:!0}),e.validateQueryEndpoints_=function(e){var t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===zn){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==qt)throw new Error(r);if("string"!=typeof t)throw new Error(i)}if(e.hasEnd()){if(e.getIndexEndName()!==Ut)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(e.getIndex()===rr){if(null!=t&&!In(t)||null!=n&&!In(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(le(e.getIndex()instanceof _r||e.getIndex()===gr,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")},e.validateLimit_=function(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")},e.prototype.validateNoPreviousOrderByCall_=function(e){if(!0===this.orderByCalled_)throw new Error(e+": You can't combine multiple orderBy calls.")},e.prototype.getQueryParams=function(){return this.queryParams_},e.prototype.getRef=function(){return qe("Query.ref",0,0,arguments.length),new e.__referenceConstructor(this.repo,this.path)},e.prototype.on=function(t,n,r,i){qe("Query.on",2,4,arguments.length),Rn("Query.on",1,t,!1),Qe("Query.on",2,n,!1);var o=e.getCancelAndContextArgs_("Query.on",r,i);if("value"===t)this.onValueEvent(n,o.cancel,o.context);else{var a={};a[t]=n,this.onChildEvent(a,o.cancel,o.context)}return n},e.prototype.onValueEvent=function(e,t,n){var r=new Tr(e,t||null,n||null);this.repo.addEventCallbackForQuery(this,r)},e.prototype.onChildEvent=function(e,t,n){var r=new Sr(e,t,n);this.repo.addEventCallbackForQuery(this,r)},e.prototype.off=function(e,t,n){qe("Query.off",0,3,arguments.length),Rn("Query.off",1,e,!0),Qe("Query.off",2,t,!0),Ve("Query.off",3,n,!0);var r=null,i=null;if("value"===e){var o=t||null;r=new Tr(o,null,n||null)}else e&&(t&&((i={})[e]=t),r=new Sr(i,null,n||null));this.repo.removeEventCallbackForQuery(this,r)},e.prototype.get=function(){return this.repo.getValue(this)},e.prototype.once=function(t,n,r,i){var o=this;qe("Query.once",1,4,arguments.length),Rn("Query.once",1,t,!1),Qe("Query.once",2,n,!0);var a=e.getCancelAndContextArgs_("Query.once",r,i),s=!0,u=new me;u.promise.catch((function(){}));var l=function(e){s&&(s=!1,o.off(t,l),n&&n.bind(a.context)(e),u.resolve(e))};return this.on(t,l,(function(e){o.off(t,l),a.cancel&&a.cancel.bind(a.context)(e),u.reject(e)})),u.promise},e.prototype.limitToFirst=function(t){if(qe("Query.limitToFirst",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new e(this.repo,this.path,Or(this.queryParams_,t),this.orderByCalled_)},e.prototype.limitToLast=function(t){if(qe("Query.limitToLast",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new e(this.repo,this.path,Lr(this.queryParams_,t),this.orderByCalled_)},e.prototype.orderByChild=function(t){if(qe("Query.orderByChild",1,1,arguments.length),"$key"===t)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===t)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===t)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');On("Query.orderByChild",1,t,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var n=new Xt(t);if(ln(n))throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var r=new _r(n),i=Ur(this.queryParams_,r);return e.validateQueryEndpoints_(i),new e(this.repo,this.path,i,!0)},e.prototype.orderByKey=function(){qe("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var t=Ur(this.queryParams_,zn);return e.validateQueryEndpoints_(t),new e(this.repo,this.path,t,!0)},e.prototype.orderByPriority=function(){qe("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var t=Ur(this.queryParams_,rr);return e.validateQueryEndpoints_(t),new e(this.repo,this.path,t,!0)},e.prototype.orderByValue=function(){qe("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var t=Ur(this.queryParams_,gr);return e.validateQueryEndpoints_(t),new e(this.repo,this.path,t,!0)},e.prototype.startAt=function(t,n){void 0===t&&(t=null),qe("Query.startAt",0,2,arguments.length),Pn("Query.startAt",1,t,this.path,!0),An("Query.startAt",2,n,!0);var r=Mr(this.queryParams_,t,n);if(e.validateLimit_(r),e.validateQueryEndpoints_(r),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===t&&(t=null,n=null),new e(this.repo,this.path,r,this.orderByCalled_)},e.prototype.startAfter=function(t,n){void 0===t&&(t=null),qe("Query.startAfter",0,2,arguments.length),Pn("Query.startAfter",1,t,this.path,!1),An("Query.startAfter",2,n,!0);var r=Fr(this.queryParams_,t,n);if(e.validateLimit_(r),e.validateQueryEndpoints_(r),this.queryParams_.hasStart())throw new Error("Query.startAfter: Starting point was already set (by another call to startAt, startAfter or equalTo).");return new e(this.repo,this.path,r,this.orderByCalled_)},e.prototype.endAt=function(t,n){void 0===t&&(t=null),qe("Query.endAt",0,2,arguments.length),Pn("Query.endAt",1,t,this.path,!0),An("Query.endAt",2,n,!0);var r=jr(this.queryParams_,t,n);if(e.validateLimit_(r),e.validateQueryEndpoints_(r),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt, endBefore, or equalTo).");return new e(this.repo,this.path,r,this.orderByCalled_)},e.prototype.endBefore=function(t,n){void 0===t&&(t=null),qe("Query.endBefore",0,2,arguments.length),Pn("Query.endBefore",1,t,this.path,!1),An("Query.endBefore",2,n,!0);var r=qr(this.queryParams_,t,n);if(e.validateLimit_(r),e.validateQueryEndpoints_(r),this.queryParams_.hasEnd())throw new Error("Query.endBefore: Ending point was already set (by another call to endAt, endBefore, or equalTo).");return new e(this.repo,this.path,r,this.orderByCalled_)},e.prototype.equalTo=function(e,t){if(qe("Query.equalTo",1,2,arguments.length),Pn("Query.equalTo",1,e,this.path,!1),An("Query.equalTo",2,t,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return this.startAt(e,t).endAt(e,t)},e.prototype.toString=function(){return qe("Query.toString",0,0,arguments.length),this.repo.toString()+on(this.path)},e.prototype.toJSON=function(){return qe("Query.toJSON",0,1,arguments.length),this.toString()},e.prototype.queryObject=function(){return function(e){var t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_)),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_)),e.limitSet_){t.l=e.limit_;var n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==rr&&(t.i=e.index_.toString()),t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(this.queryParams_)},e.prototype.queryIdentifier=function(){var e=this.queryObject(),t=Ht(e);return"{}"===t?"default":t},e.prototype.isEqual=function(t){if(qe("Query.isEqual",1,1,arguments.length),!(t instanceof e)){var n="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(n)}var r=this.repo===t.repo,i=pn(this.path,t.path),o=this.queryIdentifier()===t.queryIdentifier();return r&&i&&o},e.getCancelAndContextArgs_=function(e,t,n){var r={cancel:null,context:null};if(t&&n)r.cancel=t,Qe(e,3,r.cancel,!0),r.context=n,Ve(e,4,r.context,!0);else if(t)if("object"==typeof t&&null!==t)r.context=t;else{if("function"!=typeof t)throw new Error(Ue(e,3,!0)+" must either be a cancel callback or a context object.");r.cancel=t}return r},Object.defineProperty(e.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),e}(),Wr=function(){function e(e){this.node_=e}return e.prototype.getImmediateChild=function(t){return new e(this.node_.getImmediateChild(t))},e.prototype.node=function(){return this.node_},e}(),Hr=function(){function e(e,t){this.syncTree_=e,this.path_=t}return e.prototype.getImmediateChild=function(t){var n=un(this.path_,t);return new e(this.syncTree_,n)},e.prototype.node=function(){return this.syncTree_.calcCompleteEventCache(this.path_)},e}(),Br=function(e,t,n){return e&&"object"==typeof e?(le(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?$r(e[".sv"],t,n):"object"==typeof e[".sv"]?Kr(e[".sv"],t):void le(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},$r=function(e,t,n){switch(e){case"timestamp":return n.timestamp;default:le(!1,"Unexpected server value: "+e)}},Kr=function(e,t,n){e.hasOwnProperty("increment")||le(!1,"Unexpected server value: "+JSON.stringify(e,null,2));var r=e.increment;"number"!=typeof r&&le(!1,"Unexpected increment value: "+r);var i=t.node();if(le(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;var o=i.getValue();return"number"!=typeof o?r:o+r},zr=function(e,t,n,r){return Yr(t,new Hr(n,e),r)},Gr=function(e,t,n){return Yr(e,new Wr(t),n)};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yr(e,t,n){var r,i=e.getPriority().val(),o=Br(i,t.getImmediateChild(".priority"),n);if(e.isLeafNode()){var a=e,s=Br(a.getValue(),t,n);return s!==a.getValue()||o!==a.getPriority().val()?new er(s,vr(o)):e}var u=e;return r=u,o!==u.getPriority().val()&&(r=r.updatePriority(new er(o))),u.forEachChild(rr,(function(e,i){var o=Yr(i,t.getImmediateChild(e),n);o!==i&&(r=r.updateImmediateChild(e,o))})),r}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Jr,Xr,Zr=function(){function e(){this.value=null,this.children=new Map}return e.prototype.find=function(e){if(null!=this.value)return this.value.getChild(e);if(!ln(e)&&this.children.size>0){var t=en(e);return e=nn(e),this.children.has(t)?this.children.get(t).find(e):null}return null},e.prototype.remember=function(t,n){if(ln(t))this.value=n,this.children.clear();else if(null!==this.value)this.value=this.value.updateChild(t,n);else{var r=en(t);this.children.has(r)||this.children.set(r,new e);var i=this.children.get(r);t=nn(t),i.remember(t,n)}},e.prototype.forget=function(e){if(ln(e))return this.value=null,this.children.clear(),!0;if(null!==this.value){if(this.value.isLeafNode())return!1;var t=this.value;this.value=null;var n=this;return t.forEachChild(rr,(function(e,t){n.remember(new Xt(e),t)})),this.forget(e)}if(this.children.size>0){var r=en(e);if(e=nn(e),this.children.has(r))this.children.get(r).forget(e)&&this.children.delete(r);return 0===this.children.size}return!0},e.prototype.forEachTree=function(e,t){null!==this.value?t(e,this.value):this.forEachChild((function(n,r){var i=new Xt(e.toString()+"/"+n);r.forEachTree(i,t)}))},e.prototype.forEachChild=function(e){this.children.forEach((function(t,n){e(n,t)}))},e}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ei(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(Xr=Jr||(Jr={}))[Xr.OVERWRITE=0]="OVERWRITE",Xr[Xr.MERGE=1]="MERGE",Xr[Xr.ACK_USER_WRITE=2]="ACK_USER_WRITE",Xr[Xr.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";var ti,ni=function(){function e(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=Jr.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}return e.prototype.operationForChild=function(t){if(ln(this.path)){if(null!=this.affectedTree.value)return le(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var n=this.affectedTree.subtree(new Xt(t));return new e(Zt(),n,this.revert)}return le(en(this.path)===t,"operationForChild called for unrelated child."),new e(nn(this.path),this.affectedTree,this.revert)},e}(),ri=function(){function e(e,t){void 0===t&&(ti||(ti=new sr(Vt)),t=ti),this.value=e,this.children=t}return e.fromObject=function(t){var n=new e(null);return $t(t,(function(e,t){n=n.set(new Xt(e),t)})),n},e.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},e.prototype.findRootMostMatchingPathAndValue=function(e,t){if(null!=this.value&&t(this.value))return{path:Zt(),value:this.value};if(ln(e))return null;var n=en(e),r=this.children.get(n);if(null!==r){var i=r.findRootMostMatchingPathAndValue(nn(e),t);return null!=i?{path:un(new Xt(n),i.path),value:i.value}:null}return null},e.prototype.findRootMostValueAndPath=function(e){return this.findRootMostMatchingPathAndValue(e,(function(){return!0}))},e.prototype.subtree=function(t){if(ln(t))return this;var n=en(t),r=this.children.get(n);return null!==r?r.subtree(nn(t)):new e(null)},e.prototype.set=function(t,n){if(ln(t))return new e(n,this.children);var r=en(t),i=(this.children.get(r)||new e(null)).set(nn(t),n),o=this.children.insert(r,i);return new e(this.value,o)},e.prototype.remove=function(t){if(ln(t))return this.children.isEmpty()?new e(null):new e(null,this.children);var n=en(t),r=this.children.get(n);if(r){var i=r.remove(nn(t)),o=void 0;return o=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&o.isEmpty()?new e(null):new e(this.value,o)}return this},e.prototype.get=function(e){if(ln(e))return this.value;var t=en(e),n=this.children.get(t);return n?n.get(nn(e)):null},e.prototype.setTree=function(t,n){if(ln(t))return n;var r=en(t),i=(this.children.get(r)||new e(null)).setTree(nn(t),n),o=void 0;return o=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),new e(this.value,o)},e.prototype.fold=function(e){return this.fold_(Zt(),e)},e.prototype.fold_=function(e,t){var n={};return this.children.inorderTraversal((function(r,i){n[r]=i.fold_(un(e,r),t)})),t(e,this.value,n)},e.prototype.findOnPath=function(e,t){return this.findOnPath_(e,Zt(),t)},e.prototype.findOnPath_=function(e,t,n){var r=!!this.value&&n(t,this.value);if(r)return r;if(ln(e))return null;var i=en(e),o=this.children.get(i);return o?o.findOnPath_(nn(e),un(t,i),n):null},e.prototype.foreachOnPath=function(e,t){return this.foreachOnPath_(e,Zt(),t)},e.prototype.foreachOnPath_=function(t,n,r){if(ln(t))return this;this.value&&r(n,this.value);var i=en(t),o=this.children.get(i);return o?o.foreachOnPath_(nn(t),un(n,i),r):new e(null)},e.prototype.foreach=function(e){this.foreach_(Zt(),e)},e.prototype.foreach_=function(e,t){this.children.inorderTraversal((function(n,r){r.foreach_(un(e,n),t)})),this.value&&t(e,this.value)},e.prototype.foreachChild=function(e){this.children.inorderTraversal((function(t,n){n.value&&e(t,n.value)}))},e}(),ii=function(){function e(e,t){this.source=e,this.path=t,this.type=Jr.LISTEN_COMPLETE}return e.prototype.operationForChild=function(t){return ln(this.path)?new e(this.source,Zt()):new e(this.source,nn(this.path))},e}(),oi=function(){function e(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=Jr.OVERWRITE}return e.prototype.operationForChild=function(t){return ln(this.path)?new e(this.source,Zt(),this.snap.getImmediateChild(t)):new e(this.source,nn(this.path),this.snap)},e}(),ai=function(){function e(e,t,n){this.source=e,this.path=t,this.children=n,this.type=Jr.MERGE}return e.prototype.operationForChild=function(t){if(ln(this.path)){var n=this.children.subtree(new Xt(t));return n.isEmpty()?null:n.value?new oi(this.source,Zt(),n.value):new e(this.source,Zt(),n)}return le(en(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new e(this.source,nn(this.path),this.children)},e.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},e}(),si=function(){function e(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}return e.prototype.isFullyInitialized=function(){return this.fullyInitialized_},e.prototype.isFiltered=function(){return this.filtered_},e.prototype.isCompleteForPath=function(e){if(ln(e))return this.isFullyInitialized()&&!this.filtered_;var t=en(e);return this.isCompleteForChild(t)},e.prototype.isCompleteForChild=function(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)},e.prototype.getNode=function(){return this.node_},e}(),ui=function(){function e(e,t){this.eventCache_=e,this.serverCache_=t}return e.prototype.updateEventSnap=function(t,n,r){return new e(new si(t,n,r),this.serverCache_)},e.prototype.updateServerSnap=function(t,n,r){return new e(this.eventCache_,new si(t,n,r))},e.prototype.getEventCache=function(){return this.eventCache_},e.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},e.prototype.getServerCache=function(){return this.serverCache_},e.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},e}(),li=function(){function e(){this.changeMap=new Map}return e.prototype.trackChildChange=function(e){var t=e.type,n=e.childName;le("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),le(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,Pr(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,Ir(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,kr(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw ce("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,Pr(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)},e.prototype.getChanges=function(){return Array.from(this.changeMap.values())},e}(),ci=new(function(){function e(){}return e.prototype.getCompleteChild=function(e){return null},e.prototype.getChildAfterChild=function(e,t,n){return null},e}()),hi=function(){function e(e,t,n){void 0===n&&(n=null),this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}return e.prototype.getCompleteChild=function(e){var t=this.viewCache_.getEventCache();if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var n=null!=this.optCompleteServerCache_?new si(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(e,n)},e.prototype.getChildAfterChild=function(e,t,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),i=this.writes_.calcIndexedSlice(r,t,1,n,e);return 0===i.length?null:i[0]},e}(),pi=function(e,t){this.viewCache=e,this.changes=t},di=function(){function e(e){this.filter_=e}return e.prototype.assertIndexed=function(e){le(e.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),le(e.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},e.prototype.applyOperation=function(t,n,r,i){var o,a,s=new li;if(n.type===Jr.OVERWRITE){var u=n;u.source.fromUser?o=this.applyUserOverwrite_(t,u.path,u.snap,r,i,s):(le(u.source.fromServer,"Unknown source."),a=u.source.tagged||t.getServerCache().isFiltered()&&!ln(u.path),o=this.applyServerOverwrite_(t,u.path,u.snap,r,i,a,s))}else if(n.type===Jr.MERGE){var l=n;l.source.fromUser?o=this.applyUserMerge_(t,l.path,l.children,r,i,s):(le(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.getServerCache().isFiltered(),o=this.applyServerMerge_(t,l.path,l.children,r,i,a,s))}else if(n.type===Jr.ACK_USER_WRITE){var c=n;o=c.revert?this.revertUserWrite_(t,c.path,r,i,s):this.ackUserWrite_(t,c.path,c.affectedTree,r,i,s)}else{if(n.type!==Jr.LISTEN_COMPLETE)throw ce("Unknown operation type: "+n.type);o=this.listenComplete_(t,n.path,r,s)}var h=s.getChanges();return e.maybeAddValueEvent_(t,o,h),new pi(o,h)},e.maybeAddValueEvent_=function(e,t,n){var r=t.getEventCache();if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=e.getCompleteEventSnap();(n.length>0||!e.getEventCache().isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(Er(t.getCompleteEventSnap()))}},e.prototype.generateEventCacheAfterServerEvent_=function(e,t,n,r,i){var o=e.getEventCache();if(null!=n.shadowingWrite(t))return e;var a=void 0,s=void 0;if(ln(t))if(le(e.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),e.getServerCache().isFiltered()){var u=e.getCompleteServerSnap(),l=u instanceof yr?u:yr.EMPTY_NODE,c=n.calcCompleteEventChildren(l);a=this.filter_.updateFullNode(e.getEventCache().getNode(),c,i)}else{var h=n.calcCompleteEventCache(e.getCompleteServerSnap());a=this.filter_.updateFullNode(e.getEventCache().getNode(),h,i)}else{var p=en(t);if(".priority"===p){le(1===tn(t),"Can't have a priority with additional path components");var d=o.getNode();s=e.getServerCache().getNode();var f=n.calcEventCacheAfterServerOverwrite(t,d,s);a=null!=f?this.filter_.updatePriority(d,f):o.getNode()}else{var y=nn(t),m=void 0;if(o.isCompleteForChild(p)){s=e.getServerCache().getNode();var v=n.calcEventCacheAfterServerOverwrite(t,o.getNode(),s);m=null!=v?o.getNode().getImmediateChild(p).updateChild(y,v):o.getNode().getImmediateChild(p)}else m=n.calcCompleteChild(p,e.getServerCache());a=null!=m?this.filter_.updateChild(o.getNode(),p,m,y,r,i):o.getNode()}}return e.updateEventSnap(a,o.isFullyInitialized()||ln(t),this.filter_.filtersNodes())},e.prototype.applyServerOverwrite_=function(e,t,n,r,i,o,a){var s,u=e.getServerCache(),l=o?this.filter_:this.filter_.getIndexedFilter();if(ln(t))s=l.updateFullNode(u.getNode(),n,null);else if(l.filtersNodes()&&!u.isFiltered()){var c=u.getNode().updateChild(t,n);s=l.updateFullNode(u.getNode(),c,null)}else{var h=en(t);if(!u.isCompleteForPath(t)&&tn(t)>1)return e;var p=nn(t),d=u.getNode().getImmediateChild(h).updateChild(p,n);s=".priority"===h?l.updatePriority(u.getNode(),d):l.updateChild(u.getNode(),h,d,p,ci,null)}var f=e.updateServerSnap(s,u.isFullyInitialized()||ln(t),l.filtersNodes()),y=new hi(r,f,i);return this.generateEventCacheAfterServerEvent_(f,t,r,y,a)},e.prototype.applyUserOverwrite_=function(e,t,n,r,i,o){var a,s,u=e.getEventCache(),l=new hi(r,e,i);if(ln(t))s=this.filter_.updateFullNode(e.getEventCache().getNode(),n,o),a=e.updateEventSnap(s,!0,this.filter_.filtersNodes());else{var c=en(t);if(".priority"===c)s=this.filter_.updatePriority(e.getEventCache().getNode(),n),a=e.updateEventSnap(s,u.isFullyInitialized(),u.isFiltered());else{var h=nn(t),p=u.getNode().getImmediateChild(c),d=void 0;if(ln(h))d=n;else{var f=l.getCompleteChild(c);d=null!=f?".priority"===rn(h)&&f.getChild(sn(h)).isEmpty()?f:f.updateChild(h,n):yr.EMPTY_NODE}if(p.equals(d))a=e;else{var y=this.filter_.updateChild(u.getNode(),c,d,h,l,o);a=e.updateEventSnap(y,u.isFullyInitialized(),this.filter_.filtersNodes())}}}return a},e.cacheHasChild_=function(e,t){return e.getEventCache().isCompleteForChild(t)},e.prototype.applyUserMerge_=function(t,n,r,i,o,a){var s=this,u=t;return r.foreach((function(r,l){var c=un(n,r);e.cacheHasChild_(t,en(c))&&(u=s.applyUserOverwrite_(u,c,l,i,o,a))})),r.foreach((function(r,l){var c=un(n,r);e.cacheHasChild_(t,en(c))||(u=s.applyUserOverwrite_(u,c,l,i,o,a))})),u},e.prototype.applyMerge_=function(e,t){return t.foreach((function(t,n){e=e.updateChild(t,n)})),e},e.prototype.applyServerMerge_=function(e,t,n,r,i,o,a){var s=this;if(e.getServerCache().getNode().isEmpty()&&!e.getServerCache().isFullyInitialized())return e;var u,l=e;u=ln(t)?n:new ri(null).setTree(t,n);var c=e.getServerCache().getNode();return u.children.inorderTraversal((function(t,n){if(c.hasChild(t)){var u=e.getServerCache().getNode().getImmediateChild(t),h=s.applyMerge_(u,n);l=s.applyServerOverwrite_(l,new Xt(t),h,r,i,o,a)}})),u.children.inorderTraversal((function(t,n){var u=!e.getServerCache().isCompleteForChild(t)&&null==n.value;if(!c.hasChild(t)&&!u){var h=e.getServerCache().getNode().getImmediateChild(t),p=s.applyMerge_(h,n);l=s.applyServerOverwrite_(l,new Xt(t),p,r,i,o,a)}})),l},e.prototype.ackUserWrite_=function(e,t,n,r,i,o){if(null!=r.shadowingWrite(t))return e;var a=e.getServerCache().isFiltered(),s=e.getServerCache();if(null!=n.value){if(ln(t)&&s.isFullyInitialized()||s.isCompleteForPath(t))return this.applyServerOverwrite_(e,t,s.getNode().getChild(t),r,i,a,o);if(ln(t)){var u=new ri(null);return s.getNode().forEachChild(zn,(function(e,t){u=u.set(new Xt(e),t)})),this.applyServerMerge_(e,t,u,r,i,a,o)}return e}var l=new ri(null);return n.foreach((function(e,n){var r=un(t,e);s.isCompleteForPath(r)&&(l=l.set(e,s.getNode().getChild(r)))})),this.applyServerMerge_(e,t,l,r,i,a,o)},e.prototype.listenComplete_=function(e,t,n,r){var i=e.getServerCache(),o=e.updateServerSnap(i.getNode(),i.isFullyInitialized()||ln(t),i.isFiltered());return this.generateEventCacheAfterServerEvent_(o,t,n,ci,r)},e.prototype.revertUserWrite_=function(e,t,n,r,i){var o;if(null!=n.shadowingWrite(t))return e;var a=new hi(n,e,r),s=e.getEventCache().getNode(),u=void 0;if(ln(t)||".priority"===en(t)){var l=void 0;if(e.getServerCache().isFullyInitialized())l=n.calcCompleteEventCache(e.getCompleteServerSnap());else{var c=e.getServerCache().getNode();le(c instanceof yr,"serverChildren would be complete if leaf node"),l=n.calcCompleteEventChildren(c)}l=l,u=this.filter_.updateFullNode(s,l,i)}else{var h=en(t),p=n.calcCompleteChild(h,e.getServerCache());null==p&&e.getServerCache().isCompleteForChild(h)&&(p=s.getImmediateChild(h)),(u=null!=p?this.filter_.updateChild(s,h,p,nn(t),a,i):e.getEventCache().getNode().hasChild(h)?this.filter_.updateChild(s,h,yr.EMPTY_NODE,nn(t),a,i):s).isEmpty()&&e.getServerCache().isFullyInitialized()&&(o=n.calcCompleteEventCache(e.getCompleteServerSnap())).isLeafNode()&&(u=this.filter_.updateFullNode(u,o,i))}return o=e.getServerCache().isFullyInitialized()||null!=n.shadowingWrite(Zt()),e.updateEventSnap(u,o,this.filter_.filtersNodes())},e}(),fi=function(e){this.query_=e,this.index_=this.query_.getQueryParams().getIndex()};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yi(e,t,n,r,i,o){var a=r.filter((function(e){return e.type===n}));a.sort((function(t,n){return function(e,t,n){if(null==t.childName||null==n.childName)throw ce("Should only compare child_ events.");var r=new Bn(t.childName,t.snapshotNode),i=new Bn(n.childName,n.snapshotNode);return e.index_.compare(r,i)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e,t,n)})),a.forEach((function(n){var r=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,o);i.forEach((function(i){i.respondsTo(n.type)&&t.push(i.createEvent(r,e.query_))}))}))}var mi,vi=function(){function e(e,t){this.query_=e,this.eventRegistrations_=[];var n,r=this.query_.getQueryParams(),i=new Dr(r.getIndex()),o=(n=r).loadsAllData()?new Dr(n.getIndex()):n.hasLimit()?new Rr(n):new xr(n);this.processor_=new di(o);var a=t.getServerCache(),s=t.getEventCache(),u=i.updateFullNode(yr.EMPTY_NODE,a.getNode(),null),l=o.updateFullNode(yr.EMPTY_NODE,s.getNode(),null),c=new si(u,a.isFullyInitialized(),i.filtersNodes()),h=new si(l,s.isFullyInitialized(),o.filtersNodes());this.viewCache_=new ui(h,c),this.eventGenerator_=new fi(this.query_)}return e.prototype.getQuery=function(){return this.query_},e.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},e.prototype.getCompleteNode=function(){return this.viewCache_.getCompleteEventSnap()},e.prototype.getCompleteServerCache=function(e){var t=this.viewCache_.getCompleteServerSnap();return t&&(this.query_.getQueryParams().loadsAllData()||!ln(e)&&!t.getImmediateChild(en(e)).isEmpty())?t.getChild(e):null},e.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},e.prototype.addEventRegistration=function(e){this.eventRegistrations_.push(e)},e.prototype.removeEventRegistration=function(e,t){var n=[];if(t){le(null==e,"A cancel should cancel all event registrations.");var r=this.query_.path;this.eventRegistrations_.forEach((function(e){var i=e.createCancelEvent(t,r);i&&n.push(i)}))}if(e){for(var i=[],o=0;o<this.eventRegistrations_.length;++o){var a=this.eventRegistrations_[o];if(a.matches(e)){if(e.hasAnyCallback()){i=i.concat(this.eventRegistrations_.slice(o+1));break}}else i.push(a)}this.eventRegistrations_=i}else this.eventRegistrations_=[];return n},e.prototype.applyOperation=function(e,t,n){e.type===Jr.MERGE&&null!==e.source.queryId&&(le(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),le(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var r=this.viewCache_,i=this.processor_.applyOperation(r,e,t,n);return this.processor_.assertIndexed(i.viewCache),le(i.viewCache.getServerCache().isFullyInitialized()||!r.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=i.viewCache,this.generateEventsForChanges_(i.changes,i.viewCache.getEventCache().getNode(),null)},e.prototype.getInitialEvents=function(e){var t=this.viewCache_.getEventCache(),n=[];t.getNode().isLeafNode()||t.getNode().forEachChild(rr,(function(e,t){n.push(kr(e,t))}));return t.isFullyInitialized()&&n.push(Er(t.getNode())),this.generateEventsForChanges_(n,t.getNode(),e)},e.prototype.generateEventsForChanges_=function(e,t,n){var r=n?[n]:this.eventRegistrations_;return function(e,t,n,r){var i=[],o=[];return t.forEach((function(t){var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))})),yi(e,i,"child_removed",t,r,n),yi(e,i,"child_added",t,r,n),yi(e,i,"child_moved",o,r,n),yi(e,i,"child_changed",t,r,n),yi(e,i,"value",t,r,n),i}(this.eventGenerator_,e,t,r)},e}(),gi=function(){function e(){this.views=new Map}return Object.defineProperty(e,"__referenceConstructor",{get:function(){return le(mi,"Reference.ts has not been loaded"),mi},set:function(e){le(!mi,"__referenceConstructor has already been defined"),mi=e},enumerable:!1,configurable:!0}),e.prototype.isEmpty=function(){return 0===this.views.size},e.prototype.applyOperation=function(e,t,n){var r,i,o=e.source.queryId;if(null!==o){var a=this.views.get(o);return le(null!=a,"SyncTree gave us an op for an invalid query."),a.applyOperation(e,t,n)}var s=[];try{for(var u=ie(this.views.values()),l=u.next();!l.done;l=u.next()){a=l.value;s=s.concat(a.applyOperation(e,t,n))}}catch(c){r={error:c}}finally{try{l&&!l.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}return s},e.prototype.getView=function(e,t,n,r){var i=e.queryIdentifier(),o=this.views.get(i);if(!o){var a=t.calcCompleteEventCache(r?n:null),s=!1;a?s=!0:n instanceof yr?(a=t.calcCompleteEventChildren(n),s=!1):(a=yr.EMPTY_NODE,s=!1);var u=new ui(new si(a,s,!1),new si(n,r,!1));return new vi(e,u)}return o},e.prototype.addEventRegistration=function(e,t,n,r,i){var o=this.getView(e,n,r,i);return this.views.has(e.queryIdentifier())||this.views.set(e.queryIdentifier(),o),o.addEventRegistration(t),o.getInitialEvents(t)},e.prototype.removeEventRegistration=function(t,n,r){var i,o,a=t.queryIdentifier(),s=[],u=[],l=this.hasCompleteView();if("default"===a)try{for(var c=ie(this.views.entries()),h=c.next();!h.done;h=c.next()){var p=oe(h.value,2),d=p[0],f=p[1];u=u.concat(f.removeEventRegistration(n,r)),f.isEmpty()&&(this.views.delete(d),f.getQuery().getQueryParams().loadsAllData()||s.push(f.getQuery()))}}catch(y){i={error:y}}finally{try{h&&!h.done&&(o=c.return)&&o.call(c)}finally{if(i)throw i.error}}else(f=this.views.get(a))&&(u=u.concat(f.removeEventRegistration(n,r)),f.isEmpty()&&(this.views.delete(a),f.getQuery().getQueryParams().loadsAllData()||s.push(f.getQuery())));return l&&!this.hasCompleteView()&&s.push(new e.__referenceConstructor(t.repo,t.path)),{removed:s,events:u}},e.prototype.getQueryViews=function(){var e,t,n=[];try{for(var r=ie(this.views.values()),i=r.next();!i.done;i=r.next()){var o=i.value;o.getQuery().getQueryParams().loadsAllData()||n.push(o)}}catch(a){e={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},e.prototype.getCompleteServerCache=function(e){var t,n,r=null;try{for(var i=ie(this.views.values()),o=i.next();!o.done;o=i.next()){var a=o.value;r=r||a.getCompleteServerCache(e)}}catch(s){t={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r},e.prototype.viewForQuery=function(e){if(e.getQueryParams().loadsAllData())return this.getCompleteView();var t=e.queryIdentifier();return this.views.get(t)},e.prototype.viewExistsForQuery=function(e){return null!=this.viewForQuery(e)},e.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},e.prototype.getCompleteView=function(){var e,t;try{for(var n=ie(this.views.values()),r=n.next();!r.done;r=n.next()){var i=r.value;if(i.getQuery().getQueryParams().loadsAllData())return i}}catch(o){e={error:o}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return null},e}(),_i=function(){function e(e){this.writeTree_=e}return e.empty=function(){return new e(new ri(null))},e}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bi(e,t,n){if(ln(t))return new _i(new ri(n));var r=e.writeTree_.findRootMostValueAndPath(t);if(null!=r){var i=r.path,o=r.value,a=cn(i,t);return o=o.updateChild(a,n),new _i(e.writeTree_.set(i,o))}var s=new ri(n),u=e.writeTree_.setTree(t,s);return new _i(u)}function wi(e,t,n){var r=e;return $t(n,(function(e,n){r=bi(r,un(t,e),n)})),r}function Ci(e,t){if(ln(t))return _i.empty();var n=e.writeTree_.setTree(t,new ri(null));return new _i(n)}function Ti(e,t){return null!=Si(e,t)}function Si(e,t){var n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(cn(n.path,t)):null}function Ei(e){var t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(rr,(function(e,n){t.push(new Bn(e,n))})):e.writeTree_.children.inorderTraversal((function(e,n){null!=n.value&&t.push(new Bn(e,n.value))})),t}function ki(e,t){if(ln(t))return e;var n=Si(e,t);return new _i(null!=n?new ri(n):e.writeTree_.subtree(t))}function Ii(e){return e.writeTree_.isEmpty()}function Pi(e,t){return Ni(Zt(),e.writeTree_,t)}function Ni(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);var r=null;return t.children.inorderTraversal((function(t,i){".priority"===t?(le(null!==i.value,"Priority writes must always be leaf nodes"),r=i.value):n=Ni(un(e,t),i,n)})),n.getChild(e).isEmpty()||null===r||(n=n.updateChild(un(e,".priority"),r)),n}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Di=function(){function e(){this.visibleWrites_=_i.empty(),this.allWrites_=[],this.lastWriteId_=-1}return e.prototype.childWrites=function(e){return new xi(e,this)},e.prototype.addOverwrite=function(e,t,n,r){le(n>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),this.allWrites_.push({path:e,snap:t,writeId:n,visible:r}),r&&(this.visibleWrites_=bi(this.visibleWrites_,e,t)),this.lastWriteId_=n},e.prototype.addMerge=function(e,t,n){le(n>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:e,children:t,writeId:n,visible:!0}),this.visibleWrites_=wi(this.visibleWrites_,e,t),this.lastWriteId_=n},e.prototype.getWrite=function(e){for(var t=0;t<this.allWrites_.length;t++){var n=this.allWrites_[t];if(n.writeId===e)return n}return null},e.prototype.removeWrite=function(e){var t=this,n=this.allWrites_.findIndex((function(t){return t.writeId===e}));le(n>=0,"removeWrite called with nonexistent writeId.");var r=this.allWrites_[n];this.allWrites_.splice(n,1);for(var i=r.visible,o=!1,a=this.allWrites_.length-1;i&&a>=0;){var s=this.allWrites_[a];s.visible&&(a>=n&&this.recordContainsPath_(s,r.path)?i=!1:dn(r.path,s.path)&&(o=!0)),a--}if(i){if(o)return this.resetTree_(),!0;r.snap?this.visibleWrites_=Ci(this.visibleWrites_,r.path):$t(r.children,(function(e){t.visibleWrites_=Ci(t.visibleWrites_,un(r.path,e))}));return!0}return!1},e.prototype.getCompleteWriteData=function(e){return Si(this.visibleWrites_,e)},e.prototype.calcCompleteEventCache=function(t,n,r,i){if(r||i){var o=ki(this.visibleWrites_,t);if(!i&&Ii(o))return n;if(i||null!=n||Ti(o,Zt())){return Pi(e.layerTree_(this.allWrites_,(function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(dn(e.path,t)||dn(t,e.path))}),t),n||yr.EMPTY_NODE)}return null}var a=Si(this.visibleWrites_,t);if(null!=a)return a;var s=ki(this.visibleWrites_,t);return Ii(s)?n:null!=n||Ti(s,Zt())?Pi(s,n||yr.EMPTY_NODE):null},e.prototype.calcCompleteEventChildren=function(e,t){var n=yr.EMPTY_NODE,r=Si(this.visibleWrites_,e);if(r)return r.isLeafNode()||r.forEachChild(rr,(function(e,t){n=n.updateImmediateChild(e,t)})),n;if(t){var i=ki(this.visibleWrites_,e);return t.forEachChild(rr,(function(e,t){var r=Pi(ki(i,new Xt(e)),t);n=n.updateImmediateChild(e,r)})),Ei(i).forEach((function(e){n=n.updateImmediateChild(e.name,e.node)})),n}return Ei(ki(this.visibleWrites_,e)).forEach((function(e){n=n.updateImmediateChild(e.name,e.node)})),n},e.prototype.calcEventCacheAfterServerOverwrite=function(e,t,n,r){le(n||r,"Either existingEventSnap or existingServerSnap must exist");var i=un(e,t);if(Ti(this.visibleWrites_,i))return null;var o=ki(this.visibleWrites_,i);return Ii(o)?r.getChild(t):Pi(o,r.getChild(t))},e.prototype.calcCompleteChild=function(e,t,n){var r=un(e,t),i=Si(this.visibleWrites_,r);return null!=i?i:n.isCompleteForChild(t)?Pi(ki(this.visibleWrites_,r),n.getNode().getImmediateChild(t)):null},e.prototype.shadowingWrite=function(e){return Si(this.visibleWrites_,e)},e.prototype.calcIndexedSlice=function(e,t,n,r,i,o){var a,s=ki(this.visibleWrites_,e),u=Si(s,Zt());if(null!=u)a=u;else{if(null==t)return[];a=Pi(s,t)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];for(var l=[],c=o.getCompare(),h=i?a.getReverseIteratorFrom(n,o):a.getIteratorFrom(n,o),p=h.getNext();p&&l.length<r;)0!==c(p,n)&&l.push(p),p=h.getNext();return l},e.prototype.recordContainsPath_=function(e,t){if(e.snap)return dn(e.path,t);for(var n in e.children)if(e.children.hasOwnProperty(n)&&dn(un(e.path,n),t))return!0;return!1},e.prototype.resetTree_=function(){this.visibleWrites_=e.layerTree_(this.allWrites_,e.DefaultFilter_,Zt()),this.allWrites_.length>0?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},e.DefaultFilter_=function(e){return e.visible},e.layerTree_=function(e,t,n){for(var r=_i.empty(),i=0;i<e.length;++i){var o=e[i];if(t(o)){var a=o.path,s=void 0;if(o.snap)dn(n,a)?r=bi(r,s=cn(n,a),o.snap):dn(a,n)&&(s=cn(a,n),r=bi(r,Zt(),o.snap.getChild(s)));else{if(!o.children)throw ce("WriteRecord should have .snap or .children");if(dn(n,a))r=wi(r,s=cn(n,a),o.children);else if(dn(a,n))if(ln(s=cn(a,n)))r=wi(r,Zt(),o.children);else{var u=Re(o.children,en(s));if(u){var l=u.getChild(nn(s));r=bi(r,Zt(),l)}}}}}return r},e}(),xi=function(){function e(e,t){this.treePath_=e,this.writeTree_=t}return e.prototype.calcCompleteEventCache=function(e,t,n){return this.writeTree_.calcCompleteEventCache(this.treePath_,e,t,n)},e.prototype.calcCompleteEventChildren=function(e){return this.writeTree_.calcCompleteEventChildren(this.treePath_,e)},e.prototype.calcEventCacheAfterServerOverwrite=function(e,t,n){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,e,t,n)},e.prototype.shadowingWrite=function(e){return this.writeTree_.shadowingWrite(un(this.treePath_,e))},e.prototype.calcIndexedSlice=function(e,t,n,r,i){return this.writeTree_.calcIndexedSlice(this.treePath_,e,t,n,r,i)},e.prototype.calcCompleteChild=function(e,t){return this.writeTree_.calcCompleteChild(this.treePath_,e,t)},e.prototype.child=function(t){return new e(un(this.treePath_,t),this.writeTree_)},e}(),Ri=function(){function e(e){this.listenProvider_=e,this.syncPointTree_=new ri(null),this.pendingWriteTree_=new Di,this.tagToQueryMap=new Map,this.queryToTagMap=new Map}return e.prototype.applyUserOverwrite=function(e,t,n,r){return this.pendingWriteTree_.addOverwrite(e,t,n,r),r?this.applyOperationToSyncPoints_(new oi({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},e,t)):[]},e.prototype.applyUserMerge=function(e,t,n){this.pendingWriteTree_.addMerge(e,t,n);var r=ri.fromObject(t);return this.applyOperationToSyncPoints_(new ai({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},e,r))},e.prototype.ackUserWrite=function(e,t){void 0===t&&(t=!1);var n=this.pendingWriteTree_.getWrite(e);if(this.pendingWriteTree_.removeWrite(e)){var r=new ri(null);return null!=n.snap?r=r.set(Zt(),!0):$t(n.children,(function(e){r=r.set(new Xt(e),!0)})),this.applyOperationToSyncPoints_(new ni(n.path,r,t))}return[]},e.prototype.applyServerOverwrite=function(e,t){return this.applyOperationToSyncPoints_(new oi({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e,t))},e.prototype.applyServerMerge=function(e,t){var n=ri.fromObject(t);return this.applyOperationToSyncPoints_(new ai({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e,n))},e.prototype.applyListenComplete=function(e){return this.applyOperationToSyncPoints_(new ii({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e))},e.prototype.applyTaggedQueryOverwrite=function(t,n,r){var i=this.queryKeyForTag_(r);if(null!=i){var o=e.parseQueryKey_(i),a=o.path,s=o.queryId,u=cn(a,t),l=new oi(ei(s),u,n);return this.applyTaggedOperation_(a,l)}return[]},e.prototype.applyTaggedQueryMerge=function(t,n,r){var i=this.queryKeyForTag_(r);if(i){var o=e.parseQueryKey_(i),a=o.path,s=o.queryId,u=cn(a,t),l=ri.fromObject(n),c=new ai(ei(s),u,l);return this.applyTaggedOperation_(a,c)}return[]},e.prototype.applyTaggedListenComplete=function(t,n){var r=this.queryKeyForTag_(n);if(r){var i=e.parseQueryKey_(r),o=i.path,a=i.queryId,s=cn(o,t),u=new ii(ei(a),s);return this.applyTaggedOperation_(o,u)}return[]},e.prototype.addEventRegistration=function(t,n){var r=t.path,i=null,o=!1;this.syncPointTree_.foreachOnPath(r,(function(e,t){var n=cn(e,r);i=i||t.getCompleteServerCache(n),o=o||t.hasCompleteView()}));var a,s=this.syncPointTree_.get(r);(s?(o=o||s.hasCompleteView(),i=i||s.getCompleteServerCache(Zt())):(s=new gi,this.syncPointTree_=this.syncPointTree_.set(r,s)),null!=i)?a=!0:(a=!1,i=yr.EMPTY_NODE,this.syncPointTree_.subtree(r).foreachChild((function(e,t){var n=t.getCompleteServerCache(Zt());n&&(i=i.updateImmediateChild(e,n))})));var u=s.viewExistsForQuery(t);if(!u&&!t.getQueryParams().loadsAllData()){var l=e.makeQueryKey_(t);le(!this.queryToTagMap.has(l),"View does not exist, but we have a tag");var c=e.getNextQueryTag_();this.queryToTagMap.set(l,c),this.tagToQueryMap.set(c,l)}var h=this.pendingWriteTree_.childWrites(r),p=s.addEventRegistration(t,n,h,i,a);if(!u&&!o){var d=s.viewForQuery(t);p=p.concat(this.setupListener_(t,d))}return p},e.prototype.removeEventRegistration=function(t,n,r){var i=this,o=t.path,a=this.syncPointTree_.get(o),s=[];if(a&&("default"===t.queryIdentifier()||a.viewExistsForQuery(t))){var u=a.removeEventRegistration(t,n,r);a.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(o));var l=u.removed;s=u.events;var c=-1!==l.findIndex((function(e){return e.getQueryParams().loadsAllData()})),h=this.syncPointTree_.findOnPath(o,(function(e,t){return t.hasCompleteView()}));if(c&&!h){var p=this.syncPointTree_.subtree(o);if(!p.isEmpty())for(var d=this.collectDistinctViewsForSubTree_(p),f=0;f<d.length;++f){var y=d[f],m=y.getQuery(),v=this.createListenerForView_(y);this.listenProvider_.startListening(e.queryForListening_(m),this.tagForQuery_(m),v.hashFn,v.onComplete)}}if(!h&&l.length>0&&!r)if(c){this.listenProvider_.stopListening(e.queryForListening_(t),null)}else l.forEach((function(t){var n=i.queryToTagMap.get(e.makeQueryKey_(t));i.listenProvider_.stopListening(e.queryForListening_(t),n)}));this.removeTags_(l)}return s},e.prototype.calcCompleteEventCache=function(e,t){var n=this.pendingWriteTree_,r=this.syncPointTree_.findOnPath(e,(function(t,n){var r=cn(t,e),i=n.getCompleteServerCache(r);if(i)return i}));return n.calcCompleteEventCache(e,r,t,!0)},e.prototype.getServerValue=function(e){var t=e.path,n=null;this.syncPointTree_.foreachOnPath(t,(function(e,r){var i=cn(e,t);n=n||r.getCompleteServerCache(i)}));var r=this.syncPointTree_.get(t);r?n=n||r.getCompleteServerCache(Zt()):(r=new gi,this.syncPointTree_=this.syncPointTree_.set(t,r));var i=null!=n,o=i?new si(n,!0,!1):null,a=this.pendingWriteTree_.childWrites(e.path);return r.getView(e,a,i?o.getNode():yr.EMPTY_NODE,i).getCompleteNode()},e.prototype.collectDistinctViewsForSubTree_=function(e){return e.fold((function(e,t,n){if(t&&t.hasCompleteView())return[t.getCompleteView()];var r=[];return t&&(r=t.getQueryViews()),$t(n,(function(e,t){r=r.concat(t)})),r}))},e.prototype.removeTags_=function(t){for(var n=0;n<t.length;++n){var r=t[n];if(!r.getQueryParams().loadsAllData()){var i=e.makeQueryKey_(r),o=this.queryToTagMap.get(i);this.queryToTagMap.delete(i),this.tagToQueryMap.delete(o)}}},e.queryForListening_=function(e){return e.getQueryParams().loadsAllData()&&!e.getQueryParams().isDefault()?e.getRef():e},e.prototype.setupListener_=function(t,n){var r=t.path,i=this.tagForQuery_(t),o=this.createListenerForView_(n),a=this.listenProvider_.startListening(e.queryForListening_(t),i,o.hashFn,o.onComplete),s=this.syncPointTree_.subtree(r);if(i)le(!s.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var u=s.fold((function(e,t,n){if(!ln(e)&&t&&t.hasCompleteView())return[t.getCompleteView().getQuery()];var r=[];return t&&(r=r.concat(t.getQueryViews().map((function(e){return e.getQuery()})))),$t(n,(function(e,t){r=r.concat(t)})),r})),l=0;l<u.length;++l){var c=u[l];this.listenProvider_.stopListening(e.queryForListening_(c),this.tagForQuery_(c))}return a},e.prototype.createListenerForView_=function(e){var t=this,n=e.getQuery(),r=this.tagForQuery_(n);return{hashFn:function(){return(e.getServerCache()||yr.EMPTY_NODE).hash()},onComplete:function(e){if("ok"===e)return r?t.applyTaggedListenComplete(n.path,r):t.applyListenComplete(n.path);var i=function(e,t){var n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");var r=new Error(e+" at "+t.path.toString()+": "+n);return r.code=e.toUpperCase(),r}(e,n);return t.removeEventRegistration(n,null,i)}}},e.makeQueryKey_=function(e){return e.path.toString()+"$"+e.queryIdentifier()},e.parseQueryKey_=function(e){var t=e.indexOf("$");return le(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new Xt(e.substr(0,t))}},e.prototype.queryKeyForTag_=function(e){return this.tagToQueryMap.get(e)},e.prototype.tagForQuery_=function(t){var n=e.makeQueryKey_(t);return this.queryToTagMap.get(n)},e.getNextQueryTag_=function(){return e.nextQueryTag_++},e.prototype.applyTaggedOperation_=function(e,t){var n=this.syncPointTree_.get(e);le(n,"Missing sync point for query tag that we're tracking");var r=this.pendingWriteTree_.childWrites(e);return n.applyOperation(t,r,null)},e.prototype.applyOperationToSyncPoints_=function(e){return this.applyOperationHelper_(e,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(Zt()))},e.prototype.applyOperationHelper_=function(e,t,n,r){if(ln(e.path))return this.applyOperationDescendantsHelper_(e,t,n,r);var i=t.get(Zt());null==n&&null!=i&&(n=i.getCompleteServerCache(Zt()));var o=[],a=en(e.path),s=e.operationForChild(a),u=t.children.get(a);if(u&&s){var l=n?n.getImmediateChild(a):null,c=r.child(a);o=o.concat(this.applyOperationHelper_(s,u,l,c))}return i&&(o=o.concat(i.applyOperation(e,r,n))),o},e.prototype.applyOperationDescendantsHelper_=function(e,t,n,r){var i=this,o=t.get(Zt());null==n&&null!=o&&(n=o.getCompleteServerCache(Zt()));var a=[];return t.children.inorderTraversal((function(t,o){var s=n?n.getImmediateChild(t):null,u=r.child(t),l=e.operationForChild(t);l&&(a=a.concat(i.applyOperationDescendantsHelper_(l,o,s,u)))})),o&&(a=a.concat(o.applyOperation(e,r,n))),a},e.nextQueryTag_=1,e}(),Ai=function(){function e(){this.rootNode_=yr.EMPTY_NODE}return e.prototype.getNode=function(e){return this.rootNode_.getChild(e)},e.prototype.updateSnapshot=function(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)},e}(),Oi=function(){function e(){this.counters_={}}return e.prototype.incrementCounter=function(e,t){void 0===t&&(t=1),xe(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t},e.prototype.get=function(){return fe(this.counters_)},e}(),Li=function(){function e(){}return e.getCollection=function(e){var t=e.toString();return this.collections_[t]||(this.collections_[t]=new Oi),this.collections_[t]},e.getOrCreateReporter=function(e,t){var n=e.toString();return this.reporters_[n]||(this.reporters_[n]=t()),this.reporters_[n]},e.collections_={},e.reporters_={},e}(),Mi=function(){function e(e){this.collection_=e,this.last_=null}return e.prototype.get=function(){var e=this.collection_.get(),t=te({},e);return this.last_&&$t(this.last_,(function(e,n){t[e]=t[e]-n})),this.last_=e,t},e}(),Fi=function(){function e(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Mi(e);var n=1e4+2e4*Math.random();Jt(this.reportStats_.bind(this),Math.floor(n))}return e.prototype.includeStat=function(e){this.statsToReport_[e]=!0},e.prototype.reportStats_=function(){var e=this,t=this.statsListener_.get(),n={},r=!1;$t(t,(function(t,i){i>0&&xe(e.statsToReport_,t)&&(n[t]=i,r=!0)})),r&&this.server_.reportStats(n),Jt(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},e}(),ji=function(){this.eventLists_=[],this.recursionDepth_=0};function qi(e,t){for(var n=null,r=0;r<t.length;r++){var i=t[r],o=i.getPath();null===n||pn(o,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:o}),n.events.push(i)}n&&e.eventLists_.push(n)}function Ui(e,t,n){qi(e,n),Vi(e,(function(e){return pn(e,t)}))}function Qi(e,t,n){qi(e,n),Vi(e,(function(e){return dn(e,t)||dn(t,e)}))}function Vi(e,t){e.recursionDepth_++;for(var n=!0,r=0;r<e.eventLists_.length;r++){var i=e.eventLists_[r];if(i)t(i.path)?(Wi(e.eventLists_[r]),e.eventLists_[r]=null):n=!1}n&&(e.eventLists_=[]),e.recursionDepth_--}function Wi(e){for(var t=0;t<e.events.length;t++){var n=e.events[t];if(null!==n){e.events[t]=null;var r=n.getEventRunner();Dt&&At("event: "+n.toString()),Yt(r)}}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Hi=function(){function e(e){this.allowedEvents_=e,this.listeners_={},le(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}return e.prototype.trigger=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Array.isArray(this.listeners_[e]))for(var r=ae(this.listeners_[e]),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,t)},e.prototype.on=function(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});var r=this.getInitialEvent(e);r&&t.apply(n,r)},e.prototype.off=function(e,t,n){this.validateEventType_(e);for(var r=this.listeners_[e]||[],i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)},e.prototype.validateEventType_=function(e){le(this.allowedEvents_.find((function(t){return t===e})),"Unknown event: "+e)},e}(),Bi=function(e){function t(){var t,n,r=e.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(n="visibilitychange",t="hidden"):void 0!==document.mozHidden?(n="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(n="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(n="webkitvisibilitychange",t="webkitHidden")),r.visible_=!0,n&&document.addEventListener(n,(function(){var e=!document[t];e!==r.visible_&&(r.visible_=e,r.trigger("visible",e))}),!1),r}return ee(t,e),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(e){return le("visible"===e,"Unknown event type: "+e),[this.visible_]},t}(Hi),$i=function(e){function t(){var t=e.call(this,["online"])||this;return t.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||ve()||(window.addEventListener("online",(function(){t.online_||(t.online_=!0,t.trigger("online",!0))}),!1),window.addEventListener("offline",(function(){t.online_&&(t.online_=!1,t.trigger("online",!1))}),!1)),t}return ee(t,e),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(e){return le("online"===e,"Unknown event type: "+e),[this.online_]},t.prototype.currentlyOnline=function(){return this.online_},t}(Hi),Ki=function(){function e(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return e.prototype.closeAfter=function(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},e.prototype.handleResponse=function(e,t){var n=this;this.pendingResponses[e]=t;for(var r=function(){var e=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var t=function(t){e[t]&&Yt((function(){n.onMessage_(e[t])}))},r=0;r<e.length;++r)t(r);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum];){if("break"===r())break}},e}(),zi=function(){function e(e,t,n,r,i){this.connId=e,this.repoInfo=t,this.applicationId=n,this.transportSessionId=r,this.lastSessionId=i,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Ot(e),this.stats_=Li.getCollection(t),this.urlFn=function(e){return t.connectionURL("long_polling",e)}}return e.prototype.open=function(e,t){var n=this;this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Ki(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((function(){n.log_("Timed out trying to connect."),n.onClosed_(),n.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if("complete"===document.readyState)e();else{var t=!1,n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(function(){"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((function(){if(!n.isClosed_){n.scriptTagHolder=new Gi((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=oe(e,5),i=r[0],o=r[1],a=r[2];if(r[3],r[4],n.incrementIncomingBytes_(e),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,"start"===i)n.id=o,n.password=a;else{if("close"!==i)throw new Error("Unrecognized command received: "+i);o?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(o,(function(){n.onClosed_()}))):n.onClosed_()}}),(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=oe(e,2),i=r[0],o=r[1];n.incrementIncomingBytes_(e),n.myPacketOrderer.handleResponse(i,o)}),(function(){n.onClosed_()}),n.urlFn);var e={start:"t"};e.ser=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=n.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",n.transportSessionId&&(e.s=n.transportSessionId),n.lastSessionId&&(e.ls=n.lastSessionId),n.applicationId&&(e.p=n.applicationId),"undefined"!=typeof location&&location.hostname&&yn.test(location.hostname)&&(e.r="f");var t=n.urlFn(e);n.log_("Connecting via long-poll to "+t),n.scriptTagHolder.addTag(t,(function(){}))}}))},e.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},e.forceAllow=function(){e.forceAllow_=!0},e.forceDisallow=function(){e.forceDisallow_=!0},e.isAvailable=function(){return!!e.forceAllow_||!(e.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)},e.prototype.markConnectionHealthy=function(){},e.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},e.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},e.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},e.prototype.send=function(e){var t=Ne(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);for(var n,r=(n=he(t),pe.encodeByteArray(n,!0)),i=Bt(r,1840),o=0;o<i.length;o++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[o]),this.curSegmentNum++},e.prototype.addDisconnectPingFrame=function(e,t){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)},e.prototype.incrementIncomingBytes_=function(e){var t=Ne(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)},e}(),Gi=function(){function e(t,n,r,i){this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,this.uniqueCallbackIdentifier=It(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=n,this.myIFrame=e.createIFrame_();var o="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(o='<script>document.domain="'+document.domain+'";<\/script>');var a="<html><body>"+o+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(a),this.myIFrame.doc.close()}catch(s){At("frame writing exception"),s.stack&&At(s.stack),At(s)}}return e.createIFrame_=function(){var e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||At("No IE domain setting required")}catch(n){var t=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+t+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e},e.prototype.close=function(){var e=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout((function(){null!==e.myIFrame&&(document.body.removeChild(e.myIFrame),e.myIFrame=null)}),Math.floor(0)));var t=this.onDisconnect;t&&(this.onDisconnect=null,t())},e.prototype.startLongPoll=function(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););},e.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;for(var t=this.urlFn(e),n="",r=0;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1},e.prototype.enqueueSegment=function(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()},e.prototype.addLongPollTag_=function(e,t){var n=this;this.outstandingRequests.add(t);var r=function(){n.outstandingRequests.delete(t),n.newRequest_()},i=setTimeout(r,Math.floor(25e3));this.addTag(e,(function(){clearTimeout(i),r()}))},e.prototype.addTag=function(e,t){var n=this;setTimeout((function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){var e=r.readyState;e&&"loaded"!==e&&"complete"!==e||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=function(){At("Long-poll script failed to load: "+e),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(i){}}),Math.floor(1))},e}(),Yi="";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ji(e){Yi=e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Xi=null;"undefined"!=typeof MozWebSocket?Xi=MozWebSocket:"undefined"!=typeof WebSocket&&(Xi=WebSocket);var Zi,eo,to=function(){function e(t,n,r,i,o){this.connId=t,this.applicationId=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Ot(this.connId),this.stats_=Li.getCollection(n),this.connURL=e.connectionURL_(n,i,o),this.nodeAdmin=n.nodeAdmin}return e.connectionURL_=function(e,t,n){var r={v:"5"};return"undefined"!=typeof location&&location.hostname&&yn.test(location.hostname)&&(r.r="f"),t&&(r.s=t),n&&(r.ls=n),e.connectionURL("websocket",r)},e.prototype.open=function(e,t){var n=this;this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,St.set("previous_websocket_failure",!0);try{if(be());else{var r={headers:{"X-Firebase-GMPID":this.applicationId||""}};this.mySock=new Xi(this.connURL,[],r)}}catch(o){this.log_("Error instantiating WebSocket.");var i=o.message||o.data;return i&&this.log_(i),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(e){n.handleIncomingFrame(e)},this.mySock.onerror=function(e){n.log_("WebSocket error.  Closing connection.");var t=e.message||e.data;t&&n.log_(t),n.onClosed_()}},e.prototype.start=function(){},e.forceDisallow=function(){e.forceDisallow_=!0},e.isAvailable=function(){var t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var n=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);n&&n.length>1&&parseFloat(n[1])<4.4&&(t=!0)}return!t&&null!==Xi&&!e.forceDisallow_},e.previouslyFailed=function(){return St.isInMemoryStorage||!0===St.get("previous_websocket_failure")},e.prototype.markConnectionHealthy=function(){St.remove("previous_websocket_failure")},e.prototype.appendFrame_=function(e){if(this.frames.push(e),this.frames.length===this.totalFrames){var t=this.frames.join("");this.frames=null;var n=Pe(t);this.onMessage(n)}},e.prototype.handleNewFrameCount_=function(e){this.totalFrames=e,this.frames=[]},e.prototype.extractFrameCount_=function(e){if(le(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e},e.prototype.handleIncomingFrame=function(e){if(null!==this.mySock){var t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{var n=this.extractFrameCount_(t);null!==n&&this.appendFrame_(n)}}},e.prototype.send=function(e){this.resetKeepAlive();var t=Ne(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);var n=Bt(t,16384);n.length>1&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},e.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},e.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},e.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},e.prototype.resetKeepAlive=function(){var e=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((function(){e.mySock&&e.sendString_("0"),e.resetKeepAlive()}),Math.floor(45e3))},e.prototype.sendString_=function(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},e.responsesRequiredToBeHealthy=2,e.healthyTimeout=3e4,e}(),no=function(){function e(e){this.initTransports_(e)}return Object.defineProperty(e,"ALL_TRANSPORTS",{get:function(){return[zi,to]},enumerable:!1,configurable:!0}),e.prototype.initTransports_=function(t){var n,r,i=to&&to.isAvailable(),o=i&&!to.previouslyFailed();if(t.webSocketOnly&&(i||Ft("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),o=!0),o)this.transports_=[to];else{var a=this.transports_=[];try{for(var s=ie(e.ALL_TRANSPORTS),u=s.next();!u.done;u=s.next()){var l=u.value;l&&l.isAvailable()&&a.push(l)}}catch(c){n={error:c}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}},e.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")},e.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},e}(),ro=function(){function e(e,t,n,r,i,o,a,s){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.onMessage_=r,this.onReady_=i,this.onDisconnect_=o,this.onKill_=a,this.lastSessionId=s,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Ot("c:"+this.id+":"),this.transportManager_=new no(t),this.log_("Connection created"),this.start_()}return e.prototype.start_=function(){var e=this,t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,void 0,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((function(){e.conn_&&e.conn_.open(n,r)}),Math.floor(0));var i=t.healthyTimeout||0;i>0&&(this.healthyTimeout_=Jt((function(){e.healthyTimeout_=null,e.isHealthy_||(e.conn_&&e.conn_.bytesReceived>102400?(e.log_("Connection exceeded healthy timeout but has received "+e.conn_.bytesReceived+" bytes.  Marking connection healthy."),e.isHealthy_=!0,e.conn_.markConnectionHealthy()):e.conn_&&e.conn_.bytesSent>10240?e.log_("Connection exceeded healthy timeout but has sent "+e.conn_.bytesSent+" bytes.  Leaving connection alive."):(e.log_("Closing unhealthy connection after timeout."),e.close()))}),Math.floor(i)))},e.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},e.prototype.disconnReceiver_=function(e){var t=this;return function(n){e===t.conn_?t.onConnectionLost_(n):e===t.secondaryConn_?(t.log_("Secondary connection lost."),t.onSecondaryConnectionLost_()):t.log_("closing an old connection")}},e.prototype.connReceiver_=function(e){var t=this;return function(n){2!==t.state_&&(e===t.rx_?t.onPrimaryMessageReceived_(n):e===t.secondaryConn_?t.onSecondaryMessageReceived_(n):t.log_("message on old connection"))}},e.prototype.sendRequest=function(e){var t={t:"d",d:e};this.sendData_(t)},e.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},e.prototype.onSecondaryControl_=function(e){if("t"in e){var t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},e.prototype.onSecondaryMessageReceived_=function(e){var t=Wt("t",e),n=Wt("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}},e.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},e.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},e.prototype.onPrimaryMessageReceived_=function(e){var t=Wt("t",e),n=Wt("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)},e.prototype.onDataMessage_=function(e){this.onPrimaryResponse_(),this.onMessage_(e)},e.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},e.prototype.onControl_=function(e){var t=Wt("t",e);if("d"in e){var n=e.d;if("h"===t)this.onHandshake_(n);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?Lt("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Lt("Unknown control packet command: "+t)}},e.prototype.onHandshake_=function(e){var t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.updateHost(r),0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&Ft("Protocol version mismatch detected"),this.tryStartUpgrade_())},e.prototype.tryStartUpgrade_=function(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)},e.prototype.startUpgrade_=function(e){var t=this;this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),Jt((function(){t.secondaryConn_&&(t.log_("Timed out trying to upgrade."),t.secondaryConn_.close())}),Math.floor(6e4))},e.prototype.onReset_=function(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.updateHost(e),1===this.state_?this.close():(this.closeConnections_(),this.start_())},e.prototype.onConnectionEstablished_=function(e,t){var n=this;this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Jt((function(){n.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))},e.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},e.prototype.onSecondaryConnectionLost_=function(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()},e.prototype.onConnectionLost_=function(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(St.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},e.prototype.onConnectionShutdown_=function(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()},e.prototype.sendData_=function(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)},e.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},e.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},e}(),io=function(){function e(){}return e.prototype.put=function(e,t,n,r){},e.prototype.merge=function(e,t,n,r){},e.prototype.refreshAuthToken=function(e){},e.prototype.onDisconnectPut=function(e,t,n){},e.prototype.onDisconnectMerge=function(e,t,n){},e.prototype.onDisconnectCancel=function(e,t){},e.prototype.reportStats=function(e){},e}(),oo=function(e){function t(n,r,i,o,a,s,u){var l=e.call(this)||this;if(l.repoInfo_=n,l.applicationId_=r,l.onDataUpdate_=i,l.onConnectStatus_=o,l.onServerInfoUpdate_=a,l.authTokenProvider_=s,l.authOverride_=u,l.id=t.nextPersistentConnectionId_++,l.log_=Ot("p:"+l.id+":"),l.interruptReasons_={},l.listens=new Map,l.outstandingPuts_=[],l.outstandingGets_=[],l.outstandingPutCount_=0,l.outstandingGetCount_=0,l.onDisconnectRequestQueue_=[],l.connected_=!1,l.reconnectDelay_=1e3,l.maxReconnectDelay_=3e5,l.securityDebugCallback_=null,l.lastSessionId=null,l.establishConnectionTimer_=null,l.visible_=!1,l.requestCBHash_={},l.requestNumber_=0,l.realtime_=null,l.authToken_=null,l.forceTokenRefresh_=!1,l.invalidAuthTokenCount_=0,l.firstConnection_=!0,l.lastConnectionAttemptTime_=null,l.lastConnectionEstablishedTime_=null,u&&!be())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return l.scheduleConnect_(0),Bi.getInstance().on("visible",l.onVisible_,l),-1===n.host.indexOf("fblocal")&&$i.getInstance().on("online",l.onOnline_,l),l}return ee(t,e),t.prototype.sendRequest=function(e,t,n){var r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_(Ne(i)),le(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)},t.prototype.get=function(e){var t=this,n=new me,r={p:e.path.toString(),q:e.queryObject()},i={action:"g",request:r,onComplete:function(e){var i=e.d;"ok"===e.s?(t.onDataUpdate_(r.p,i,!1,null),n.resolve(i)):n.reject(i)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;var o=this.outstandingGets_.length-1;return this.connected_||setTimeout((function(){var e=t.outstandingGets_[o];void 0!==e&&i===e&&(delete t.outstandingGets_[o],t.outstandingGetCount_--,0===t.outstandingGetCount_&&(t.outstandingGets_=[]),t.log_("get "+o+" timed out on connection"),n.reject(new Error("Client is offline.")))}),3e3),this.connected_&&this.sendGet_(o),n.promise},t.prototype.listen=function(e,t,n,r){var i=e.queryIdentifier(),o=e.path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),le(e.getQueryParams().isDefault()||!e.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),le(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");var a={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)},t.prototype.sendGet_=function(e){var t=this,n=this.outstandingGets_[e];this.sendRequest("g",n.request,(function(r){delete t.outstandingGets_[e],t.outstandingGetCount_--,0===t.outstandingGetCount_&&(t.outstandingGets_=[]),n.onComplete&&n.onComplete(r)}))},t.prototype.sendListen_=function(e){var n=this,r=e.query,i=r.path.toString(),o=r.queryIdentifier();this.log_("Listen on "+i+" for "+o);var a={p:i};e.tag&&(a.q=r.queryObject(),a.t=e.tag),a.h=e.hashFn(),this.sendRequest("q",a,(function(a){var s=a.d,u=a.s;t.warnOnListenWarnings_(s,r),(n.listens.get(i)&&n.listens.get(i).get(o))===e&&(n.log_("listen response",a),"ok"!==u&&n.removeListen_(i,o),e.onComplete&&e.onComplete(u,s))}))},t.warnOnListenWarnings_=function(e,t){if(e&&"object"==typeof e&&xe(e,"w")){var n=Re(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var r='".indexOn": "'+t.getQueryParams().getIndex().toString()+'"',i=t.path.toString();Ft("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+r+" at "+i+" to your security rules for better performance.")}}},t.prototype.refreshAuthToken=function(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(function(){})),this.reduceReconnectDelayIfAdminCredential_(e)},t.prototype.reduceReconnectDelayIfAdminCredential_=function(e){var t;(e&&40===e.length||"object"==typeof(t=De(e).claims)&&!0===t.admin)&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},t.prototype.tryAuth=function(){var e,t=this;if(this.connected_&&this.authToken_){var n=this.authToken_,r=(e=De(n).claims)&&"object"==typeof e&&e.hasOwnProperty("iat")?"auth":"gauth",i={cred:n};null===this.authOverride_?i.noauth=!0:"object"==typeof this.authOverride_&&(i.authvar=this.authOverride_),this.sendRequest(r,i,(function(e){var r=e.s,i=e.d||"error";t.authToken_===n&&("ok"===r?t.invalidAuthTokenCount_=0:t.onAuthRevoked_(r,i))}))}},t.prototype.unlisten=function(e,t){var n=e.path.toString(),r=e.queryIdentifier();this.log_("Unlisten called for "+n+" "+r),le(e.getQueryParams().isDefault()||!e.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e.queryObject(),t)},t.prototype.sendUnlisten_=function(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);var i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},t.prototype.onDisconnectPut=function(e,t,n){this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})},t.prototype.onDisconnectMerge=function(e,t,n){this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})},t.prototype.onDisconnectCancel=function(e,t){this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})},t.prototype.sendOnDisconnect_=function(e,t,n,r){var i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,(function(e){r&&setTimeout((function(){r(e.s,e.d)}),Math.floor(0))}))},t.prototype.put=function(e,t,n,r){this.putInternal("p",e,t,n,r)},t.prototype.merge=function(e,t,n,r){this.putInternal("m",e,t,n,r)},t.prototype.putInternal=function(e,t,n,r,i){var o={p:t,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:r}),this.outstandingPutCount_++;var a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)},t.prototype.sendPut_=function(e){var t=this,n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,(function(r){t.log_(n+" response",r),delete t.outstandingPuts_[e],t.outstandingPutCount_--,0===t.outstandingPutCount_&&(t.outstandingPuts_=[]),i&&i(r.s,r.d)}))},t.prototype.reportStats=function(e){var t=this;if(this.connected_){var n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,(function(e){if("ok"!==e.s){var n=e.d;t.log_("reportStats","Error sending stats: "+n)}}))}},t.prototype.onDataMessage_=function(e){if("r"in e){this.log_("from server: "+Ne(e));var t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}},t.prototype.onDataPush_=function(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):Lt("Unrecognized action received from server: "+Ne(e)+"\nAre you using the latest client?")},t.prototype.onReady_=function(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},t.prototype.scheduleConnect_=function(e){var t=this;le(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((function(){t.establishConnectionTimer_=null,t.establishConnection_()}),Math.floor(e))},t.prototype.onVisible_=function(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e},t.prototype.onOnline_=function(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},t.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();var e=(new Date).getTime()-this.lastConnectionAttemptTime_,t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},t.prototype.establishConnection_=function(){var e=this;if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var n=this.onDataMessage_.bind(this),r=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),o=this.id+":"+t.nextConnectionId_++,a=this,s=this.lastSessionId,u=!1,l=null,c=function(){l?l.close():(u=!0,i())};this.realtime_={close:c,sendRequest:function(e){le(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(e)}};var h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(h).then((function(e){u?At("getToken() completed but was canceled"):(At("getToken() completed. Creating connection."),a.authToken_=e&&e.accessToken,l=new ro(o,a.repoInfo_,a.applicationId_,n,r,i,(function(e){Ft(e+" ("+a.repoInfo_.toString()+")"),a.interrupt("server_kill")}),s))})).then(null,(function(t){a.log_("Failed to get token: "+t),u||(e.repoInfo_.nodeAdmin&&Ft(t),c())}))}},t.prototype.interrupt=function(e){At("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},t.prototype.resume=function(e){At("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Ae(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))},t.prototype.handleTimestamp_=function(e){var t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})},t.prototype.cancelSentTransactions_=function(){for(var e=0;e<this.outstandingPuts_.length;e++){var t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},t.prototype.onListenRevoked_=function(e,t){var n;n=t?t.map((function(e){return Ht(e)})).join("$"):"default";var r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")},t.prototype.removeListen_=function(e,t){var n,r=new Xt(e).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(t),i.delete(t),0===i.size&&this.listens.delete(r)}else n=void 0;return n},t.prototype.onAuthRevoked_=function(e,t){At("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},t.prototype.onSecurityDebugPacket_=function(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))},t.prototype.restoreState_=function(){var e,t,n,r;this.tryAuth();try{for(var i=ie(this.listens.values()),o=i.next();!o.done;o=i.next()){var a=o.value;try{for(var s=(n=void 0,ie(a.values())),u=s.next();!u.done;u=s.next()){var l=u.value;this.sendListen_(l)}}catch(p){n={error:p}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}}catch(d){e={error:d}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}for(var c=0;c<this.outstandingPuts_.length;c++)this.outstandingPuts_[c]&&this.sendPut_(c);for(;this.onDisconnectRequestQueue_.length;){var h=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(h.action,h.pathString,h.data,h.onComplete)}for(c=0;c<this.outstandingGets_.length;c++)this.outstandingGets_[c]&&this.sendGet_(c)},t.prototype.sendConnectStats_=function(){var e={};e["sdk.js."+Yi.replace(/\./g,"-")]=1,ve()?e["framework.cordova"]=1:"object"==typeof navigator&&"ReactNative"===navigator.product&&(e["framework.reactnative"]=1),this.reportStats(e)},t.prototype.shouldReconnect_=function(){var e=$i.getInstance().currentlyOnline();return Ae(this.interruptReasons_)&&e},t.nextPersistentConnectionId_=0,t.nextConnectionId_=0,t}(io),ao=function(e){function t(t,n,r){var i=e.call(this)||this;return i.repoInfo_=t,i.onDataUpdate_=n,i.authTokenProvider_=r,i.log_=Ot("p:rest:"),i.listens_={},i}return ee(t,e),t.prototype.reportStats=function(e){throw new Error("Method not implemented.")},t.getListenId_=function(e,t){return void 0!==t?"tag$"+t:(le(e.getQueryParams().isDefault(),"should have a tag if it's not a default query."),e.path.toString())},t.prototype.listen=function(e,n,r,i){var o=this,a=e.path.toString();this.log_("Listen called for "+a+" "+e.queryIdentifier());var s=t.getListenId_(e,r),u={};this.listens_[s]=u;var l=Qr(e.getQueryParams());this.restRequest_(a+".json",l,(function(e,t){var n=t;(404===e&&(n=null,e=null),null===e&&o.onDataUpdate_(a,n,!1,r),Re(o.listens_,s)===u)&&i(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)}))},t.prototype.unlisten=function(e,n){var r=t.getListenId_(e,n);delete this.listens_[r]},t.prototype.get=function(e){var t=this,n=Qr(e.getQueryParams()),r=e.path.toString(),i=new me;return this.restRequest_(r+".json",n,(function(e,n){var o=n;404===e&&(o=null,e=null),null===e?(t.onDataUpdate_(r,o,!1,null),i.resolve(o)):i.reject(new Error(o))})),i.promise},t.prototype.refreshAuthToken=function(e){},t.prototype.restRequest_=function(e,t,n){var r=this;void 0===t&&(t={}),t.format="export",this.authTokenProvider_.getToken(!1).then((function(i){var o=i&&i.accessToken;o&&(t.auth=o);var a=(r.repoInfo_.secure?"https://":"http://")+r.repoInfo_.host+e+"?ns="+r.repoInfo_.namespace+function(e){for(var t=[],n=function(e,n){Array.isArray(n)?n.forEach((function(n){t.push(encodeURIComponent(e)+"="+encodeURIComponent(n))})):t.push(encodeURIComponent(e)+"="+encodeURIComponent(n))},r=0,i=Object.entries(e);r<i.length;r++){var o=i[r];n(o[0],o[1])}return t.length?"&"+t.join("&"):""}(t);r.log_("Sending REST request for "+a);var s=new XMLHttpRequest;s.onreadystatechange=function(){if(n&&4===s.readyState){r.log_("REST Response for "+a+" received. status:",s.status,"response:",s.responseText);var e=null;if(s.status>=200&&s.status<300){try{e=Pe(s.responseText)}catch(t){Ft("Failed to parse JSON response for "+a+": "+s.responseText)}n(null,e)}else 401!==s.status&&404!==s.status&&Ft("Got unsuccessful REST response for "+a+" Status: "+s.status),n(s.status);n=null}},s.open("GET",a,!0),s.send()}))},t}(io),so=function(){this.children={},this.childCount=0,this.value=null},uo=function(){function e(e,t,n){void 0===e&&(e=""),void 0===t&&(t=null),void 0===n&&(n=new so),this.name_=e,this.parent_=t,this.node_=n}return e.prototype.subTree=function(t){for(var n=t instanceof Xt?t:new Xt(t),r=this,i=en(n);null!==i;){r=new e(i,r,Re(r.node_.children,i)||new so),i=en(n=nn(n))}return r},e.prototype.getValue=function(){return this.node_.value},e.prototype.setValue=function(e){le(void 0!==e,"Cannot set value to undefined"),this.node_.value=e,this.updateParents_()},e.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},e.prototype.hasChildren=function(){return this.node_.childCount>0},e.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},e.prototype.forEachChild=function(t){var n=this;$t(this.node_.children,(function(r,i){t(new e(r,n,i))}))},e.prototype.forEachDescendant=function(e,t,n){t&&!n&&e(this),this.forEachChild((function(t){t.forEachDescendant(e,!0,n)})),t&&n&&e(this)},e.prototype.forEachAncestor=function(e,t){for(var n=t?this:this.parent();null!==n;){if(e(n))return!0;n=n.parent()}return!1},e.prototype.forEachImmediateDescendantWithValue=function(e){this.forEachChild((function(t){null!==t.getValue()?e(t):t.forEachImmediateDescendantWithValue(e)}))},e.prototype.path=function(){return new Xt(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},e.prototype.name=function(){return this.name_},e.prototype.parent=function(){return this.parent_},e.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},e.prototype.updateChild_=function(e,t){var n=t.isEmpty(),r=xe(this.node_.children,e);n&&r?(delete this.node_.children[e],this.node_.childCount--,this.updateParents_()):n||r||(this.node_.children[e]=t.node_,this.node_.childCount++,this.updateParents_())},e}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(eo=Zi||(Zi={}))[eo.RUN=0]="RUN",eo[eo.SENT=1]="SENT",eo[eo.COMPLETED=2]="COMPLETED",eo[eo.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",eo[eo.NEEDS_ABORT=4]="NEEDS_ABORT";var lo=function(){function e(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.app=n,this.authTokenProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new ji,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new Zr,this.transactionQueueTree_=new uo,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}return e.prototype.start=function(){var e=this;if(this.stats_=Li.getCollection(this.repoInfo_),this.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)this.server_=new ao(this.repoInfo_,this.onDataUpdate_.bind(this),this.authTokenProvider_),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var t=this.app.options.databaseAuthVariableOverride;if(null!=t){if("object"!=typeof t)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Ne(t)}catch(n){throw new Error("Invalid authOverride provided: "+n)}}this.persistentConnection_=new oo(this.repoInfo_,this.app.options.appId,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),this.authTokenProvider_,t),this.server_=this.persistentConnection_}this.authTokenProvider_.addTokenChangeListener((function(t){e.server_.refreshAuthToken(t)})),this.statsReporter_=Li.getOrCreateReporter(this.repoInfo_,(function(){return new Fi(e.stats_,e.server_)})),this.infoData_=new Ai,this.infoSyncTree_=new Ri({startListening:function(t,n,r,i){var o=[],a=e.infoData_.getNode(t.path);return a.isEmpty()||(o=e.infoSyncTree_.applyServerOverwrite(t.path,a),setTimeout((function(){i("ok")}),0)),o},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new Ri({startListening:function(t,n,r,i){return e.server_.listen(t,r,n,(function(n,r){var o=i(n,r);Qi(e.eventQueue_,t.path,o)})),[]},stopListening:function(t,n){e.server_.unlisten(t,n)}})},e.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},e.prototype.name=function(){return this.repoInfo_.namespace},e.prototype.serverTime=function(){var e=this.infoData_.getNode(new Xt(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+e},e.prototype.generateServerValues=function(){return(e=(e={timestamp:this.serverTime()})||{}).timestamp=e.timestamp||(new Date).getTime(),e;var e},e.prototype.onDataUpdate_=function(e,t,n,r){this.dataUpdateCount++;var i=new Xt(e);t=this.interceptServerDataCallback_?this.interceptServerDataCallback_(e,t):t;var o=[];if(r)if(n){var a=Oe(t,(function(e){return vr(e)}));o=this.serverSyncTree_.applyTaggedQueryMerge(i,a,r)}else{var s=vr(t);o=this.serverSyncTree_.applyTaggedQueryOverwrite(i,s,r)}else if(n){var u=Oe(t,(function(e){return vr(e)}));o=this.serverSyncTree_.applyServerMerge(i,u)}else{var l=vr(t);o=this.serverSyncTree_.applyServerOverwrite(i,l)}var c=i;o.length>0&&(c=this.rerunTransactions_(i)),Qi(this.eventQueue_,c,o)},e.prototype.interceptServerData_=function(e){this.interceptServerDataCallback_=e},e.prototype.onConnectStatus_=function(e){this.updateInfo_("connected",e),!1===e&&this.runOnDisconnectEvents_()},e.prototype.onServerInfoUpdate_=function(e){var t=this;$t(e,(function(e,n){t.updateInfo_(e,n)}))},e.prototype.updateInfo_=function(e,t){var n=new Xt("/.info/"+e),r=vr(t);this.infoData_.updateSnapshot(n,r);var i=this.infoSyncTree_.applyServerOverwrite(n,r);Qi(this.eventQueue_,n,i)},e.prototype.getNextWriteId_=function(){return this.nextWriteId_++},e.prototype.getValue=function(e){var t=this,n=this.serverSyncTree_.getServerValue(e);return null!=n?Promise.resolve(new br(n,e.getRef(),e.getQueryParams().getIndex())):this.server_.get(e).then((function(n){var r=vr(n),i=t.serverSyncTree_.applyServerOverwrite(e.path,r);return Ui(t.eventQueue_,e.path,i),Promise.resolve(new br(r,e.getRef(),e.getQueryParams().getIndex()))}),(function(n){return t.log_("get for query "+Ne(e)+" failed: "+n),Promise.reject(new Error(n))}))},e.prototype.setWithPriority=function(e,t,n,r){var i=this;this.log_("set",{path:e.toString(),value:t,priority:n});var o=this.generateServerValues(),a=vr(t,n),s=this.serverSyncTree_.calcCompleteEventCache(e),u=Gr(a,s,o),l=this.getNextWriteId_(),c=this.serverSyncTree_.applyUserOverwrite(e,u,l,!0);qi(this.eventQueue_,c),this.server_.put(e.toString(),a.val(!0),(function(t,n){var o="ok"===t;o||Ft("set at "+e+" failed: "+t);var a=i.serverSyncTree_.ackUserWrite(l,!o);Qi(i.eventQueue_,e,a),i.callOnCompleteCallback(r,t,n)}));var h=this.abortTransactions_(e);this.rerunTransactions_(h),Qi(this.eventQueue_,h,[])},e.prototype.update=function(e,t,n){var r=this;this.log_("update",{path:e.toString(),value:t});var i=!0,o=this.generateServerValues(),a={};if($t(t,(function(t,n){i=!1,a[t]=zr(un(e,t),vr(n),r.serverSyncTree_,o)})),i)At("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(n,"ok");else{var s=this.getNextWriteId_(),u=this.serverSyncTree_.applyUserMerge(e,a,s);qi(this.eventQueue_,u),this.server_.merge(e.toString(),t,(function(t,i){var o="ok"===t;o||Ft("update at "+e+" failed: "+t);var a=r.serverSyncTree_.ackUserWrite(s,!o),u=a.length>0?r.rerunTransactions_(e):e;Qi(r.eventQueue_,u,a),r.callOnCompleteCallback(n,t,i)})),$t(t,(function(t){var n=r.abortTransactions_(un(e,t));r.rerunTransactions_(n)})),Qi(this.eventQueue_,e,[])}},e.prototype.runOnDisconnectEvents_=function(){var e=this;this.log_("onDisconnectEvents");var t=this.generateServerValues(),n=new Zr;this.onDisconnect_.forEachTree(Zt(),(function(r,i){var o=zr(r,i,e.serverSyncTree_,t);n.remember(r,o)}));var r=[];n.forEachTree(Zt(),(function(t,n){r=r.concat(e.serverSyncTree_.applyServerOverwrite(t,n));var i=e.abortTransactions_(t);e.rerunTransactions_(i)})),this.onDisconnect_=new Zr,Qi(this.eventQueue_,Zt(),r)},e.prototype.onDisconnectCancel=function(e,t){var n=this;this.server_.onDisconnectCancel(e.toString(),(function(r,i){"ok"===r&&n.onDisconnect_.forget(e),n.callOnCompleteCallback(t,r,i)}))},e.prototype.onDisconnectSet=function(e,t,n){var r=this,i=vr(t);this.server_.onDisconnectPut(e.toString(),i.val(!0),(function(t,o){"ok"===t&&r.onDisconnect_.remember(e,i),r.callOnCompleteCallback(n,t,o)}))},e.prototype.onDisconnectSetWithPriority=function(e,t,n,r){var i=this,o=vr(t,n);this.server_.onDisconnectPut(e.toString(),o.val(!0),(function(t,n){"ok"===t&&i.onDisconnect_.remember(e,o),i.callOnCompleteCallback(r,t,n)}))},e.prototype.onDisconnectUpdate=function(e,t,n){var r=this;if(Ae(t))return At("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(n,"ok");this.server_.onDisconnectMerge(e.toString(),t,(function(i,o){"ok"===i&&$t(t,(function(t,n){var i=vr(n);r.onDisconnect_.remember(un(e,t),i)})),r.callOnCompleteCallback(n,i,o)}))},e.prototype.addEventCallbackForQuery=function(e,t){var n;n=".info"===en(e.path)?this.infoSyncTree_.addEventRegistration(e,t):this.serverSyncTree_.addEventRegistration(e,t),Ui(this.eventQueue_,e.path,n)},e.prototype.removeEventCallbackForQuery=function(e,t){var n;n=".info"===en(e.path)?this.infoSyncTree_.removeEventRegistration(e,t):this.serverSyncTree_.removeEventRegistration(e,t),Ui(this.eventQueue_,e.path,n)},e.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt("repo_interrupt")},e.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume("repo_interrupt")},e.prototype.stats=function(e){if(void 0===e&&(e=!1),"undefined"!=typeof console){var t;e?(this.statsListener_||(this.statsListener_=new Mi(this.stats_)),t=this.statsListener_.get()):t=this.stats_.get();var n=Object.keys(t).reduce((function(e,t){return Math.max(t.length,e)}),0);$t(t,(function(e,t){for(var r=e,i=e.length;i<n+2;i++)r+=" ";console.log(r+t)}))}},e.prototype.statsIncrementCounter=function(e){this.stats_.incrementCounter(e),this.statsReporter_.includeStat(e)},e.prototype.log_=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="";this.persistentConnection_&&(n=this.persistentConnection_.id+":"),At.apply(void 0,ae([n],e))},e.prototype.callOnCompleteCallback=function(e,t,n){e&&Yt((function(){if("ok"===t)e(null);else{var r=(t||"error").toUpperCase(),i=r;n&&(i+=": "+n);var o=new Error(i);o.code=r,e(o)}}))},Object.defineProperty(e.prototype,"database",{get:function(){return this.__database||(this.__database=new mo(this))},enumerable:!1,configurable:!0}),e.prototype.startTransaction=function(e,t,n,r){this.log_("transaction on "+e);var i=function(){},o=new co(this,e);o.on("value",i);var a={path:e,update:t,onComplete:n,status:null,order:It(),applyLocally:r,retryCount:0,unwatcher:function(){o.off("value",i)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},s=this.getLatestState_(e);a.currentInputSnapshot=s;var u=a.update(s.val());if(void 0===u){if(a.unwatcher(),a.currentOutputSnapshotRaw=null,a.currentOutputSnapshotResolved=null,a.onComplete){var l=new br(a.currentInputSnapshot,new co(this,a.path),rr);a.onComplete(null,!1,l)}}else{Nn("transaction failed: Data returned ",u,a.path),a.status=Zi.RUN;var c=this.transactionQueueTree_.subTree(e),h=c.getValue()||[];h.push(a),c.setValue(h);var p=void 0;if("object"==typeof u&&null!==u&&xe(u,".priority"))p=Re(u,".priority"),le(In(p),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else p=(this.serverSyncTree_.calcCompleteEventCache(e)||yr.EMPTY_NODE).getPriority().val();var d=this.generateServerValues(),f=vr(u,p),y=Gr(f,s,d);a.currentOutputSnapshotRaw=f,a.currentOutputSnapshotResolved=y,a.currentWriteId=this.getNextWriteId_();var m=this.serverSyncTree_.applyUserOverwrite(e,y,a.currentWriteId,a.applyLocally);Qi(this.eventQueue_,e,m),this.sendReadyTransactions_()}},e.prototype.getLatestState_=function(e,t){return this.serverSyncTree_.calcCompleteEventCache(e,t)||yr.EMPTY_NODE},e.prototype.sendReadyTransactions_=function(e){var t=this;if(void 0===e&&(e=this.transactionQueueTree_),e||this.pruneCompletedTransactionsBelowNode_(e),null!==e.getValue()){var n=this.buildTransactionQueue_(e);le(n.length>0,"Sending zero length transaction queue"),n.every((function(e){return e.status===Zi.RUN}))&&this.sendTransactionQueue_(e.path(),n)}else e.hasChildren()&&e.forEachChild((function(e){t.sendReadyTransactions_(e)}))},e.prototype.sendTransactionQueue_=function(e,t){for(var n=this,r=t.map((function(e){return e.currentWriteId})),i=this.getLatestState_(e,r),o=i,a=i.hash(),s=0;s<t.length;s++){var u=t[s];le(u.status===Zi.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=Zi.SENT,u.retryCount++;var l=cn(e,u.path);o=o.updateChild(l,u.currentOutputSnapshotRaw)}var c=o.val(!0),h=e;this.server_.put(h.toString(),c,(function(r){n.log_("transaction put response",{path:h.toString(),status:r});var i=[];if("ok"===r){for(var o=[],a=0;a<t.length;a++){if(t[a].status=Zi.COMPLETED,i=i.concat(n.serverSyncTree_.ackUserWrite(t[a].currentWriteId)),t[a].onComplete){var s=t[a].currentOutputSnapshotResolved,u=new co(n,t[a].path),l=new br(s,u,rr);o.push(t[a].onComplete.bind(null,null,!0,l))}t[a].unwatcher()}n.pruneCompletedTransactionsBelowNode_(n.transactionQueueTree_.subTree(e)),n.sendReadyTransactions_(),Qi(n.eventQueue_,e,i);for(a=0;a<o.length;a++)Yt(o[a])}else{if("datastale"===r)for(a=0;a<t.length;a++)t[a].status===Zi.SENT_NEEDS_ABORT?t[a].status=Zi.NEEDS_ABORT:t[a].status=Zi.RUN;else{Ft("transaction at "+h.toString()+" failed: "+r);for(a=0;a<t.length;a++)t[a].status=Zi.NEEDS_ABORT,t[a].abortReason=r}n.rerunTransactions_(e)}}),a)},e.prototype.rerunTransactions_=function(e){var t=this.getAncestorTransactionNode_(e),n=t.path(),r=this.buildTransactionQueue_(t);return this.rerunTransactionQueue_(r,n),n},e.prototype.rerunTransactionQueue_=function(e,t){if(0!==e.length){for(var n,r=[],i=[],o=e.filter((function(e){return e.status===Zi.RUN})).map((function(e){return e.currentWriteId})),a=0;a<e.length;a++){var s=e[a],u=cn(t,s.path),l=!1,c=void 0;if(le(null!==u,"rerunTransactionsUnderNode_: relativePath should not be null."),s.status===Zi.NEEDS_ABORT)l=!0,c=s.abortReason,i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0));else if(s.status===Zi.RUN)if(s.retryCount>=25)l=!0,c="maxretry",i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0));else{var h=this.getLatestState_(s.path,o);s.currentInputSnapshot=h;var p=e[a].update(h.val());if(void 0!==p){Nn("transaction failed: Data returned ",p,s.path);var d=vr(p);"object"==typeof p&&null!=p&&xe(p,".priority")||(d=d.updatePriority(h.getPriority()));var f=s.currentWriteId,y=this.generateServerValues(),m=Gr(d,h,y);s.currentOutputSnapshotRaw=d,s.currentOutputSnapshotResolved=m,s.currentWriteId=this.getNextWriteId_(),o.splice(o.indexOf(f),1),i=(i=i.concat(this.serverSyncTree_.applyUserOverwrite(s.path,m,s.currentWriteId,s.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(f,!0))}else l=!0,c="nodata",i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0))}if(Qi(this.eventQueue_,t,i),i=[],l&&(e[a].status=Zi.COMPLETED,n=e[a].unwatcher,setTimeout(n,Math.floor(0)),e[a].onComplete))if("nodata"===c){var v=new co(this,e[a].path),g=e[a].currentInputSnapshot,_=new br(g,v,rr);r.push(e[a].onComplete.bind(null,null,!1,_))}else r.push(e[a].onComplete.bind(null,new Error(c),!1,null))}this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_);for(a=0;a<r.length;a++)Yt(r[a]);this.sendReadyTransactions_()}},e.prototype.getAncestorTransactionNode_=function(e){var t,n=this.transactionQueueTree_;for(t=en(e);null!==t&&null===n.getValue();)n=n.subTree(t),t=en(e=nn(e));return n},e.prototype.buildTransactionQueue_=function(e){var t=[];return this.aggregateTransactionQueuesForNode_(e,t),t.sort((function(e,t){return e.order-t.order})),t},e.prototype.aggregateTransactionQueuesForNode_=function(e,t){var n=this,r=e.getValue();if(null!==r)for(var i=0;i<r.length;i++)t.push(r[i]);e.forEachChild((function(e){n.aggregateTransactionQueuesForNode_(e,t)}))},e.prototype.pruneCompletedTransactionsBelowNode_=function(e){var t=this,n=e.getValue();if(n){for(var r=0,i=0;i<n.length;i++)n[i].status!==Zi.COMPLETED&&(n[r]=n[i],r++);n.length=r,e.setValue(n.length>0?n:null)}e.forEachChild((function(e){t.pruneCompletedTransactionsBelowNode_(e)}))},e.prototype.abortTransactions_=function(e){var t=this,n=this.getAncestorTransactionNode_(e).path(),r=this.transactionQueueTree_.subTree(e);return r.forEachAncestor((function(e){t.abortTransactionsOnNode_(e)})),this.abortTransactionsOnNode_(r),r.forEachDescendant((function(e){t.abortTransactionsOnNode_(e)})),n},e.prototype.abortTransactionsOnNode_=function(e){var t=e.getValue();if(null!==t){for(var n=[],r=[],i=-1,o=0;o<t.length;o++)if(t[o].status===Zi.SENT_NEEDS_ABORT);else if(t[o].status===Zi.SENT)le(i===o-1,"All SENT items should be at beginning of queue."),i=o,t[o].status=Zi.SENT_NEEDS_ABORT,t[o].abortReason="set";else if(le(t[o].status===Zi.RUN,"Unexpected transaction status in abort"),t[o].unwatcher(),r=r.concat(this.serverSyncTree_.ackUserWrite(t[o].currentWriteId,!0)),t[o].onComplete){n.push(t[o].onComplete.bind(null,new Error("set"),!1,null))}-1===i?e.setValue(null):t.length=i+1,Qi(this.eventQueue_,e.path(),r);for(o=0;o<n.length;o++)Yt(n[o])}},e}(),co=function(e){function t(t,n){if(!(t instanceof lo))throw new Error("new Reference() no longer supported - use app.database().");return e.call(this,t,n,new Ar,!1)||this}return ee(t,e),t.prototype.getKey=function(){return qe("Reference.key",0,0,arguments.length),ln(this.path)?null:rn(this.path)},t.prototype.child=function(e){return qe("Reference.child",1,1,arguments.length),"number"==typeof e?e=String(e):e instanceof Xt||(null===en(this.path)?Ln("Reference.child",1,e,!1):On("Reference.child",1,e,!1)),new t(this.repo,un(this.path,e))},t.prototype.getParent=function(){qe("Reference.parent",0,0,arguments.length);var e=sn(this.path);return null===e?null:new t(this.repo,e)},t.prototype.getRoot=function(){qe("Reference.root",0,0,arguments.length);for(var e=this;null!==e.getParent();)e=e.getParent();return e},t.prototype.databaseProp=function(){return this.repo.database},t.prototype.set=function(e,t){qe("Reference.set",1,2,arguments.length),Mn("Reference.set",this.path),Pn("Reference.set",1,e,this.path,!1),Qe("Reference.set",2,t,!0);var n=new me;return this.repo.setWithPriority(this.path,e,null,n.wrapCallback(t)),n.promise},t.prototype.update=function(e,t){if(qe("Reference.update",1,2,arguments.length),Mn("Reference.update",this.path),Array.isArray(e)){for(var n={},r=0;r<e.length;++r)n[""+r]=e[r];e=n,Ft("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Dn("Reference.update",1,e,this.path,!1),Qe("Reference.update",2,t,!0);var i=new me;return this.repo.update(this.path,e,i.wrapCallback(t)),i.promise},t.prototype.setWithPriority=function(e,t,n){if(qe("Reference.setWithPriority",2,3,arguments.length),Mn("Reference.setWithPriority",this.path),Pn("Reference.setWithPriority",1,e,this.path,!1),xn("Reference.setWithPriority",2,t,!1),Qe("Reference.setWithPriority",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var r=new me;return this.repo.setWithPriority(this.path,e,t,r.wrapCallback(n)),r.promise},t.prototype.remove=function(e){return qe("Reference.remove",0,1,arguments.length),Mn("Reference.remove",this.path),Qe("Reference.remove",1,e,!0),this.set(null,e)},t.prototype.transaction=function(e,t,n){if(qe("Reference.transaction",1,3,arguments.length),Mn("Reference.transaction",this.path),Qe("Reference.transaction",1,e,!1),Qe("Reference.transaction",2,t,!0),jn("Reference.transaction",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===n&&(n=!0);var r=new me;"function"==typeof t&&r.promise.catch((function(){}));var i=function(e,n,i){e?r.reject(e):r.resolve(new Un(n,i)),"function"==typeof t&&t(e,n,i)};return this.repo.startTransaction(this.path,e,i,n),r.promise},t.prototype.setPriority=function(e,t){qe("Reference.setPriority",1,2,arguments.length),Mn("Reference.setPriority",this.path),xn("Reference.setPriority",1,e,!1),Qe("Reference.setPriority",2,t,!0);var n=new me;return this.repo.setWithPriority(un(this.path,".priority"),e,null,n.wrapCallback(t)),n.promise},t.prototype.push=function(e,t){qe("Reference.push",0,2,arguments.length),Mn("Reference.push",this.path),Pn("Reference.push",1,e,this.path,!0),Qe("Reference.push",2,t,!0);var n,r=this.repo.serverTime(),i=Vn(r),o=this.child(i),a=this.child(i);return n=null!=e?o.set(e,t).then((function(){return a})):Promise.resolve(a),o.then=n.then.bind(n),o.catch=n.then.bind(n,void 0),"function"==typeof t&&n.catch((function(){})),o},t.prototype.onDisconnect=function(){return Mn("Reference.onDisconnect",this.path),new qn(this.repo,this.path)},Object.defineProperty(t.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"key",{get:function(){return this.getKey()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this.getParent()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this.getRoot()},enumerable:!1,configurable:!0}),t}(Vr);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Vr.__referenceConstructor=co,gi.__referenceConstructor=co;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var ho,po=function(){function e(e,t){var n=this;this.app_=e,this.authProvider_=t,this.auth_=null,this.auth_=t.getImmediate({optional:!0}),this.auth_||t.get().then((function(e){return n.auth_=e}))}return e.prototype.getToken=function(e){return this.auth_?this.auth_.getToken(e).catch((function(e){return e&&"auth/token-not-initialized"===e.code?(At("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)})):Promise.resolve(null)},e.prototype.addTokenChangeListener=function(e){this.auth_?this.auth_.addAuthTokenListener(e):(setTimeout((function(){return e(null)}),0),this.authProvider_.get().then((function(t){return t.addAuthTokenListener(e)})))},e.prototype.removeTokenChangeListener=function(e){this.authProvider_.get().then((function(t){return t.removeAuthTokenListener(e)}))},e.prototype.notifyForInvalidToken=function(){var e='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.app_.options?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Ft(e)},e}(),fo=function(){function e(){}return e.prototype.getToken=function(t){return Promise.resolve({accessToken:e.EMULATOR_AUTH_TOKEN})},e.prototype.addTokenChangeListener=function(t){t(e.EMULATOR_AUTH_TOKEN)},e.prototype.removeTokenChangeListener=function(e){},e.prototype.notifyForInvalidToken=function(){},e.EMULATOR_AUTH_TOKEN="owner",e}(),yo=function(){function e(){this.repos_={},this.useRestClient_=!1}return e.getInstance=function(){return ho||(ho=new e),ho},e.prototype.interrupt=function(){var e,t,n,r;try{for(var i=ie(Object.keys(this.repos_)),o=i.next();!o.done;o=i.next()){var a=o.value;try{for(var s=(n=void 0,ie(Object.keys(this.repos_[a]))),u=s.next();!u.done;u=s.next()){var l=u.value;this.repos_[a][l].interrupt()}}catch(c){n={error:c}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}}catch(h){e={error:h}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},e.prototype.resume=function(){var e,t,n,r;try{for(var i=ie(Object.keys(this.repos_)),o=i.next();!o.done;o=i.next()){var a=o.value;try{for(var s=(n=void 0,ie(Object.keys(this.repos_[a]))),u=s.next();!u.done;u=s.next()){var l=u.value;this.repos_[a][l].resume()}}catch(c){n={error:c}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}}catch(h){e={error:h}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},e.prototype.applyEmulatorSettings=function(e,t,n){e.repoInfo_=new mn(t+":"+n,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams),e.repoInfo_.nodeAdmin&&(e.authTokenProvider_=new fo)},e.prototype.databaseFromApp=function(e,t,n,r){var i=n||e.options.databaseURL;void 0===i&&(e.options.projectId||Mt("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),At("Using default host for project ",e.options.projectId),i=e.options.projectId+"-default-rtdb.firebaseio.com");var o,a=wn(i,r),s=a.repoInfo,u=void 0;"undefined"!=typeof process&&(u=process.env.FIREBASE_DATABASE_EMULATOR_HOST),u?(o=!0,i="http://"+u+"?ns="+s.namespace,s=(a=wn(i,r)).repoInfo):o=!a.repoInfo.secure;var l=r&&o?new fo:new po(e,t);return Fn("Invalid Firebase Database URL",1,a),ln(a.path)||Mt("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(s,e,l).database},e.prototype.deleteRepo=function(e){var t=Re(this.repos_,e.app.name);t&&Re(t,e.key)===e||Mt("Database "+e.app.name+"("+e.repoInfo_+") has already been deleted."),e.interrupt(),delete t[e.key]},e.prototype.createRepo=function(e,t,n){var r=Re(this.repos_,t.name);r||(r={},this.repos_[t.name]=r);var i=Re(r,e.toURLString());return i&&Mt("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new lo(e,this.useRestClient_,t,n),r[e.toURLString()]=i,i},e.prototype.forceRestClient=function(e){this.useRestClient_=e},e}(),mo=function(){function e(e){var t=this;this.repoInternal_=e,this.instanceStarted_=!1,this.INTERNAL={delete:function(){return ne(t,void 0,void 0,(function(){return re(this,(function(e){return this.checkDeleted_("delete"),yo.getInstance().deleteRepo(this.repo_),this.repoInternal_=null,this.rootInternal_=null,[2]}))}))}},e instanceof lo||Mt("Don't call new Database() directly - please use firebase.database().")}return Object.defineProperty(e.prototype,"repo_",{get:function(){return this.instanceStarted_||(this.repoInternal_.start(),this.instanceStarted_=!0),this.repoInternal_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root_",{get:function(){return this.rootInternal_||(this.rootInternal_=new co(this.repo_,Zt())),this.rootInternal_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"app",{get:function(){return this.repo_.app},enumerable:!1,configurable:!0}),e.prototype.useEmulator=function(e,t){this.checkDeleted_("useEmulator"),this.instanceStarted_?Mt("Cannot call useEmulator() after instance has already been initialized."):yo.getInstance().applyEmulatorSettings(this.repoInternal_,e,t)},e.prototype.ref=function(e){return this.checkDeleted_("ref"),qe("database.ref",0,1,arguments.length),e instanceof co?this.refFromURL(e.toString()):void 0!==e?this.root_.child(e):this.root_},e.prototype.refFromURL=function(e){var t="database.refFromURL";this.checkDeleted_(t),qe(t,1,1,arguments.length);var n=wn(e,this.repo_.repoInfo_.nodeAdmin);Fn(t,1,n);var r=n.repoInfo;return this.repo_.repoInfo_.isCustomHost()||r.host===this.repo_.repoInfo_.host||Mt(t+": Host name does not match the current database: (found "+r.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(n.path.toString())},e.prototype.checkDeleted_=function(e){null===this.repoInternal_&&Mt("Cannot call "+e+" on a deleted database.")},e.prototype.goOffline=function(){qe("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},e.prototype.goOnline=function(){qe("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},e.ServerValue={TIMESTAMP:{".sv":"timestamp"},increment:function(e){return{".sv":{increment:e}}}},e}();var vo=Object.freeze({__proto__:null,forceLongPolling:function(){to.forceDisallow(),zi.forceAllow()},forceWebSockets:function(){zi.forceDisallow()},isWebSocketsAvailable:function(){return to.isAvailable()},setSecurityDebugCallback:function(e,t){e.repo.persistentConnection_.securityDebugCallback_=t},stats:function(e,t){e.repo.stats(t)},statsIncrementCounter:function(e,t){e.repo.statsIncrementCounter(t)},dataUpdateCount:function(e){return e.repo.dataUpdateCount},interceptServerData:function(e,t){return e.repo.interceptServerData_(t)},initStandalone:function(e){var t=e.app,n=e.url,r=e.version,i=e.customAuthImpl,o=e.namespace,a=e.nodeAdmin,s=void 0!==a&&a;Ji(r);var u=new $e("auth-internal",new ze("database-standalone"));return u.setComponent(new Be("auth-internal",(function(){return i}),"PRIVATE")),{instance:yo.getInstance().databaseFromApp(t,u,n,s),namespace:o}}}),go=oo;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */oo.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},oo.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)};var _o,bo=ro,wo=mn,Co=Object.freeze({__proto__:null,DataConnection:go,RealTimeConnection:bo,hijackHash:function(e){var t=oo.prototype.put;return oo.prototype.put=function(n,r,i,o){void 0!==o&&(o=e()),t.call(this,n,r,i,o)},function(){oo.prototype.put=t}},ConnectionTarget:wo,queryIdentifier:function(e){return e.queryIdentifier()},forceRestClient:function(e){yo.getInstance().forceRestClient(e)}}),To=mo.ServerValue;function So(e){return Array.prototype.slice.call(e)}function Eo(e){return new Promise((function(t,n){e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}}))}function ko(e,t,n){var r,i=new Promise((function(i,o){Eo(r=e[t].apply(e,n)).then(i,o)}));return i.request=r,i}function Io(e,t,n){var r=ko(e,t,n);return r.then((function(e){if(e)return new Ao(e,r.request)}))}function Po(e,t,n){n.forEach((function(n){Object.defineProperty(e.prototype,n,{get:function(){return this[t][n]},set:function(e){this[t][n]=e}})}))}function No(e,t,n,r){r.forEach((function(r){r in n.prototype&&(e.prototype[r]=function(){return ko(this[t],r,arguments)})}))}function Do(e,t,n,r){r.forEach((function(r){r in n.prototype&&(e.prototype[r]=function(){return this[t][r].apply(this[t],arguments)})}))}function xo(e,t,n,r){r.forEach((function(r){r in n.prototype&&(e.prototype[r]=function(){return Io(this[t],r,arguments)})}))}function Ro(e){this._index=e}function Ao(e,t){this._cursor=e,this._request=t}function Oo(e){this._store=e}function Lo(e){this._tx=e,this.complete=new Promise((function(t,n){e.oncomplete=function(){t()},e.onerror=function(){n(e.error)},e.onabort=function(){n(e.error)}}))}function Mo(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new Lo(n)}function Fo(e){this._db=e}Ji((_o=_t).SDK_VERSION),_o.INTERNAL.registerComponent(new Be("database",(function(e,t){var n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal");return yo.getInstance().databaseFromApp(n,r,t)}),"PUBLIC").setServiceProps({Reference:co,Query:Vr,Database:mo,DataSnapshot:br,enableLogging:Rt,INTERNAL:vo,ServerValue:To,TEST_ACCESS:Co}).setMultipleInstances(!0)),_o.registerVersion("@firebase/database","0.9.4"),Po(Ro,"_index",["name","keyPath","multiEntry","unique"]),No(Ro,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),xo(Ro,"_index",IDBIndex,["openCursor","openKeyCursor"]),Po(Ao,"_cursor",["direction","key","primaryKey","value"]),No(Ao,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach((function(e){e in IDBCursor.prototype&&(Ao.prototype[e]=function(){var t=this,n=arguments;return Promise.resolve().then((function(){return t._cursor[e].apply(t._cursor,n),Eo(t._request).then((function(e){if(e)return new Ao(e,t._request)}))}))})})),Oo.prototype.createIndex=function(){return new Ro(this._store.createIndex.apply(this._store,arguments))},Oo.prototype.index=function(){return new Ro(this._store.index.apply(this._store,arguments))},Po(Oo,"_store",["name","keyPath","indexNames","autoIncrement"]),No(Oo,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),xo(Oo,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),Do(Oo,"_store",IDBObjectStore,["deleteIndex"]),Lo.prototype.objectStore=function(){return new Oo(this._tx.objectStore.apply(this._tx,arguments))},Po(Lo,"_tx",["objectStoreNames","mode"]),Do(Lo,"_tx",IDBTransaction,["abort"]),Mo.prototype.createObjectStore=function(){return new Oo(this._db.createObjectStore.apply(this._db,arguments))},Po(Mo,"_db",["name","version","objectStoreNames"]),Do(Mo,"_db",IDBDatabase,["deleteObjectStore","close"]),Fo.prototype.transaction=function(){return new Lo(this._db.transaction.apply(this._db,arguments))},Po(Fo,"_db",["name","version","objectStoreNames"]),Do(Fo,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach((function(e){[Oo,Ro].forEach((function(t){e in t.prototype&&(t.prototype[e.replace("open","iterate")]=function(){var t=So(arguments),n=t[t.length-1],r=this._store||this._index,i=r[e].apply(r,t.slice(0,-1));i.onsuccess=function(){n(i.result)}})}))})),[Ro,Oo].forEach((function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){var n=this,r=[];return new Promise((function(i){n.iterateCursor(e,(function(e){e?(r.push(e.value),void 0===t||r.length!=t?e.continue():i(r)):i(r)}))}))})}));var jo,qo=((jo={})["missing-app-config-values"]='Missing App configuration value: "{$valueName}"',jo["not-registered"]="Firebase Installation is not registered.",jo["installation-not-found"]="Firebase Installation not found.",jo["request-failed"]='{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',jo["app-offline"]="Could not process request. Application offline.",jo["delete-pending-registration"]="Can't delete installation while there is a pending registration request.",jo),Uo=new Ee("installations","Installations",qo);function Qo(e){return e instanceof Se&&e.code.includes("request-failed")}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vo(e){return"https://firebaseinstallations.googleapis.com/v1/projects/"+e.projectId+"/installations"}function Wo(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()};var t}function Ho(e,t){return ne(this,void 0,void 0,(function(){var n,r;return re(this,(function(i){switch(i.label){case 0:return[4,t.json()];case 1:return n=i.sent(),r=n.error,[2,Uo.create("request-failed",{requestName:e,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})]}}))}))}function Bo(e){var t=e.apiKey;return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function $o(e,t){var n=t.refreshToken,r=Bo(e);return r.append("Authorization",function(e){return"FIS_v2 "+e}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(n)),r}function Ko(e){return ne(this,void 0,void 0,(function(){var t;return re(this,(function(n){switch(n.label){case 0:return[4,e()];case 1:return(t=n.sent()).status>=500&&t.status<600?[2,e()]:[2,t]}}))}))}function zo(e,t){var n=t.fid;return ne(this,void 0,void 0,(function(){var t,r,i,o,a,s;return re(this,(function(u){switch(u.label){case 0:return t=Vo(e),r=Bo(e),i={fid:n,authVersion:"FIS_v2",appId:e.appId,sdkVersion:"w:0.4.20"},o={method:"POST",headers:r,body:JSON.stringify(i)},[4,Ko((function(){return fetch(t,o)}))];case 1:return(a=u.sent()).ok?[4,a.json()]:[3,3];case 2:return s=u.sent(),[2,{fid:s.fid||n,registrationStatus:2,refreshToken:s.refreshToken,authToken:Wo(s.authToken)}];case 3:return[4,Ho("Create Installation",a)];case 4:throw u.sent()}}))}))}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Go(e){return new Promise((function(t){setTimeout(t,e)}))}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Yo=/^[cdef][\w-]{21}$/;function Jo(){try{var e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;var t=function(e){return(t=e,btoa(String.fromCharCode.apply(String,ae(t))).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22);var t}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e);return Yo.test(t)?t:""}catch(n){return""}}function Xo(e){return e.appName+"!"+e.appId}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Zo=new Map;function ea(e,t){var n=Xo(e);ta(n,t),function(e,t){var n=ra();n&&n.postMessage({key:e,fid:t});ia()}(n,t)}function ta(e,t){var n,r,i=Zo.get(e);if(i)try{for(var o=ie(i),a=o.next();!a.done;a=o.next()){(0,a.value)(t)}}catch(s){n={error:s}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}}var na=null;function ra(){return!na&&"BroadcastChannel"in self&&((na=new BroadcastChannel("[Firebase] FID Change")).onmessage=function(e){ta(e.data.key,e.data.fid)}),na}function ia(){0===Zo.size&&na&&(na.close(),na=null)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var oa="firebase-installations-store",aa=null;function sa(){var e,t,n;return aa||(e=function(e){switch(e.oldVersion){case 0:e.createObjectStore(oa)}},t=ko(indexedDB,"open",["firebase-installations-database",1]),(n=t.request)&&(n.onupgradeneeded=function(t){e&&e(new Mo(n.result,t.oldVersion,n.transaction))}),aa=t.then((function(e){return new Fo(e)}))),aa}function ua(e,t){return ne(this,void 0,void 0,(function(){var n,r,i,o,a;return re(this,(function(s){switch(s.label){case 0:return n=Xo(e),[4,sa()];case 1:return r=s.sent(),i=r.transaction(oa,"readwrite"),[4,(o=i.objectStore(oa)).get(n)];case 2:return a=s.sent(),[4,o.put(t,n)];case 3:return s.sent(),[4,i.complete];case 4:return s.sent(),a&&a.fid===t.fid||ea(e,t.fid),[2,t]}}))}))}function la(e){return ne(this,void 0,void 0,(function(){var t,n,r;return re(this,(function(i){switch(i.label){case 0:return t=Xo(e),[4,sa()];case 1:return n=i.sent(),[4,(r=n.transaction(oa,"readwrite")).objectStore(oa).delete(t)];case 2:return i.sent(),[4,r.complete];case 3:return i.sent(),[2]}}))}))}function ca(e,t){return ne(this,void 0,void 0,(function(){var n,r,i,o,a,s;return re(this,(function(u){switch(u.label){case 0:return n=Xo(e),[4,sa()];case 1:return r=u.sent(),i=r.transaction(oa,"readwrite"),[4,(o=i.objectStore(oa)).get(n)];case 2:return a=u.sent(),void 0!==(s=t(a))?[3,4]:[4,o.delete(n)];case 3:return u.sent(),[3,6];case 4:return[4,o.put(s,n)];case 5:u.sent(),u.label=6;case 6:return[4,i.complete];case 7:return u.sent(),!s||a&&a.fid===s.fid||ea(e,s.fid),[2,s]}}))}))}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ha(e){return ne(this,void 0,void 0,(function(){var t,n,r;return re(this,(function(i){switch(i.label){case 0:return[4,ca(e,(function(n){var r=function(e){return fa(e||{fid:Jo(),registrationStatus:0})}(n),i=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(Uo.create("app-offline"))};var n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()};return{installationEntry:n,registrationPromise:function(e,t){return ne(this,void 0,void 0,(function(){var n,r;return re(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,7]),[4,zo(e,t)];case 1:return n=i.sent(),[2,ua(e,n)];case 2:return Qo(r=i.sent())&&409===r.customData.serverCode?[4,la(e)]:[3,4];case 3:return i.sent(),[3,6];case 4:return[4,ua(e,{fid:t.fid,registrationStatus:0})];case 5:i.sent(),i.label=6;case 6:throw r;case 7:return[2]}}))}))}(e,n)}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:pa(e)}:{installationEntry:t}}(e,r);return t=i.registrationPromise,i.installationEntry}))];case 1:return""!==(n=i.sent()).fid?[3,3]:(r={},[4,t]);case 2:return[2,(r.installationEntry=i.sent(),r)];case 3:return[2,{installationEntry:n,registrationPromise:t}]}}))}))}function pa(e){return ne(this,void 0,void 0,(function(){var t,n,r,i;return re(this,(function(o){switch(o.label){case 0:return[4,da(e)];case 1:t=o.sent(),o.label=2;case 2:return 1!==t.registrationStatus?[3,5]:[4,Go(100)];case 3:return o.sent(),[4,da(e)];case 4:return t=o.sent(),[3,2];case 5:return 0!==t.registrationStatus?[3,7]:[4,ha(e)];case 6:return n=o.sent(),r=n.installationEntry,(i=n.registrationPromise)?[2,i]:[2,r];case 7:return[2,t]}}))}))}function da(e){return ca(e,(function(e){if(!e)throw Uo.create("installation-not-found");return fa(e)}))}function fa(e){return 1===(t=e).registrationStatus&&t.registrationTime+1e4<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t;
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}function ya(e,t){var n=e.appConfig,r=e.platformLoggerProvider;return ne(this,void 0,void 0,(function(){var e,i,o,a,s,u,l;return re(this,(function(c){switch(c.label){case 0:return e=function(e,t){var n=t.fid;return Vo(e)+"/"+n+"/authTokens:generate"}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(n,t),i=$o(n,t),(o=r.getImmediate({optional:!0}))&&i.append("x-firebase-client",o.getPlatformInfoString()),a={installation:{sdkVersion:"w:0.4.20"}},s={method:"POST",headers:i,body:JSON.stringify(a)},[4,Ko((function(){return fetch(e,s)}))];case 1:return(u=c.sent()).ok?[4,u.json()]:[3,3];case 2:return l=c.sent(),[2,Wo(l)];case 3:return[4,Ho("Generate Auth Token",u)];case 4:throw c.sent()}}))}))}function ma(e,t){return void 0===t&&(t=!1),ne(this,void 0,void 0,(function(){var n,r,i;return re(this,(function(o){switch(o.label){case 0:return[4,ca(e.appConfig,(function(r){if(!ga(r))throw Uo.create("not-registered");var i=r.authToken;if(!t&&function(e){return 2===e.requestStatus&&!function(e){var t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+36e5}(e)}(i))return r;if(1===i.requestStatus)return n=function(e,t){return ne(this,void 0,void 0,(function(){var n,r;return re(this,(function(i){switch(i.label){case 0:return[4,va(e.appConfig)];case 1:n=i.sent(),i.label=2;case 2:return 1!==n.authToken.requestStatus?[3,5]:[4,Go(100)];case 3:return i.sent(),[4,va(e.appConfig)];case 4:return n=i.sent(),[3,2];case 5:return 0===(r=n.authToken).requestStatus?[2,ma(e,t)]:[2,r]}}))}))}(e,t),r;if(!navigator.onLine)throw Uo.create("app-offline");var o=function(e){var t={requestStatus:1,requestTime:Date.now()};return te(te({},e),{authToken:t})}(r);return n=function(e,t){return ne(this,void 0,void 0,(function(){var n,r,i;return re(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,8]),[4,ya(e,t)];case 1:return n=o.sent(),i=te(te({},t),{authToken:n}),[4,ua(e.appConfig,i)];case 2:return o.sent(),[2,n];case 3:return!Qo(r=o.sent())||401!==r.customData.serverCode&&404!==r.customData.serverCode?[3,5]:[4,la(e.appConfig)];case 4:return o.sent(),[3,7];case 5:return i=te(te({},t),{authToken:{requestStatus:0}}),[4,ua(e.appConfig,i)];case 6:o.sent(),o.label=7;case 7:throw r;case 8:return[2]}}))}))}(e,o),o}))];case 1:return r=o.sent(),n?[4,n]:[3,3];case 2:return i=o.sent(),[3,4];case 3:i=r.authToken,o.label=4;case 4:return[2,i]}}))}))}function va(e){return ca(e,(function(e){if(!ga(e))throw Uo.create("not-registered");var t,n=e.authToken;return 1===(t=n).requestStatus&&t.requestTime+1e4<Date.now()?te(te({},e),{authToken:{requestStatus:0}}):e}))}function ga(e){return void 0!==e&&2===e.registrationStatus}function _a(e){return ne(this,void 0,void 0,(function(){var t;return re(this,(function(n){switch(n.label){case 0:return[4,ha(e)];case 1:return(t=n.sent().registrationPromise)?[4,t]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ba(e,t){return ne(this,void 0,void 0,(function(){var n,r,i,o;return re(this,(function(a){switch(a.label){case 0:return n=function(e,t){var n=t.fid;return Vo(e)+"/"+n}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e,t),r=$o(e,t),i={method:"DELETE",headers:r},[4,Ko((function(){return fetch(n,i)}))];case 1:return(o=a.sent()).ok?[3,3]:[4,Ho("Delete Installation",o)];case 2:throw a.sent();case 3:return[2]}}))}))}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function wa(e,t){var n=e.appConfig;return function(e,t){ra();var n=Xo(e),r=Zo.get(n);r||(r=new Set,Zo.set(n,r)),r.add(t)}(n,t),function(){!function(e,t){var n=Xo(e),r=Zo.get(n);r&&(r.delete(t),0===r.size&&Zo.delete(n),ia())}(n,t)}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ca(e){return Uo.create("missing-app-config-values",{valueName:e})}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(e){e.INTERNAL.registerComponent(new Be("installations",(function(e){var t=e.getProvider("app").getImmediate(),n={appConfig:function(e){var t,n;if(!e||!e.options)throw Ca("App Configuration");if(!e.name)throw Ca("App Name");try{for(var r=ie(["projectId","apiKey","appId"]),i=r.next();!i.done;i=r.next()){var o=i.value;if(!e.options[o])throw Ca(o)}}catch(a){t={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t),platformLoggerProvider:e.getProvider("platform-logger")};return{app:t,getId:function(){
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
return function(e){return ne(this,void 0,void 0,(function(){var t,n,r;return re(this,(function(i){switch(i.label){case 0:return[4,ha(e.appConfig)];case 1:return t=i.sent(),n=t.installationEntry,(r=t.registrationPromise)?r.catch(console.error):ma(e).catch(console.error),[2,n.fid]}}))}))}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(n)},getToken:function(e){return function(e,t){return void 0===t&&(t=!1),ne(this,void 0,void 0,(function(){return re(this,(function(n){switch(n.label){case 0:return[4,_a(e.appConfig)];case 1:return n.sent(),[4,ma(e,t)];case 2:return[2,n.sent().token]}}))}))}(n,e)},delete:function(){return function(e){return ne(this,void 0,void 0,(function(){var t,n;return re(this,(function(r){switch(r.label){case 0:return[4,ca(t=e.appConfig,(function(e){if(!e||0!==e.registrationStatus)return e}))];case 1:if(!(n=r.sent()))return[3,6];if(1!==n.registrationStatus)return[3,2];throw Uo.create("delete-pending-registration");case 2:if(2!==n.registrationStatus)return[3,6];if(navigator.onLine)return[3,3];throw Uo.create("app-offline");case 3:return[4,ba(t,n)];case 4:return r.sent(),[4,la(t)];case 5:r.sent(),r.label=6;case 6:return[2]}}))}))}(n)},onIdChange:function(e){return wa(n,e)}}}),"PUBLIC")),e.registerVersion("@firebase/installations","0.4.20")}(_t);
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Ta,Sa,Ea,ka,Ia="https://www.googletagmanager.com/gtag/js";(Sa=Ta||(Ta={})).EVENT="event",Sa.SET="set",Sa.CONFIG="config",(ka=Ea||(Ea={})).ADD_SHIPPING_INFO="add_shipping_info",ka.ADD_PAYMENT_INFO="add_payment_info",ka.ADD_TO_CART="add_to_cart",ka.ADD_TO_WISHLIST="add_to_wishlist",ka.BEGIN_CHECKOUT="begin_checkout",ka.CHECKOUT_PROGRESS="checkout_progress",ka.EXCEPTION="exception",ka.GENERATE_LEAD="generate_lead",ka.LOGIN="login",ka.PAGE_VIEW="page_view",ka.PURCHASE="purchase",ka.REFUND="refund",ka.REMOVE_FROM_CART="remove_from_cart",ka.SCREEN_VIEW="screen_view",ka.SEARCH="search",ka.SELECT_CONTENT="select_content",ka.SELECT_ITEM="select_item",ka.SELECT_PROMOTION="select_promotion",ka.SET_CHECKOUT_OPTION="set_checkout_option",ka.SHARE="share",ka.SIGN_UP="sign_up",ka.TIMING_COMPLETE="timing_complete",ka.VIEW_CART="view_cart",ka.VIEW_ITEM="view_item",ka.VIEW_ITEM_LIST="view_item_list",ka.VIEW_PROMOTION="view_promotion",ka.VIEW_SEARCH_RESULTS="view_search_results";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Pa,Na=new it("@firebase/analytics");
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Da(e,t,n,r,i,o){return ne(this,void 0,void 0,(function(){var a,s,u,l;return re(this,(function(c){switch(c.label){case 0:a=r[i],c.label=1;case 1:return c.trys.push([1,7,,8]),a?[4,t[a]]:[3,3];case 2:return c.sent(),[3,6];case 3:return[4,Promise.all(n)];case 4:return s=c.sent(),(u=s.find((function(e){return e.measurementId===i})))?[4,t[u.appId]]:[3,6];case 5:c.sent(),c.label=6;case 6:return[3,8];case 7:return l=c.sent(),Na.error(l),[3,8];case 8:return e(Ta.CONFIG,i,o),[2]}}))}))}function xa(e,t,n,r,i){return ne(this,void 0,void 0,(function(){var o,a,s,u,l,c,h,p;return re(this,(function(d){switch(d.label){case 0:return d.trys.push([0,4,,5]),o=[],i&&i.send_to?(a=i.send_to,Array.isArray(a)||(a=[a]),[4,Promise.all(n)]):[3,2];case 1:for(s=d.sent(),u=function(e){var n=s.find((function(t){return t.measurementId===e})),r=n&&t[n.appId];if(!r)return o=[],"break";o.push(r)},l=0,c=a;l<c.length&&(h=c[l],"break"!==u(h));l++);d.label=2;case 2:return 0===o.length&&(o=Object.values(t)),[4,Promise.all(o)];case 3:return d.sent(),e(Ta.EVENT,r,i||{}),[3,5];case 4:return p=d.sent(),Na.error(p),[3,5];case 5:return[2]}}))}))}function Ra(e,t,n,r,i){var o=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];window[r].push(arguments)};return window[i]&&"function"==typeof window[i]&&(o=window[i]),window[i]=function(e,t,n,r){return function(i,o,a){return ne(this,void 0,void 0,(function(){var s;return re(this,(function(u){switch(u.label){case 0:return u.trys.push([0,6,,7]),i!==Ta.EVENT?[3,2]:[4,xa(e,t,n,o,a)];case 1:return u.sent(),[3,5];case 2:return i!==Ta.CONFIG?[3,4]:[4,Da(e,t,n,r,o,a)];case 3:return u.sent(),[3,5];case 4:e(Ta.SET,o),u.label=5;case 5:return[3,7];case 6:return s=u.sent(),Na.error(s),[3,7];case 7:return[2]}}))}))}}(o,e,t,n),{gtagCore:o,wrappedGtag:window[i]}}var Aa=((Pa={})["already-exists"]="A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.",Pa["already-initialized"]="Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.",Pa["interop-component-reg-failed"]="Firebase Analytics Interop Component failed to instantiate: {$reason}",Pa["invalid-analytics-context"]="Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}",Pa["indexeddb-unavailable"]="IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}",Pa["fetch-throttle"]="The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.",Pa["config-fetch-failed"]="Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}",Pa["no-api-key"]='The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',Pa["no-app-id"]='The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',Pa),Oa=new Ee("analytics","Analytics",Aa),La=new(function(){function e(e,t){void 0===e&&(e={}),void 0===t&&(t=1e3),this.throttleMetadata=e,this.intervalMillis=t}return e.prototype.getThrottleMetadata=function(e){return this.throttleMetadata[e]},e.prototype.setThrottleMetadata=function(e,t){this.throttleMetadata[e]=t},e.prototype.deleteThrottleMetadata=function(e){delete this.throttleMetadata[e]},e}());function Ma(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}function Fa(e){var t;return ne(this,void 0,void 0,(function(){var n,r,i,o,a,s,u;return re(this,(function(l){switch(l.label){case 0:return n=e.appId,r=e.apiKey,i={method:"GET",headers:Ma(r)},o="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",n),[4,fetch(o,i)];case 1:if(200===(a=l.sent()).status||304===a.status)return[3,6];s="",l.label=2;case 2:return l.trys.push([2,4,,5]),[4,a.json()];case 3:return u=l.sent(),(null===(t=u.error)||void 0===t?void 0:t.message)&&(s=u.error.message),[3,5];case 4:return l.sent(),[3,5];case 5:throw Oa.create("config-fetch-failed",{httpStatus:a.status,responseMessage:s});case 6:return[2,a.json()]}}))}))}function ja(e,t,n,r){var i=t.throttleEndTimeMillis,o=t.backoffCount;return void 0===r&&(r=La),ne(this,void 0,void 0,(function(){var t,a,s,u,l,c,h;return re(this,(function(p){switch(p.label){case 0:t=e.appId,a=e.measurementId,p.label=1;case 1:return p.trys.push([1,3,,4]),[4,qa(n,i)];case 2:return p.sent(),[3,4];case 3:if(s=p.sent(),a)return Na.warn("Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID "+a+' provided in the "measurementId" field in the local Firebase config. ['+s.message+"]"),[2,{appId:t,measurementId:a}];throw s;case 4:return p.trys.push([4,6,,7]),[4,Fa(e)];case 5:return u=p.sent(),r.deleteThrottleMetadata(t),[2,u];case 6:if(!function(e){if(!(e instanceof Se&&e.customData))return!1;var t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(l=p.sent())){if(r.deleteThrottleMetadata(t),a)return Na.warn("Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID "+a+' provided in the "measurementId" field in the local Firebase config. ['+l.message+"]"),[2,{appId:t,measurementId:a}];throw l}return c=503===Number(l.customData.httpStatus)?He(o,r.intervalMillis,30):He(o,r.intervalMillis),h={throttleEndTimeMillis:Date.now()+c,backoffCount:o+1},r.setThrottleMetadata(t,h),Na.debug("Calling attemptFetch again in "+c+" millis"),[2,ja(e,h,n,r)];case 7:return[2]}}))}))}function qa(e,t){return new Promise((function(n,r){var i=Math.max(t-Date.now(),0),o=setTimeout(n,i);e.addEventListener((function(){clearTimeout(o),r(Oa.create("fetch-throttle",{throttleEndTimeMillis:t}))}))}))}var Ua=function(){function e(){this.listeners=[]}return e.prototype.addEventListener=function(e){this.listeners.push(e)},e.prototype.abort=function(){this.listeners.forEach((function(e){return e()}))},e}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qa(e,t,n,r,i,o){return ne(this,void 0,void 0,(function(){var a,s,u,l,c,h,p;return re(this,(function(d){switch(d.label){case 0:return(a=function(e,t,n){return void 0===t&&(t=La),ne(this,void 0,void 0,(function(){var r,i,o,a,s,u,l=this;return re(this,(function(c){if(r=e.options,i=r.appId,o=r.apiKey,a=r.measurementId,!i)throw Oa.create("no-app-id");if(!o){if(a)return[2,{measurementId:a,appId:i}];throw Oa.create("no-api-key")}return s=t.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},u=new Ua,setTimeout((function(){return ne(l,void 0,void 0,(function(){return re(this,(function(e){return u.abort(),[2]}))}))}),void 0!==n?n:6e4),[2,ja({appId:i,apiKey:o,measurementId:a},s,u,t)]}))}))}(e)).then((function(t){n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&Na.warn("The measurement ID in the local Firebase config ("+e.options.measurementId+") does not match the measurement ID fetched from the server ("+t.measurementId+"). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.")})).catch((function(e){return Na.error(e)})),t.push(a),s=function(){return ne(this,void 0,void 0,(function(){var e;return re(this,(function(t){switch(t.label){case 0:return we()?[3,1]:(Na.warn(Oa.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),[2,!1]);case 1:return t.trys.push([1,3,,4]),[4,Ce()];case 2:return t.sent(),[3,4];case 3:return e=t.sent(),Na.warn(Oa.create("indexeddb-unavailable",{errorInfo:e}).message),[2,!1];case 4:return[2,!0]}}))}))}().then((function(e){return e?r.getId():void 0})),[4,Promise.all([a,s])];case 1:return u=d.sent(),l=u[0],c=u[1],function(){for(var e=window.document.getElementsByTagName("script"),t=0,n=Object.values(e);t<n.length;t++){var r=n[t];if(r.src&&r.src.includes(Ia))return r}return null}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */()||function(e,t){var n=document.createElement("script");n.src=Ia+"?l="+e+"&id="+t,n.async=!0,document.head.appendChild(n)}(o,l.measurementId),i("js",new Date),(p={}).origin="firebase",p.update=!0,h=p,null!=c&&(h.firebase_id=c),i(Ta.CONFIG,l.measurementId,h),[2,l.measurementId]}}))}))}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Va,Wa,Ha={},Ba=[],$a={},Ka="dataLayer",za="gtag",Ga=!1;function Ya(e){if(Ga)throw Oa.create("already-initialized");e.dataLayerName&&(Ka=e.dataLayerName),e.gtagName&&(za=e.gtagName)}function Ja(e,t){!function(){var e=[];if(_e()&&e.push("This is a browser extension environment."),Te()||e.push("Cookies are not available."),e.length>0){var t=e.map((function(e,t){return"("+(t+1)+") "+e})).join(" "),n=Oa.create("invalid-analytics-context",{errorInfo:t});Na.warn(n.message)}}();var n,r,i=e.options.appId;if(!i)throw Oa.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw Oa.create("no-api-key");Na.warn('The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID '+e.options.measurementId+' provided in the "measurementId" field in the local Firebase config.')}if(null!=Ha[i])throw Oa.create("already-exists",{id:i});if(!Ga){n=Ka,r=[],Array.isArray(window[n])?r=window[n]:window[n]=r;var o=Ra(Ha,Ba,$a,Ka,za),a=o.wrappedGtag,s=o.gtagCore;Wa=a,Va=s,Ga=!0}return Ha[i]=Qa(e,Ba,$a,t,Va,Ka),{app:e,logEvent:function(e,t,n){(
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(e,t,n,r,i){return ne(this,void 0,void 0,(function(){var o,a;return re(this,(function(s){switch(s.label){case 0:return i&&i.global?(e(Ta.EVENT,n,r),[2]):[3,1];case 1:return[4,t];case 2:o=s.sent(),a=te(te({},r),{send_to:o}),e(Ta.EVENT,n,a),s.label=3;case 3:return[2]}}))}))})(Wa,Ha[i],e,t,n).catch((function(e){return Na.error(e)}))},setCurrentScreen:function(e,t){(function(e,t,n,r){return ne(this,void 0,void 0,(function(){var i;return re(this,(function(o){switch(o.label){case 0:return r&&r.global?(e(Ta.SET,{screen_name:n}),[2,Promise.resolve()]):[3,1];case 1:return[4,t];case 2:i=o.sent(),e(Ta.CONFIG,i,{update:!0,screen_name:n}),o.label=3;case 3:return[2]}}))}))})(Wa,Ha[i],e,t).catch((function(e){return Na.error(e)}))},setUserId:function(e,t){(function(e,t,n,r){return ne(this,void 0,void 0,(function(){var i;return re(this,(function(o){switch(o.label){case 0:return r&&r.global?(e(Ta.SET,{user_id:n}),[2,Promise.resolve()]):[3,1];case 1:return[4,t];case 2:i=o.sent(),e(Ta.CONFIG,i,{update:!0,user_id:n}),o.label=3;case 3:return[2]}}))}))})(Wa,Ha[i],e,t).catch((function(e){return Na.error(e)}))},setUserProperties:function(e,t){(function(e,t,n,r){return ne(this,void 0,void 0,(function(){var i,o,a,s,u;return re(this,(function(l){switch(l.label){case 0:if(!r||!r.global)return[3,1];for(i={},o=0,a=Object.keys(n);o<a.length;o++)s=a[o],i["user_properties."+s]=n[s];return e(Ta.SET,i),[2,Promise.resolve()];case 1:return[4,t];case 2:u=l.sent(),e(Ta.CONFIG,u,{update:!0,user_properties:n}),l.label=3;case 3:return[2]}}))}))})(Wa,Ha[i],e,t).catch((function(e){return Na.error(e)}))},setAnalyticsCollectionEnabled:function(e){(function(e,t){return ne(this,void 0,void 0,(function(){var n;return re(this,(function(r){switch(r.label){case 0:return[4,e];case 1:return n=r.sent(),window["ga-disable-"+n]=!t,[2]}}))}))})(Ha[i],e).catch((function(e){return Na.error(e)}))},INTERNAL:{delete:function(){return delete Ha[i],Promise.resolve()}}}}function Xa(){return ne(this,void 0,void 0,(function(){return re(this,(function(e){switch(e.label){case 0:if(_e())return[2,!1];if(!Te())return[2,!1];if(!we())return[2,!1];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,Ce()];case 2:return[2,e.sent()];case 3:return e.sent(),[2,!1];case 4:return[2]}}))}))}!function(e){e.INTERNAL.registerComponent(new Be("analytics",(function(e){return Ja(e.getProvider("app").getImmediate(),e.getProvider("installations").getImmediate())}),"PUBLIC").setServiceProps({settings:Ya,EventName:Ea,isSupported:Xa})),e.INTERNAL.registerComponent(new Be("analytics-internal",(function(e){try{return{logEvent:e.getProvider("analytics").getImmediate().logEvent}}catch(t){throw Oa.create("interop-component-reg-failed",{reason:t})}}),"PRIVATE")),e.registerVersion("@firebase/analytics","0.6.4")}(_t);let Za;_t.initializeApp({apiKey:"AIzaSyB-HWD3Pt7BfqvinZMrAp9oWsZSHlQT7HE",authDomain:"jukebox-g100.firebaseapp.com",databaseURL:"https://jukebox-g100-default-rtdb.firebaseio.com",projectId:"jukebox-g100",storageBucket:"jukebox-g100.appspot.com",messagingSenderId:"1011719496683",appId:"1:1011719496683:web:cc26d5b6947bfa0a2a2fae",measurementId:"G-ZHDT9YNGWR"}),_t.analytics();const es=e=>{if("string"!=typeof e)return"";const t=e.split(":")[1];return e.replace(`spotify:${t}:`,`https://open.spotify.com/${t}/`)},ts={id:!1,name:"---",artists:[{name:"G100",url:"https://github.com/G100my/Jukebox"}],album:{url:"",name:"---",image_url:""},is_playable:!0},ns={added_time:"",added_by:"",note:!1,order_key:null,id:""},rs={state:{volume:30,minimal_volume:20,playing_track:e({},ts),latest_queue:e({},ns),dislike:0,dislike_threshold:2,dislike_countdown:!1,isVoted:!1},getters:{playerPlayingTrackId:e=>e.playing_track.id,playerPlayingArtists:e=>e.playing_track.artists,playerPlayingAlbum:e=>e.playing_track.album,playerPlayingTrackName:e=>e.playing_track.name,currentVolume:e=>e.volume,currentMinimalVolume:e=>e.minimal_volume,currentDislikeThreshold:e=>e.dislike_threshold,currentDislike:e=>e.dislike,currentDislikeCountdown:e=>e.dislike_countdown,latestQueue:e=>e.latest_queue},mutations:{refreshPlayerTrack(t,n){t.playing_track=n||e({},ts)},refreshTheLatestQueue(t,n){t.latest_queue=null===n?e({},ns):n},adjustVolume(e,t){e.volume=t},adjustDislike(e,t){e.dislike=t},adjustMinimalVolume(e,t){e.minimal_volume=t},adjustDislikeThreshold(e,t){e.dislike_threshold=t},adjustDislikeCountdown(e,t){e.dislike_countdown=t}},actions:{turnUp({state:e}){const t=e.volume+2;t<=100&&Za.update({volume:t})},turnDown({state:e}){const t=e.volume-2;t>=e.minimal_volume&&Za.update({volume:t})},reduceDislike({state:e,getters:t}){const n=e.dislike-1;n>=0&&(Za.update({dislike:n}),Za.child(`voted_users/${t.userId}`).remove())},increaseDislike({state:e,getters:t}){const n=e.dislike+1;if(n<=e.dislike_threshold){Za.update({dislike:n});const e={};e[t.userId]=!0,Za.child("voted_users").update(e)}},clearDislikeVote(){Za.child("dislike").set(0),Za.child("voted_users").set(null)},adjustIsVoted({state:e,getters:t},n){t.userId&&(e.isVoted=n.hasChild(t.userId))},updatePlayingTrack(e,t){const n={name:t.name,id:t.id,artists:t.artists.map((e=>(e.url=es(e.uri),delete e.uri,e))),album:{name:t.album.name,image_url:t.album.images.find((e=>e.height>=300)).url,url:es(t.album.uri)}};Za.child("playing_track").set(n)},updateTheLatestQueue(e,t){Za.child("latest_queue").set(t)},clearPlayingTrack(){Za.update({playing_track:ts,latest_queue:ns})},updateMinimalVolume(e,t){Za.child("minimal_volume").set(t)},updateDislikeThreshold(e,t){Za.child("dislike_threshold").set(t)},updateDislikeCountdown(e,t){Za.child("dislike_countdown").set(t)}}};function is(e){return("0"+e.toString(16)).substr(-2)}async function os(e){return function(e){let t="",n=new Uint8Array(e),r=n.byteLength;for(let i=0;i<r;i++)t+=String.fromCharCode(n[i]);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}(await function(e){const t=(new TextEncoder).encode(e);return window.crypto.subtle.digest("SHA-256",t)}(e))}const as="a0612a2584de431dad27571e6d46d6a9";async function ss(e){const t=function(){let e=new Uint32Array(28);return window.crypto.getRandomValues(e),Array.from(e,is).join("")}();localStorage.setItem("jukebox_code_verifier",t);const n=await os(t);let r="https://accounts.spotify.com/authorize";r+="?response_type=code",r+="&client_id="+encodeURIComponent(as),r+="&redirect_uri="+encodeURIComponent("https://g100my.github.io/Jukebox/"+e),r+="&scope="+encodeURIComponent("user-library-modify user-library-read playlist-modify-public playlist-modify-private user-read-recently-played user-top-read user-modify-playback-state user-read-currently-playing user-read-playback-state user-read-playback-position streaming user-read-email user-read-private"),r+="&code_challenge_method=S256",r+="&code_challenge="+n,window.location=r}async function us(){let e="client_id="+as;return e+="&grant_type=refresh_token",e+="&refresh_token="+Cs.getters.refreshToken,fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:new Headers({"Content-Type":"application/x-www-form-urlencoded"}),body:e}).then((e=>{if(e.ok)return e.json();console.error("something wrong in refreshAccessToken",e)})).then((e=>{const{access_token:t,expires_in:n,refresh_token:r}=e,i=1e3*n+Date.now();Cs.commit("refreshToken",{access_token:t,expiredTime:i,refresh_token:r})}))}window.refreshAccessToken=us;var ls,cs,hs,ps,ds,fs,ys,ms,vs=(ls="https://api.spotify.com/v1",cs=null,hs=null,ps=function(e,t){return e.abort=t,e},ds=function(){var e=Array.prototype.slice.call(arguments),t=e[0],n=e.slice(1);return t=t||{},n.forEach((function(e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})),t},fs=function(e,t){var n=new XMLHttpRequest,r=function(r,i){var o=e.type||"GET";if(n.open(o,function(e,t){var n="";for(var r in t)if(t.hasOwnProperty(r)){var i=t[r];n+=encodeURIComponent(r)+"="+encodeURIComponent(i)+"&"}return n.length>0&&(e=e+"?"+(n=n.substring(0,n.length-1))),e}(e.url,e.params)),cs&&n.setRequestHeader("Authorization","Bearer "+cs),n.onreadystatechange=function(){if(4===n.readyState){var e=null;try{e=n.responseText?JSON.parse(n.responseText):""}catch(o){console.error(o)}n.status>=200&&n.status<300?function(e){r&&r(e),t&&t(null,e)}(e):(i&&i(n),t&&t(n,null))}},"GET"===o)n.send(null);else{var a=null;e.postData&&("image/jpeg"===e.contentType?(a=e.postData,n.setRequestHeader("Content-Type",e.contentType)):(a=JSON.stringify(e.postData),n.setRequestHeader("Content-Type","application/json"))),n.send(a)}};return t?(r(),null):function(e,t){var n;if(null!==hs){var r=hs.defer();e((function(e){r.resolve(e)}),(function(e){r.reject(e)})),n=r.promise}else window.Promise&&(n=new window.Promise(e));return n?new ps(n,t):null}(r,(function(){n.abort()}))},ys=function(e,t,n,r){var i={},o=null;return"object"==typeof t?(i=t,o=n):"function"==typeof t&&(o=t),"GET"!==(e.type||"GET")&&e.postData&&!r?e.postData=ds(e.postData,i):e.params=ds(e.params,i),fs(e,o)},((ms=function(){}).prototype={constructor:vs}).getGeneric=function(e,t){return ys({url:e},t)},ms.prototype.getMe=function(e,t){return ys({url:ls+"/me"},e,t)},ms.prototype.getMySavedTracks=function(e,t){return ys({url:ls+"/me/tracks"},e,t)},ms.prototype.addToMySavedTracks=function(e,t,n){return ys({url:ls+"/me/tracks",type:"PUT",postData:e},t,n)},ms.prototype.removeFromMySavedTracks=function(e,t,n){return ys({url:ls+"/me/tracks",type:"DELETE",postData:e},t,n)},ms.prototype.containsMySavedTracks=function(e,t,n){var r={url:ls+"/me/tracks/contains",params:{ids:e.join(",")}};return ys(r,t,n)},ms.prototype.getMySavedAlbums=function(e,t){return ys({url:ls+"/me/albums"},e,t)},ms.prototype.addToMySavedAlbums=function(e,t,n){return ys({url:ls+"/me/albums",type:"PUT",postData:e},t,n)},ms.prototype.removeFromMySavedAlbums=function(e,t,n){return ys({url:ls+"/me/albums",type:"DELETE",postData:e},t,n)},ms.prototype.containsMySavedAlbums=function(e,t,n){var r={url:ls+"/me/albums/contains",params:{ids:e.join(",")}};return ys(r,t,n)},ms.prototype.getMyTopArtists=function(e,t){return ys({url:ls+"/me/top/artists"},e,t)},ms.prototype.getMyTopTracks=function(e,t){return ys({url:ls+"/me/top/tracks"},e,t)},ms.prototype.getMyRecentlyPlayedTracks=function(e,t){return ys({url:ls+"/me/player/recently-played"},e,t)},ms.prototype.followUsers=function(e,t){var n={url:ls+"/me/following/",type:"PUT",params:{ids:e.join(","),type:"user"}};return ys(n,t)},ms.prototype.followArtists=function(e,t){var n={url:ls+"/me/following/",type:"PUT",params:{ids:e.join(","),type:"artist"}};return ys(n,t)},ms.prototype.followPlaylist=function(e,t,n){return ys({url:ls+"/playlists/"+e+"/followers",type:"PUT",postData:{}},t,n)},ms.prototype.unfollowUsers=function(e,t){var n={url:ls+"/me/following/",type:"DELETE",params:{ids:e.join(","),type:"user"}};return ys(n,t)},ms.prototype.unfollowArtists=function(e,t){var n={url:ls+"/me/following/",type:"DELETE",params:{ids:e.join(","),type:"artist"}};return ys(n,t)},ms.prototype.unfollowPlaylist=function(e,t){return ys({url:ls+"/playlists/"+e+"/followers",type:"DELETE"},t)},ms.prototype.isFollowingUsers=function(e,t){var n={url:ls+"/me/following/contains",type:"GET",params:{ids:e.join(","),type:"user"}};return ys(n,t)},ms.prototype.isFollowingArtists=function(e,t){var n={url:ls+"/me/following/contains",type:"GET",params:{ids:e.join(","),type:"artist"}};return ys(n,t)},ms.prototype.areFollowingPlaylist=function(e,t,n){var r={url:ls+"/playlists/"+e+"/followers/contains",type:"GET",params:{ids:t.join(",")}};return ys(r,n)},ms.prototype.getFollowedArtists=function(e,t){return ys({url:ls+"/me/following",type:"GET",params:{type:"artist"}},e,t)},ms.prototype.getUser=function(e,t,n){var r={url:ls+"/users/"+encodeURIComponent(e)};return ys(r,t,n)},ms.prototype.getUserPlaylists=function(e,t,n){var r;return"string"==typeof e?r={url:ls+"/users/"+encodeURIComponent(e)+"/playlists"}:(r={url:ls+"/me/playlists"},n=t,t=e),ys(r,t,n)},ms.prototype.getPlaylist=function(e,t,n){return ys({url:ls+"/playlists/"+e},t,n)},ms.prototype.getPlaylistTracks=function(e,t,n){return ys({url:ls+"/playlists/"+e+"/tracks"},t,n)},ms.prototype.getPlaylistCoverImage=function(e,t){return ys({url:ls+"/playlists/"+e+"/images"},t)},ms.prototype.createPlaylist=function(e,t,n){var r={url:ls+"/users/"+encodeURIComponent(e)+"/playlists",type:"POST",postData:t};return ys(r,t,n)},ms.prototype.changePlaylistDetails=function(e,t,n){return ys({url:ls+"/playlists/"+e,type:"PUT",postData:t},t,n)},ms.prototype.addTracksToPlaylist=function(e,t,n,r){return ys({url:ls+"/playlists/"+e+"/tracks",type:"POST",postData:{uris:t}},n,r,!0)},ms.prototype.replaceTracksInPlaylist=function(e,t,n){return ys({url:ls+"/playlists/"+e+"/tracks",type:"PUT",postData:{uris:t}},{},n)},ms.prototype.reorderTracksInPlaylist=function(e,t,n,r,i){return ys({url:ls+"/playlists/"+e+"/tracks",type:"PUT",postData:{range_start:t,insert_before:n}},r,i)},ms.prototype.removeTracksFromPlaylist=function(e,t,n){var r=t.map((function(e){return"string"==typeof e?{uri:e}:e}));return ys({url:ls+"/playlists/"+e+"/tracks",type:"DELETE",postData:{tracks:r}},{},n)},ms.prototype.removeTracksFromPlaylistWithSnapshotId=function(e,t,n,r){var i=t.map((function(e){return"string"==typeof e?{uri:e}:e}));return ys({url:ls+"/playlists/"+e+"/tracks",type:"DELETE",postData:{tracks:i,snapshot_id:n}},{},r)},ms.prototype.removeTracksFromPlaylistInPositions=function(e,t,n,r){return ys({url:ls+"/playlists/"+e+"/tracks",type:"DELETE",postData:{positions:t,snapshot_id:n}},{},r)},ms.prototype.uploadCustomPlaylistCoverImage=function(e,t,n){var r={url:ls+"/playlists/"+e+"/images",type:"PUT",postData:t.replace(/^data:image\/jpeg;base64,/,""),contentType:"image/jpeg"};return ys(r,{},n)},ms.prototype.getAlbum=function(e,t,n){return ys({url:ls+"/albums/"+e},t,n)},ms.prototype.getAlbumTracks=function(e,t,n){return ys({url:ls+"/albums/"+e+"/tracks"},t,n)},ms.prototype.getAlbums=function(e,t,n){var r={url:ls+"/albums/",params:{ids:e.join(",")}};return ys(r,t,n)},ms.prototype.getTrack=function(e,t,n){var r={};return r.url=ls+"/tracks/"+e,ys(r,t,n)},ms.prototype.getTracks=function(e,t,n){var r={url:ls+"/tracks/",params:{ids:e.join(",")}};return ys(r,t,n)},ms.prototype.getArtist=function(e,t,n){return ys({url:ls+"/artists/"+e},t,n)},ms.prototype.getArtists=function(e,t,n){var r={url:ls+"/artists/",params:{ids:e.join(",")}};return ys(r,t,n)},ms.prototype.getArtistAlbums=function(e,t,n){return ys({url:ls+"/artists/"+e+"/albums"},t,n)},ms.prototype.getArtistTopTracks=function(e,t,n,r){return ys({url:ls+"/artists/"+e+"/top-tracks",params:{country:t}},n,r)},ms.prototype.getArtistRelatedArtists=function(e,t,n){return ys({url:ls+"/artists/"+e+"/related-artists"},t,n)},ms.prototype.getFeaturedPlaylists=function(e,t){return ys({url:ls+"/browse/featured-playlists"},e,t)},ms.prototype.getNewReleases=function(e,t){return ys({url:ls+"/browse/new-releases"},e,t)},ms.prototype.getCategories=function(e,t){return ys({url:ls+"/browse/categories"},e,t)},ms.prototype.getCategory=function(e,t,n){return ys({url:ls+"/browse/categories/"+e},t,n)},ms.prototype.getCategoryPlaylists=function(e,t,n){return ys({url:ls+"/browse/categories/"+e+"/playlists"},t,n)},ms.prototype.search=function(e,t,n,r){var i={url:ls+"/search/",params:{q:e,type:t.join(",")}};return ys(i,n,r)},ms.prototype.searchAlbums=function(e,t,n){return this.search(e,["album"],t,n)},ms.prototype.searchArtists=function(e,t,n){return this.search(e,["artist"],t,n)},ms.prototype.searchTracks=function(e,t,n){return this.search(e,["track"],t,n)},ms.prototype.searchPlaylists=function(e,t,n){return this.search(e,["playlist"],t,n)},ms.prototype.searchShows=function(e,t,n){return this.search(e,["show"],t,n)},ms.prototype.searchEpisodes=function(e,t,n){return this.search(e,["episode"],t,n)},ms.prototype.getAudioFeaturesForTrack=function(e,t){var n={};return n.url=ls+"/audio-features/"+e,ys(n,{},t)},ms.prototype.getAudioFeaturesForTracks=function(e,t){return ys({url:ls+"/audio-features",params:{ids:e}},{},t)},ms.prototype.getAudioAnalysisForTrack=function(e,t){var n={};return n.url=ls+"/audio-analysis/"+e,ys(n,{},t)},ms.prototype.getRecommendations=function(e,t){return ys({url:ls+"/recommendations"},e,t)},ms.prototype.getAvailableGenreSeeds=function(e){return ys({url:ls+"/recommendations/available-genre-seeds"},{},e)},ms.prototype.getMyDevices=function(e){return ys({url:ls+"/me/player/devices"},{},e)},ms.prototype.getMyCurrentPlaybackState=function(e,t){return ys({url:ls+"/me/player"},e,t)},ms.prototype.getMyCurrentPlayingTrack=function(e,t){return ys({url:ls+"/me/player/currently-playing"},e,t)},ms.prototype.transferMyPlayback=function(e,t,n){var r=t||{};return r.device_ids=e,ys({type:"PUT",url:ls+"/me/player",postData:r},t,n)},ms.prototype.play=function(e,t){var n="device_id"in(e=e||{})?{device_id:e.device_id}:null,r={};return["context_uri","uris","offset","position_ms"].forEach((function(t){t in e&&(r[t]=e[t])})),ys({type:"PUT",url:ls+"/me/player/play",params:n,postData:r},"function"==typeof e?e:{},t)},ms.prototype.queue=function(e,t,n){var r="device_id"in(t=t||{})?{uri:e,device_id:t.device_id}:{uri:e};return ys({type:"POST",url:ls+"/me/player/queue",params:r},t,n)},ms.prototype.pause=function(e,t){var n="device_id"in(e=e||{})?{device_id:e.device_id}:null;return ys({type:"PUT",url:ls+"/me/player/pause",params:n},e,t)},ms.prototype.skipToNext=function(e,t){var n="device_id"in(e=e||{})?{device_id:e.device_id}:null;return ys({type:"POST",url:ls+"/me/player/next",params:n},e,t)},ms.prototype.skipToPrevious=function(e,t){var n="device_id"in(e=e||{})?{device_id:e.device_id}:null;return ys({type:"POST",url:ls+"/me/player/previous",params:n},e,t)},ms.prototype.seek=function(e,t,n){var r={position_ms:e};return"device_id"in(t=t||{})&&(r.device_id=t.device_id),ys({type:"PUT",url:ls+"/me/player/seek",params:r},t,n)},ms.prototype.setRepeat=function(e,t,n){var r={state:e};return"device_id"in(t=t||{})&&(r.device_id=t.device_id),ys({type:"PUT",url:ls+"/me/player/repeat",params:r},t,n)},ms.prototype.setVolume=function(e,t,n){var r={volume_percent:e};return"device_id"in(t=t||{})&&(r.device_id=t.device_id),ys({type:"PUT",url:ls+"/me/player/volume",params:r},t,n)},ms.prototype.setShuffle=function(e,t,n){var r={state:e};return"device_id"in(t=t||{})&&(r.device_id=t.device_id),ys({type:"PUT",url:ls+"/me/player/shuffle",params:r},t,n)},ms.prototype.getShow=function(e,t,n){var r={};return r.url=ls+"/shows/"+e,ys(r,t,n)},ms.prototype.getShows=function(e,t,n){var r={url:ls+"/shows/",params:{ids:e.join(",")}};return ys(r,t,n)},ms.prototype.getMySavedShows=function(e,t){return ys({url:ls+"/me/shows"},e,t)},ms.prototype.addToMySavedShows=function(e,t,n){return ys({url:ls+"/me/shows",type:"PUT",postData:e},t,n)},ms.prototype.removeFromMySavedShows=function(e,t,n){return ys({url:ls+"/me/shows",type:"DELETE",postData:e},t,n)},ms.prototype.containsMySavedShows=function(e,t,n){var r={url:ls+"/me/shows/contains",params:{ids:e.join(",")}};return ys(r,t,n)},ms.prototype.getShowEpisodes=function(e,t,n){return ys({url:ls+"/shows/"+e+"/episodes"},t,n)},ms.prototype.getEpisode=function(e,t,n){var r={};return r.url=ls+"/episodes/"+e,ys(r,t,n)},ms.prototype.getEpisodes=function(e,t,n){var r={url:ls+"/episodes/",params:{ids:e.join(",")}};return ys(r,t,n)},ms.prototype.getAccessToken=function(){return cs},ms.prototype.setAccessToken=function(e){cs=e},ms.prototype.setPromiseImplementation=function(e){var t=!1;try{var n=new e((function(e){e()}));"function"==typeof n.then&&"function"==typeof n.catch&&(t=!0)}catch(r){console.error(r)}if(!t)throw new Error("Unsupported implementation of Promises/A+");hs=e},ms);const gs=new Proxy(new vs,{get:function(e,t){return"getAccessToken"===t||"setAccessToken"===t||Cs.getters.isTokenValid?e[t]:(...n)=>us().then((()=>{gs.setAccessToken(Cs.getters.token),e[t](...n)})).catch((e=>{console.log("error when refreshAccessToken",e)}))}});var _s={install:e=>{e.config.globalProperties.$spotifyAPI=gs,window.$spotifyAPI=gs,e.provide("spotifyAPI",gs)}};const bs={state:{user_id:localStorage.getItem("jukebox_user_id")||null,display_name:localStorage.getItem("jukebox_user_display_name")||null,image_url:localStorage.getItem("jukebox_user_images")||"",token:localStorage.getItem("jukebox_token")||null,expired_time:Number(localStorage.getItem("jukebox_expired_time"))||null,refresh_token:localStorage.getItem("jukebox_refresh_token")||null},getters:{token:e=>e.token,isTokenValid(e){if(null===e.expired_time)return!1;const t=Date.now();return e.expired_time>t},userId:e=>e.user_id,userName:e=>e.display_name,refreshToken:e=>e.refresh_token},mutations:{refreshToken(e,{access_token:t,expiredTime:n,refresh_token:r}){e.token=t,e.expired_time=n,e.refresh_token=r,localStorage.setItem("jukebox_token",t),localStorage.setItem("jukebox_expired_time",n),localStorage.setItem("jukebox_refresh_token",r),gs.setAccessToken(t)},updateUserData(e,{id:t,display_name:n,images:r}){e.user_id=t,e.display_name=n,localStorage.setItem("jukebox_user_id",t),localStorage.setItem("jukebox_user_display_name",n),console.log(r),r.length>0&&(e.image_url=r[0].url,localStorage.setItem("jukebox_user_images",r[0].url))}}};let ws;const Cs=(Ts={modules:{Personal:bs,PlayingState:rs,UserLog:{state:{log:[]},getters:{userLog:e=>e.log},mutations:{pushUserLog(e,t){e.log.unshift(t)>3&&e.log.pop()}}},RoomBasic:{state:{room_key:"",room_name:"",host_id:""},getters:{roomKey:e=>e.room_key,roomName:e=>e.room_name,hostId:e=>e.host_id},mutations:{setRoomBasicInfo(e,t){const{room_key:n,room_name:r,host_id:i}=t;e.room_key=n,e.room_name=r,e.host_id=i}}}},plugins:[function(e){void 0===e&&(e={});var t=e.collapsed;void 0===t&&(t=!0);var n=e.filter;void 0===n&&(n=function(e,t,n){return!0});var r=e.transformer;void 0===r&&(r=function(e){return e});var i=e.mutationTransformer;void 0===i&&(i=function(e){return e});var o=e.actionFilter;void 0===o&&(o=function(e,t){return!0});var a=e.actionTransformer;void 0===a&&(a=function(e){return e});var s=e.logMutations;void 0===s&&(s=!0);var u=e.logActions;void 0===u&&(u=!0);var l=e.logger;return void 0===l&&(l=console),function(e){var c=N(e.state);void 0!==l&&(s&&e.subscribe((function(e,o){var a=N(o);if(n(e,c,a)){var s=J(),u=i(e),h="mutation "+e.type+s;G(l,h,t),l.log("%c prev state","color: #9E9E9E; font-weight: bold",r(c)),l.log("%c mutation","color: #03A9F4; font-weight: bold",u),l.log("%c next state","color: #4CAF50; font-weight: bold",r(a)),Y(l)}c=a})),u&&e.subscribeAction((function(e,n){if(o(e,n)){var r=J(),i=a(e),s="action "+e.type+r;G(l,s,t),l.log("%c action","color: #03A9F4; font-weight: bold",i),Y(l)}})))}}()]},new M(Ts));var Ts;let Ss,Es,ks;function Is(e,t,n){e.on("child_removed",(e=>{n.commit("deleteQueueTrack",{storeTarget:t,oldChildSnapshot:e})})),e.on("child_added",(e=>{const r=e.val().id;if(n.getters.previousDeleted&&n.getters.previousDeleted.id===r)return n.commit("addQueueTrack",{storeTarget:t,childSnapshot:e,addedTrack:n.getters.previousDeleted}),void n.commit("clearPreviousDeleted");gs.getAccessToken()?gs.getTrack(r).then((r=>{n.commit("addQueueTrack",{storeTarget:t,childSnapshot:e,addedTrack:r})})):console.warn("spotifyAPI.getAccessToken() is "+gs.getAccessToken())})),e.on("child_changed",(e=>{n.commit("editQueue",{storeTarget:t,childSnapshot:e})}))}const Ps={state:{normal_queue:{},urgent_queue:{},pending_queue:null,trackData:{pending:null},previousDeleted:null},getters:{trackData:e=>e.trackData,pendingQueue:e=>e.pending_queue,normalQueue:e=>e.normal_queue,urgentQueue:e=>e.urgent_queue,previousDeleted:e=>e.previousDeleted,leftQueueAmount(e){const t=Object.keys(e.urgent_queue),n=Object.keys(e.normal_queue);return t.length+n.length},pendingNote:e=>e.pending_queue?e.pending_queue.note:null},mutations:{clearPreviousDeleted(e){e.previousDeleted=null},clearPendingQueue(e){e.pending_queue=null,delete e.trackData.pending},deleteQueueTrack(e,{storeTarget:t,oldChildSnapshot:n}){const r=n.key;e.previousDeleted=e.trackData[r],delete e.trackData[r],delete e[`${t}_queue`][r]},addQueueTrack(e,{storeTarget:t,childSnapshot:n,addedTrack:r}){const i=n.key;e[`${t}_queue`][i]=n.val(),e.trackData[i]=r},editQueue(e,{storeTarget:t,childSnapshot:n}){const r=n.key;e[`${t}_queue`][r]=n.val()},refreshPendingQueue(e,t){e.pending_queue=t},refreshPendingTrack(e,t){e.trackData.pending=t}},actions:{add({getters:e},{id:t,note:n,trackNameForLog:r}){const i=Date.now(),o={},a=e.userId;o[`${i}-${a}`]={id:t,added_time:i,added_by:a,note:n,track_name:r},Es.update(o)},jumpIn({getters:e},{id:t,note:n,trackNameForLog:r}){const i=Date.now(),o=e.userId;Ss.push({id:t,added_time:i,added_by:o,note:n,track_name:r})},urgentRemove(e,{queueKey:t}){Ss.child(t).remove()},normalRemove(e,{queueKey:t}){Es.child(t).remove()},urgent2normal({state:t},{queueKey:n}){const r=e({},t.urgent_queue[n]);r.note=!1;const i=`${r.added_time}-${r.added_by}`,o={};o[i]=r,Ss.child(n).remove().then((()=>{Es.update(o)}))},normal2urgent({state:t},{queueKey:n,note:r}){const i=e({},t.normal_queue[n]);i.note=r,Es.child(n).remove().then((()=>{Ss.push(i)}))},urgentEdit(e,{queueKey:t,note:n}){Ss.child(t).update({note:n})},sendNextQueue({state:e},t){const n=Object.keys(e.urgent_queue);let r,i;if(0===n.length){const t=Object.keys(e.normal_queue);if(0===t.length)return console.warn("已經沒有任何點播了~~"),void ks.set(null);r=t[0],i="normal"}else r=n[0],i="urgent";gs.queue(`spotify:track:${e[`${i}_queue`][r].id}`,(n=>{if(n&&console.log(n),!n){const n=e[`${i}_queue`][r];let o;o="urgent"===i?Ss:Es,o.child(r).remove().then((()=>{ks.set(n)})),t&&t()}}))},clearPendingQueue(){ks.set(null)}}};let Ns;const Ds={};const xs={computed:{logs(){return this.$store.getters.userLog}}},Rs={class:"log-container"},As={key:0},Os={key:1},Ls={key:2},Ms=h("把"),Fs={key:3},js=h("調高音量至:"),qs={key:4},Us={key:5},Qs=h("將最小撥放音量調整為"),Vs={key:6},Ws=h("將最小投票數調整為"),Hs={key:0},Bs=i("p",null,"- - No logs - -",-1);xs.render=function(e,t,o,a,p,d){return n(),r("ul",Rs,[(n(!0),r(s,null,u(d.logs,(e=>(n(),r("li",{key:e.timestemp},["add"===e.action_type||"jumpIn"===e.action_type?(n(),r("p",As,[i("span",null,c(e.user_name),1),h(c("add"===e.action_type?"點":"插")+"播了",1),i("span",null,c(e.option.track_name),1)])):"normalRemove"===e.action_type||"urgentRemove"===e.action_type?(n(),r("p",Os,[i("span",null,c(e.user_name),1),h("從"+c("normalRemove"===e.action_type?"點":"插")+"播序列移除了",1),i("span",null,c(e.option.track_name),1)])):"normal2urgent"===e.action_type||"urgent2normal"===e.action_type?(n(),r("p",Ls,[i("span",null,c(e.user_name),1),Ms,i("span",null,c(e.option.track_name),1),h("移到"+c("normal2urgent"===e.action_type?"點":"插")+"播序列 ",1)])):"turnUp"===e.action_type||"turnDown"===e.action_type?(n(),r("p",Fs,[i("span",null,c(e.user_name),1),js,i("span",null,c(e.option.volume),1)])):"increaseDislike"===e.action_type||"reduceDislike"===e.action_type?(n(),r("p",qs,"更新切歌投票數")):"updateMinimalVolume"===e.action_type?(n(),r("p",Us,[i("span",null,c(e.user_name),1),Qs,i("span",null,c(e.option.minimal_volume),1)])):"updateDislikeThreshold"===e.action_type?(n(),r("p",Vs,[i("span",null,c(e.user_name),1),Ws,i("span",null,c(e.option.dislike_threshold),1)])):l("",!0)])))),128)),0===d.logs.length?(n(),r("li",Hs,[Bs])):l("",!0)])};var $s="/Space-Radio/assets/vinyl-record.4e26eea2.png";const Ks={components:{UserLog:xs,HostControl:p((()=>function(e,t){if(!t)return e();if(void 0===Ns){const e=document.createElement("link").relList;Ns=e&&e.supports&&e.supports("modulepreload")?"modulepreload":"preload"}return Promise.all(t.map((e=>{if(e in Ds)return;Ds[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const r=document.createElement("link");return r.rel=t?"stylesheet":Ns,t||(r.as="script",r.crossOrigin=""),r.href=e,document.head.appendChild(r),t?new Promise(((e,t)=>{r.addEventListener("load",e),r.addEventListener("error",t)})):void 0}))).then((()=>e()))}((()=>__import__("./HostControl.32297268.js")),["/Space-Radio/assets/HostControl.32297268.js","/Space-Radio/assets/HostControl.936ca028.css","/Space-Radio/assets/vendor.074003e4.js"])))},data:()=>({logo:$s,userPlaylists:[],selectedPlaylistKey:null,isTrackSaved:!1}),computed:e(e({hostToggler(){return this.userId===this.hostId}},H({isVoted:e=>e.PlayingState.isVoted})),B(["playerPlayingAlbum","playerPlayingArtists","playerPlayingTrackId","playerPlayingTrackName","currentVolume","currentDislike","currentDislikeThreshold","currentDislikeCountdown","userId","hostId","roomName"])),watch:{playerPlayingTrackId(e){e&&this.checkSavedTrackState(e)}},beforeCreate(){this.$spotifyAPI.getUserPlaylists(this.userId,{limit:50}).then((e=>{this.userPlaylists=e.items,this.selectedPlaylistKey=localStorage.getItem("jukebox_previous_playlise_key")||this.userPlaylists[0].id}))},methods:{turnUp(){this.$store.dispatch("turnUp")},turnDown(){this.$store.dispatch("turnDown")},increaseDislike(){this.$store.dispatch("increaseDislike")},reduceDislike(){this.$store.dispatch("reduceDislike")},collectHandler(){console.log(),this.$spotifyAPI.addTracksToPlaylist(this.selectedPlaylistKey,[`spotify:track:${this.playerPlayingTrackId}`]).then((e=>{console.log(e),localStorage.setItem("jukebox_previous_playlise_key",this.selectedPlaylistKey)}))},add2savedHandler(){this.$spotifyAPI.addToMySavedTracks([this.playerPlayingTrackId]).then((()=>{this.checkSavedTrackState(this.playerPlayingTrackId)}))},removeFromSavedHandler(){this.$spotifyAPI.removeFromMySavedTracks([this.playerPlayingTrackId]).then((()=>{this.checkSavedTrackState(this.playerPlayingTrackId)}))},checkSavedTrackState(e){this.$spotifyAPI.containsMySavedTracks([e]).then((e=>{this.isTrackSaved=e[0]}))}}},zs={class:"playing-state"},Gs=i("img",{src:$s,alt:""},null,-1),Ys={class:"track-info"},Js={class:"cover"},Xs={class:"description"},Zs={class:"track-name"},eu={class:"artists"},tu={class:"album"},nu={class:"control-board"},ru={class:"volumn-control"},iu=i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",class:"bi bi-volume-down",viewBox:"0 0 16 16"},[i("path",{d:"M9 4a.5.5 0 0 0-.812-.39L5.825 5.5H3.5A.5.5 0 0 0 3 6v4a.5.5 0 0 0 .5.5h2.325l2.363 1.89A.5.5 0 0 0 9 12V4zM6.312 6.39L8 5.04v5.92L6.312 9.61A.5.5 0 0 0 6 9.5H4v-3h2a.5.5 0 0 0 .312-.11zM12.025 8a4.486 4.486 0 0 1-1.318 3.182L10 10.475A3.489 3.489 0 0 0 11.025 8 3.49 3.49 0 0 0 10 5.525l.707-.707A4.486 4.486 0 0 1 12.025 8z"})],-1),ou={class:"progress"},au={class:"bar"},su={class:"buttons"},uu={class:"terminate-control"},lu={key:0},cu={class:"sign"},hu={class:"currentDislike"},pu={class:"buttons"},du={class:"collect"},fu=i("label",{for:"playlist"},"收集到播放清單:",-1),yu={class:"buttons"},mu={xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",class:"bi bi-heart",viewBox:"0 0 16 16"},vu=i("path",{d:"M8 2.748l-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.92 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.01L8 2.748zM8 15C-7.333 4.868 3.279-3.04 7.824 1.143c.06.055.119.112.176.171a3.12 3.12 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15z"},null,-1),gu={xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",class:"bi bi-heart-fill",viewBox:"0 0 16 16"},_u=i("path",{"fill-rule":"evenodd",d:"M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z"},null,-1),bu=i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",class:"bi bi-save",viewBox:"0 0 16 16"},[i("path",{d:"M2 1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H9.5a1 1 0 0 0-1 1v7.293l2.646-2.647a.5.5 0 0 1 .708.708l-3.5 3.5a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L7.5 9.293V2a2 2 0 0 1 2-2H14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h2.5a.5.5 0 0 1 0 1H2z"})],-1),wu={class:"log"};Ks.render=function(e,o,a,h,p,m){const v=t("UserLog"),g=t("HostControl");return n(),r("div",zs,[i("h1",null,[Gs,i("p",null,c(e.roomName),1)]),i("div",Ys,[i("div",Js,[i("img",{src:e.playerPlayingAlbum.image_url?e.playerPlayingAlbum.image_url:p.logo,alt:""},null,8,["src"])]),i("section",Xs,[i("p",Zs,[i("span",null,c(e.playerPlayingTrackName),1)]),i("p",eu,[(n(!0),r(s,null,u(e.playerPlayingArtists,((e,t)=>(n(),r("a",{key:t,target:"_blank",href:e.url},c(e.name),9,["href"])))),128))]),i("p",tu,[i("a",{target:"_blank",href:e.playerPlayingAlbum.url},c(e.playerPlayingAlbum.name),9,["href"])])])]),i("div",nu,[i("div",ru,[iu,i("div",ou,[i("div",au,[i("p",{style:{width:`${e.currentVolume}%`}},null,4)])]),i("p",null,c(e.currentVolume),1),i("div",su,[i("button",{type:"button",onClick:o[1]||(o[1]=(...e)=>m.turnDown&&m.turnDown(...e))},"-"),i("button",{type:"button",onClick:o[2]||(o[2]=(...e)=>m.turnUp&&m.turnUp(...e))},"+")])]),i("div",uu,[e.currentDislikeCountdown?(n(),r("p",lu,"將於 "+c(e.currentDislikeCountdown)+" 秒後跳過目前歌曲",1)):(n(),r(s,{key:1},[i("div",cu,[(n(!0),r(s,null,u(e.currentDislikeThreshold,((t,i)=>(n(),r("span",{key:t,class:{active:e.currentDislike>i}},null,2)))),128))]),i("p",hu,c(e.currentDislike),1)],64)),i("div",pu,[d(i("button",{type:"button",onClick:o[3]||(o[3]=(...e)=>m.increaseDislike&&m.increaseDislike(...e))},"Terminate",512),[[f,!e.isVoted]]),d(i("button",{type:"button",onClick:o[4]||(o[4]=(...e)=>m.reduceDislike&&m.reduceDislike(...e))},"Cancel",512),[[f,e.isVoted]])])]),i("div",du,[i("form",null,[fu,d(i("select",{id:"playlist","onUpdate:modelValue":o[5]||(o[5]=e=>p.selectedPlaylistKey=e)},[(n(!0),r(s,null,u(p.userPlaylists,((e,t)=>(n(),r("option",{key:e.id,value:e.id,selected:0===t,label:e.name,class:{selected:e.id===p.selectedPlaylistKey}},null,10,["value","selected","label"])))),128))],512),[[y,p.selectedPlaylistKey]])]),i("div",yu,[i("button",{disabled:!e.playerPlayingTrackId,type:"button",class:"heart-button",onClick:o[6]||(o[6]=e=>(!p.isTrackSaved&&m.add2savedHandler(e),p.isTrackSaved&&m.removeFromSavedHandler(e)))},[d((n(),r("svg",mu,[vu],512)),[[f,!p.isTrackSaved]]),d((n(),r("svg",gu,[_u],512)),[[f,p.isTrackSaved]])],8,["disabled"]),i("button",{disabled:!e.playerPlayingTrackId,type:"button",class:"collect-button",onClick:o[7]||(o[7]=(...e)=>m.collectHandler&&m.collectHandler(...e))},[bu],8,["disabled"])])])]),i("div",wu,[i(v)]),m.hostToggler?(n(),r(g,{key:0})):l("",!0)])};const Cu={emits:["triggerAdditionDisplay","triggerSearchStyle","updateAdditionDisplaySource"],data:()=>({searchText:"",searchResult:[],trigger:!1}),methods:{searchHandler(){if(console.log(this.trigger),this.$emit("triggerAdditionDisplay",!0),this.$emit("updateAdditionDisplaySource",this.searchResult),this.trigger){if(""===this.searchText)return;this.$spotifyAPI.search(this.searchText,["track"],{market:"from_token",limit:50},((e,t)=>{e&&console.log(e.response),this.searchResult=t.tracks.items,t&&this.$emit("updateAdditionDisplaySource",this.searchResult)}))}else this.trigger=!0,this.$emit("triggerSearchStyle",this.trigger)},clearSearch(){this.trigger=!1,this.searchText="",this.$emit("triggerSearchStyle",!1),this.$emit("triggerAdditionDisplay",!1)}}},Tu={class:"search"},Su=i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",class:"bi bi-search",viewBox:"0 0 16 16"},[i("path",{d:"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"})],-1),Eu=i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",class:"bi bi-x-circle",viewBox:"0 0 16 16"},[i("path",{d:"M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"}),i("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"})],-1);Cu.render=function(e,t,o,a,s,u){return n(),r("div",Tu,[d(i("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>s.searchText=e),type:"text",autocomplete:"off",onKeydown:t[2]||(t[2]=v(g(((...e)=>u.searchHandler&&u.searchHandler(...e)),["prevent"]),["enter"]))},null,544),[[m,s.searchText]]),i("button",{class:"submit-search-botton",type:"button",onClick:t[3]||(t[3]=(...e)=>u.searchHandler&&u.searchHandler(...e))},[Su]),i("button",{class:"cancel-search-button",type:"button",onClick:t[4]||(t[4]=(...e)=>u.clearSearch&&u.clearSearch(...e))},[Eu])])};const ku=(e,t)=>{if(!e)return"Share you like, enjoy your life.";const{sender:n,recipient:r,message:i}=e;return`${n||Cs.getters.userName} 點播了一首 ${t} 給 ${r||"所有人"}, ${i}`};const Iu={props:{queueKey:{type:String,default:""},trackNameForLog:{type:String,required:!0},submitFunction:{type:Function,required:!0}},emits:["finish"],data:()=>({currentNote:{sender:"",recipient:"",message:""}}),computed:{output(){return ku(this.currentNote,this.trackNameForLog)}},created(){if(""!==this.queueKey&&Object.prototype.hasOwnProperty.call(this.$store.state.Queue.urgent_queue,this.queueKey)){const t=this.$store.state.Queue.urgent_queue[this.queueKey].note;if(t)this.currentNote=e({},t);else{const e=localStorage.getItem("jukebox_senderName");this.currentNote.sender=e||this.$store.getters.userName}}},beforeUnmount(){0!==this.currentNote.sender.length&&localStorage.setItem("jukebox_senderName",this.currentNote.sender)},methods:{submitHandler(){const{sender:e,recipient:t,message:n}=this.currentNote;this.submitFunction({sender:e||this.$store.getters.userName,recipient:t,message:n}),this.$emit("finish")}}},Pu=i("span",{class:"mask dialog"},null,-1),Nu={class:"dialog"},Du=i("p",{class:"dialog-header"},"Write your message.",-1),xu={class:"dialog-body"},Ru=h("插播一首"),Au={class:"track-name"},Ou=h("給"),Lu=h("，"),Mu=i("br",null,null,-1),Fu={class:"dialog-footer"},ju={class:"preview"};Iu.render=function(e,t,o,a,u,l){return n(),r(s,null,[Pu,i("div",Nu,[Du,i("div",xu,[d(i("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>u.currentNote.sender=e),class:"sender",placeholder:e.$store.getters.userName},null,8,["placeholder"]),[[m,u.currentNote.sender]]),Ru,i("span",Au,c(o.trackNameForLog),1),Ou,d(i("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>u.currentNote.recipient=e),class:"recipient",type:"text",placeholder:"everyone"},null,512),[[m,u.currentNote.recipient]]),Lu,Mu,d(i("textarea",{"onUpdate:modelValue":t[3]||(t[3]=e=>u.currentNote.message=e),class:"message",cols:"25",rows:"3",placeholder:"(Say something...)"},null,512),[[m,u.currentNote.message]])]),i("div",Fu,[i("button",{type:"button",onClick:t[4]||(t[4]=(...e)=>l.submitHandler&&l.submitHandler(...e))},"Submit"),i("button",{type:"button",onClick:t[5]||(t[5]=t=>e.$emit("finish"))},"Cancel")]),i("p",ju,c(l.output),1)])],64)};const qu={data:()=>({isFilled:!1}),computed:{latestQueue(){return this.$store.getters.latestQueue},messageOutput(){const e=this.latestQueue?this.latestQueue.track_name:null,t=!!this.latestQueue&&this.latestQueue.note;return ku(t,e)}},watch:{latestQueue(e){e&&(this.isFilled=!0)}},methods:{mouseenterHandler(e){const t=e.currentTarget;t.offsetWidth>t.parentElement.offsetWidth&&(this.isFilled=!0)}}},Uu={class:"marquee"},Qu={key:0};qu.render=function(e,t,o,a,s,u){return n(),r("div",Uu,[i("div",{class:["container",{"active-marquee":s.isFilled}]},[i("p",{onAnimationend:t[2]||(t[2]=e=>s.isFilled=!1)},[i("span",{onMouseenter:t[1]||(t[1]=(...e)=>u.mouseenterHandler&&u.mouseenterHandler(...e))},c(u.messageOutput),33),s.isFilled?(n(),r("span",Qu,c(u.messageOutput),1)):l("",!0)],32)],2)])};const Vu={props:{info:{type:Object,required:!0,default:()=>({name:"",album:{images:[{url:$s}],release_date:"",name:"",external_urls:{spotify:"##"}},duration_ms:123,external_urls:{spotify:"##"},artists:[{external_urls:{spotify:"##"},name:""}]})},isUrgent:{type:Boolean,default:!1},isPending:{type:Boolean,default:!1}},computed:{coverUrl(){const e=this.info.album.images,t=e[e.length-1];return t?t.url:null},release(){return this.info.album.release_date.slice(0,-3)},durationTime(){return`${Math.floor(this.info.duration_ms/6e4)}:${Math.floor(this.info.duration_ms%6e4/1e3)}`}}},Wu={class:"name"},Hu={class:"artist"};Vu.render=function(e,t,o,a,l,h){return n(),r(s,null,[i("div",{class:["track-cover",{urgent:o.isUrgent,pending:o.isPending}]},[i("img",{src:h.coverUrl,alt:""},null,8,["src"])],2),i("div",{class:["track-name-artist",{urgent:o.isUrgent,pending:o.isPending}]},[i("p",Wu,[i("a",{href:o.info.external_urls.spotify,target:"_blank"},c(o.info.name),9,["href"])]),i("p",Hu,[(n(!0),r(s,null,u(o.info.artists,(e=>(n(),r("a",{key:e.name,href:e.external_urls.spotify,target:"_blank"},c(e.name),9,["href"])))),128))])],2),i("div",{class:["track-album",{urgent:o.isUrgent,pending:o.isPending}]},[i("p",null,[i("a",{href:o.info.album.external_urls.spotify,target:"_blank"},c(o.info.album.name),9,["href"])])],2),i("div",{class:["track-time-data",{urgent:o.isUrgent,pending:o.isPending}]},[i("p",null,c(h.durationTime),1),i("p",null,c(h.release),1)],2),i("div",{class:["track-feature",{urgent:o.isUrgent,pending:o.isPending}]},[_(e.$slots,"default")],2)],64)};const Bu={},$u={class:"track-table"},Ku=b('<div class="table-header track-cover">Cover</div><div class="table-header track-name-artist"><p>Track</p><p>Artists</p></div><div class="table-header track-album">Album</div><div class="table-header track-time-data"><p>Duration Time</p><p>Release Time</p></div><div class="table-header track-feature">Feature</div>',5);Bu.render=function(e,t){return n(),r(s,null,[_(e.$slots,"header"),i("div",$u,[Ku,_(e.$slots,"body")])],64)};const zu={props:{trackId:{type:String,required:!0},trackName:{type:String,required:!0}},methods:{addHandler(){this.$store.dispatch("add",{id:this.trackId,note:!1,trackNameForLog:this.trackName})}}},Gu=i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",class:"bi bi-plus",viewBox:"0 0 16 16"},[i("path",{d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"})],-1);zu.render=function(e,t,i,o,a,s){return n(),r("button",{type:"button",onClick:t[1]||(t[1]=(...e)=>s.addHandler&&s.addHandler(...e))},[Gu])};const Yu={props:{trackId:{type:String,required:!0},trackName:{type:String,required:!0}},emits:["activeNoteDialog"],methods:{jumpInHandler(){this.$emit("activeNoteDialog",{trackNameForLog:this.trackName,submitFunction:e=>{this.$store.dispatch("jumpIn",{id:this.trackId,note:e,trackNameForLog:this.trackName})}})}}},Ju=i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",class:"bi bi-arrow-up",viewBox:"0 0 16 16"},[i("path",{"fill-rule":"evenodd",d:"M8 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L7.5 2.707V14.5a.5.5 0 0 0 .5.5z"})],-1);Yu.render=function(e,t,i,o,a,s){return n(),r("button",{type:"button",onClick:t[1]||(t[1]=(...e)=>s.jumpInHandler&&s.jumpInHandler(...e))},[Ju])};const Xu={components:{AddButton:zu,JumpInButton:Yu,TrackGridItem:Vu,TrackGridShell:Bu},inheritAttrs:!1,props:{displayActive:{type:Boolean,default:!1},source:{type:Array,default:()=>[]}},emits:["disactiveSearchStyle"]},Zu={class:"display-block"},el={class:"container"};Xu.render=function(e,o,a,l,c,h){const p=t("AddButton"),d=t("JumpInButton"),f=t("TrackGridItem"),y=t("TrackGridShell");return n(),r(C,{name:"addition-display"},{default:w((()=>[i("div",Zu,[i("div",el,[0===a.source.length?(n(),r("p",{key:0,class:"no-result",onClick:o[1]||(o[1]=t=>e.$emit("disactiveSearchStyle"))},"No result")):(n(),r(y,{key:1},{body:w((()=>[(n(!0),r(s,null,u(a.source,((t,o)=>(n(),r(f,{key:t.id+o,info:t},{default:w((()=>[i(p,{"track-id":t.id,"track-name":t.name},null,8,["track-id","track-name"]),i(d,T({"track-id":t.id,"track-name":t.name},e.$attrs),null,16,["track-id","track-name"])])),_:2},1032,["info"])))),128))])),_:1}))])])])),_:1})};const tl={emits:["triggerAdditionDisplay","updateAdditionDisplaySource"],data:()=>({recentData:[]}),methods:{fetchDataHandler(){this.$spotifyAPI.getMyRecentlyPlayedTracks({limit:50}).then((e=>{e.error||(this.recentData=e.items.map((e=>e.track)),this.$emit("updateAdditionDisplaySource",this.recentData),this.$emit("triggerAdditionDisplay"))}))}}},nl=i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",class:"bi bi-music-note-list",viewBox:"0 0 16 16"},[i("path",{d:"M12 13c0 1.105-1.12 2-2.5 2S7 14.105 7 13s1.12-2 2.5-2 2.5.895 2.5 2z"}),i("path",{"fill-rule":"evenodd",d:"M12 3v10h-1V3h1z"}),i("path",{d:"M11 2.82a1 1 0 0 1 .804-.98l3-.6A1 1 0 0 1 16 2.22V4l-5 1V2.82z"}),i("path",{"fill-rule":"evenodd",d:"M0 11.5a.5.5 0 0 1 .5-.5H4a.5.5 0 0 1 0 1H.5a.5.5 0 0 1-.5-.5zm0-4A.5.5 0 0 1 .5 7H8a.5.5 0 0 1 0 1H.5a.5.5 0 0 1-.5-.5zm0-4A.5.5 0 0 1 .5 3H8a.5.5 0 0 1 0 1H.5a.5.5 0 0 1-.5-.5z"})],-1);tl.render=function(e,t,i,o,a,s){return n(),r("button",{type:"button",class:"list-toggler",onClick:t[1]||(t[1]=(...e)=>s.fetchDataHandler&&s.fetchDataHandler(...e))},[nl])};const rl={components:{TrackGridItem:Vu,TrackGridShell:Bu},emits:["activeNoteDialog"],computed:e({},B(["trackData","normalQueue","urgentQueue","pendingQueue","userId"])),methods:{remove(e,t){this.$store.dispatch(`${t}Remove`,{queueKey:e,id:this.trackData[e].id,trackNameForLog:this.trackData[e].name})},editNote(e){const t=this.trackData[e].name;this.$emit("activeNoteDialog",{queueKey:e,trackNameForLog:t,submitFunction:t=>{this.$store.dispatch("urgentEdit",{queueKey:e,note:t})}})},urgent2normal(e){this.$store.dispatch("urgent2normal",{queueKey:e,id:this.trackData[e].id,trackNameForLog:this.trackData[e].name})},normal2urgent(e){const t=this.trackData[e].name;this.$emit("activeNoteDialog",{queueKey:e,trackNameForLog:t,submitFunction:n=>{this.$store.dispatch("normal2urgent",{queueKey:e,note:n,id:this.trackData[e].id,trackNameForLog:t})}})}}},il={class:"room-queue"},ol=i("h2",null,"Next On",-1),al=i("p",{class:"pending"},"pending...",-1),sl=i("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-x",viewBox:"0 0 16 16"},[i("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"})],-1),ul=i("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-chevron-double-down",viewBox:"0 0 16 16"},[i("path",{"fill-rule":"evenodd",d:"M1.646 6.646a.5.5 0 0 1 .708 0L8 12.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"}),i("path",{"fill-rule":"evenodd",d:"M1.646 2.646a.5.5 0 0 1 .708 0L8 8.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"})],-1),ll=i("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-pencil",viewBox:"0 0 16 16"},[i("path",{d:"M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5L13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175l-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"})],-1),cl=i("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-x",viewBox:"0 0 16 16"},[i("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"})],-1),hl=i("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-chevron-double-up",viewBox:"0 0 16 16"},[i("path",{"fill-rule":"evenodd",d:"M7.646 2.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 3.707 2.354 9.354a.5.5 0 1 1-.708-.708l6-6z"}),i("path",{"fill-rule":"evenodd",d:"M7.646 6.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 7.707l-5.646 5.647a.5.5 0 0 1-.708-.708l6-6z"})],-1);rl.render=function(e,o,a,c,h,p){const d=t("TrackGridItem"),f=t("TrackGridShell");return n(),r("div",il,[i(f,null,{header:w((()=>[ol])),body:w((()=>[e.pendingQueue?(n(),r(d,{key:0,info:e.trackData.pending,"is-pending":!0},{default:w((()=>[al])),_:1},8,["info"])):l("",!0),(n(!0),r(s,null,u(Object.keys(e.urgentQueue),(t=>(n(),r(d,{key:t,info:e.trackData[t],"is-urgent":!0},{default:w((()=>[e.userId===e.urgentQueue[t].added_by?(n(),r(s,{key:0},[i("button",{class:"remove-button",type:"button",onClick:e=>p.remove(t,"urgent")},[sl],8,["onClick"]),i("button",{class:"urgent2normal-button",type:"button",onClick:e=>p.urgent2normal(t)},[ul],8,["onClick"]),i("button",{class:"edit-button",type:"button",onClick:e=>p.editNote(t)},[ll],8,["onClick"])],64)):l("",!0)])),_:2},1032,["info"])))),128)),(n(!0),r(s,null,u(Object.keys(e.normalQueue),(t=>(n(),r(d,{key:t,info:e.trackData[t]},{default:w((()=>[e.userId===e.normalQueue[t].added_by?(n(),r(s,{key:0},[i("button",{class:"remove-button",type:"button",onClick:e=>p.remove(t,"normal")},[cl],8,["onClick"]),i("button",{class:"normal2urgent-button",type:"button",onClick:e=>p.normal2urgent(t)},[hl],8,["onClick"])],64)):l("",!0)])),_:2},1032,["info"])))),128))])),_:1})])};const pl={components:{PlayingState:Ks,RoomQueue:rl,SearchBar:Cu,NoteDialog:Iu,Marquee:qu,AdditionDisplay:Xu,UserRecentPlayedButton:tl},data:()=>({isMainSide:!0,touchStartPosition:0,isNoteDialogActive:!1,editingNote:{queueKey:"",trackNameForLog:"",submitFunction:()=>{}},isSearchActive:!1,additionDisplayToggler:!1,additionDisplaySource:[]}),computed:{mobileMode:()=>window.innerWidth<768},beforeCreate(){this.$store.hasModule("Queue")||this.$store.registerModule("Queue",Ps),!this.$spotifyAPI.getAccessToken()&&this.$store.getters.isTokenValid&&this.$spotifyAPI.setAccessToken(this.$store.getters.token);const e=localStorage.getItem("jukebox_room_key");_t.database().ref(`${e}/basic`).get().then((e=>{this.$store.commit("setRoomBasicInfo",e.val())}))},mounted(){var t;t=this.$store,Is(Es,"normal",t),Is(Ss,"urgent",t),ks.on("value",(e=>{if(!e.val())return void t.commit("clearPendingQueue");const n=e.val().id;if(t.getters.previousDeleted&&t.getters.previousDeleted.id===n)return t.commit("refreshPendingTrack",t.getters.previousDeleted),t.commit("refreshPendingQueue",e.val()),void t.commit("clearPreviousDeleted");gs.getAccessToken()&&gs.getTrack(n).then((n=>{t.commit("refreshPendingTrack",n),t.commit("refreshPendingQueue",e.val())}))})),function(e){Za.child("volume").on("value",(t=>{e.commit("adjustVolume",t.val())})),Za.child("playing_track").on("value",(t=>{e.commit("refreshPlayerTrack",t.val())})),Za.child("latest_queue").on("value",(t=>{e.commit("refreshTheLatestQueue",t.val())})),Za.child("dislike").on("value",(t=>{e.commit("adjustDislike",t.val())})),Za.child("voted_users").on("value",(t=>{e.dispatch("adjustIsVoted",t)})),Za.child("minimal_volume").on("value",(t=>{e.commit("adjustMinimalVolume",t.val())})),Za.child("dislike_threshold").on("value",(t=>{e.commit("adjustDislikeThreshold",t.val())})),Za.child("dislike_countdown").on("value",(t=>{e.commit("adjustDislikeCountdown",t.val())}))}(this.$store),function(t){const n=function({type:e}){return{action_type:e,user_id:t.getters.userId,user_name:t.getters.userName,timestamp:Date.now()}};let r=null;t.subscribeAction({after:(t,i)=>{let o;switch(t.type){case"add":case"jumpIn":case"normalRemove":case"urgentRemove":case"normal2urgent":case"urgent2normal":{const{payload:{id:r,trackNameForLog:i}}=t;o=e(e({},n(t)),{option:{id:r,track_name:i}});break}case"turnUp":case"turnDown":return r&&clearTimeout(r),void(r=setTimeout((()=>{o=e(e({},n(t)),{option:{volume:i.PlayingState.volume}}),ws.push(o)}),3e3));case"reduceDislike":case"increaseDislike":o=e(e({},n(t)),{option:{id:i.PlayingState.playing_track.id}});break;case"updateMinimalVolume":o=e(e({},n(t)),{option:{minimal_volume:i.PlayingState.minimal_volume}});break;case"updateDislikeThreshold":o=e(e({},n(t)),{option:{dislike_threshold:i.PlayingState.dislike_threshold}});break;default:return}ws.push(o)}}),ws.limitToLast(3).on("child_added",(e=>{t.commit("pushUserLog",e.val())}))}(this.$store)},methods:{activeNoteDialogHandler(t){this.editingNote=e({},t),this.isNoteDialogActive=!0},dialogFinishHandler(){this.isNoteDialogActive=!1,this.editingNote={queueKey:"",trackNameForLog:"",submitFunction:()=>{}}},sliderToggler(e){switch(e){case"slide2right":this.$refs.slideContainer.style.transform="",this.isMainSide=!0;break;case"slide2left":this.$refs.slideContainer.style.transform=`translate(-${window.innerWidth}px, 0)`,this.isMainSide=!1;break;case"resume":this.isMainSide?this.$refs.slideContainer.style.transform="":this.$refs.slideContainer.style.transform=`translate(-${window.innerWidth}px, 0)`;break;default:console.log("something wrong")}},touchstartHandler(e){this.touchStartPosition=e.touches[0].clientX},touchendHandler(e){const t=this.touchStartPosition-e.changedTouches[0].clientX;Math.abs(t)<30||(t>70?this.sliderToggler("slide2left"):t<70?this.sliderToggler("slide2right"):this.sliderToggler("resume"))},touchmoveHandler(e){const t=e.touches[0].clientX-this.touchStartPosition;if(!(Math.abs(t)<30))if(this.isMainSide){if(t>50)return;this.$refs.slideContainer.style.transform=`translate(${t}px, 0)`}else{if(t<-50)return;this.$refs.slideContainer.style.transform=`translate(${-window.innerWidth+t}px, 0)`}}}},dl=i("img",{src:$s,alt:""},null,-1),fl={class:"user-name"},yl=i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",class:"bi bi-person-fill",viewBox:"0 0 16 16"},[i("path",{d:"M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"})],-1),ml={ref:"slideContainer",class:"slide-container"},vl={class:"sidebar slide-items"},gl={class:"view slide-items"},_l={class:"slide-navigation"};pl.render=function(e,o,a,s,u,h){const p=t("Marquee"),y=t("AdditionDisplay"),m=t("SearchBar"),v=t("UserRecentPlayedButton"),g=t("PlayingState"),_=t("RoomQueue"),b=t("NoteDialog");return n(),r("div",{class:"room",onTouchstart:o[10]||(o[10]=(...e)=>h.touchstartHandler&&h.touchstartHandler(...e)),onTouchmove:o[11]||(o[11]=(...e)=>h.touchmoveHandler&&h.touchmoveHandler(...e)),onTouchend:o[12]||(o[12]=(...e)=>h.touchendHandler&&h.touchendHandler(...e))},[i("header",{class:{"active-search":u.isSearchActive}},[i(p),i("nav",null,[h.mobileMode?d((n(),r(y,{key:0,source:u.additionDisplaySource,onActiveNoteDialog:h.activeNoteDialogHandler,onDisactiveSearchStyle:o[1]||(o[1]=e=>u.isSearchActive=!1)},null,8,["source","onActiveNoteDialog"])),[[f,u.additionDisplayToggler]]):l("",!0),i(m,{onTriggerSearchStyle:o[2]||(o[2]=e=>u.isSearchActive=e),onTriggerAdditionDisplay:o[3]||(o[3]=e=>u.additionDisplayToggler=e),onUpdateAdditionDisplaySource:o[4]||(o[4]=e=>u.additionDisplaySource=e)}),i("h1",null,[dl,i("p",null,c(e.$store.getters.roomName),1)]),i("ul",null,[i("li",null,[i(v,{onTriggerAdditionDisplay:o[5]||(o[5]=e=>u.additionDisplayToggler=!u.additionDisplayToggler),onUpdateAdditionDisplaySource:o[6]||(o[6]=e=>u.additionDisplaySource=e)})]),i("li",fl,[i("p",null,[yl,i("span",null,c(e.$store.getters.userName),1)])])])])],2),i("div",ml,[i("div",vl,[i(g)]),i("div",gl,[i(_,{onActiveNoteDialog:h.activeNoteDialogHandler},null,8,["onActiveNoteDialog"]),h.mobileMode?l("",!0):d((n(),r(y,{key:0,source:u.additionDisplaySource,onActiveNoteDialog:h.activeNoteDialogHandler,onDisactiveSearchStyle:o[7]||(o[7]=e=>u.isSearchActive=!1)},null,8,["source","onActiveNoteDialog"])),[[f,u.additionDisplayToggler]])])],512),u.isNoteDialogActive?(n(),r(b,T({key:0},u.editingNote,{onFinish:h.dialogFinishHandler}),null,16,["onFinish"])):l("",!0),i("div",_l,[i("span",{class:["sidebar-navigation",{active:u.isMainSide}],onClick:o[8]||(o[8]=e=>h.sliderToggler("slide2right"))},null,2),i("span",{class:["view-navigation",{active:!u.isMainSide}],onClick:o[9]||(o[9]=e=>h.sliderToggler("slide2left"))},null,2)])],32)};const bl={components:{UserLog:xs},data:()=>({logo:$s,targetRoomName:"",roomListObject:{},searchKeyWordInput:""}),computed:e({},B(["playerPlayingAlbum","playerPlayingArtists","playerPlayingTrackName"])),beforeCreate(){const e=this.$route.params.roomKey;_t.database().ref("room_list").get().then((t=>{if(this.roomListObject=t.val(),e){Object.prototype.hasOwnProperty.call(this.roomListObject,e)?(this.fetchRoomBasicInfo(e),localStorage.setItem("jukebox_room_key",e)):this.$router.push({name:"Lobby"})}}))},methods:{PKCE:ss,async searchRoomKey(){let e;if(Object.prototype.hasOwnProperty.call(this.roomListObject,this.searchKeyWordInput))e=this.searchKeyWordInput;else for(let t in this.roomListObject)if(this.roomListObject[t]===this.searchKeyWordInput){e=t;break}return e?(localStorage.setItem("jukebox_room_key",e),this.fetchRoomBasicInfo(e),!0):(console.log("no result"),localStorage.setItem("jukebox_room_key",e),this.$store.commit("refreshPlayerTrack",null),this.targetRoomName="",!1)},async fetchRoomBasicInfo(e){const t=_t.database().ref(e);return await t.child("playing_state").get().then((e=>{const t=e.val().playing_track;this.$store.commit("refreshPlayerTrack",t)})).then((()=>t.child("basic/room_name").get().then((e=>{this.targetRoomName=e.val()}))))},loginHandler(){this.searchKeyWordInput?this.searchRoomKey().then((e=>{console.log(e),e&&setTimeout((()=>{ss("#room")}),1500)})):this.$refs.roomInput.focus()}}},wl={class:"doorscope"},Cl=i("div",{class:"title"},[i("h1",null,"Jukebox")],-1),Tl={class:"content"},Sl={class:"cover-container"},El={class:"cover"},kl={class:"room-info"},Il={class:"room-name"},Pl=i("p",null,"Room name:",-1),Nl={class:"track-info"},Dl=i("h3",null,"Now playing",-1),xl=i("p",null,"Track Name:",-1),Rl=i("p",null,"Artists:",-1),Al=i("p",null,"Album:",-1),Ol={class:"log"},Ll={class:"feature"},Ml=i("p",null,"Please enter room key or room name",-1),Fl={class:"search-room"},jl=i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",class:"bi bi-search",viewBox:"0 0 16 16"},[i("path",{d:"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"})],-1),ql={class:"buttons"};bl.render=function(e,o,a,h,p,f){const y=t("UserLog");return n(),r("div",wl,[Cl,i("div",Tl,[i("div",Sl,[i("div",El,[i("img",{src:e.playerPlayingAlbum.image_url?e.playerPlayingAlbum.image_url:p.logo,alt:""},null,8,["src"])])]),i("div",kl,[i("div",Il,[Pl,i("h2",{class:{ignore:!p.targetRoomName}},c(p.targetRoomName?p.targetRoomName:"- - -"),3)]),i("div",Nl,[Dl,xl,i("p",null,c(e.playerPlayingTrackName),1),Rl,i("p",null,[(n(!0),r(s,null,u(e.playerPlayingArtists,((e,t)=>(n(),r("a",{key:t,target:"_blank",href:e.url},c(e.name),9,["href"])))),128))]),Al,i("p",null,[i("a",{target:"_blank",class:{"link-disable":""===e.playerPlayingAlbum.url},href:e.playerPlayingAlbum.url},c(e.playerPlayingAlbum.name),11,["href"])])]),i("div",Ol,[i(y)]),i("div",Ll,[Ml,i("div",Fl,[d(i("input",{ref:"roomInput","onUpdate:modelValue":o[1]||(o[1]=e=>p.searchKeyWordInput=e),type:"text",placeholder:"search room key or name",onKeydown:o[2]||(o[2]=v(g(((...e)=>f.searchRoomKey&&f.searchRoomKey(...e)),["prevent"]),["enter"]))},null,544),[[m,p.searchKeyWordInput]]),i("button",{type:"button",onClick:o[3]||(o[3]=(...e)=>f.searchRoomKey&&f.searchRoomKey(...e))},[jl])]),i("div",ql,[i("button",{class:"login-botton",type:"button",onClick:o[4]||(o[4]=(...e)=>f.loginHandler&&f.loginHandler(...e))},"Spotify Login"),e.$route.params.roomKey?l("",!0):(n(),r("button",{key:0,type:"button",onClick:o[5]||(o[5]=e=>f.PKCE("#create"))},"Create Room"))])])])])])};const Ul={data:()=>({roomKey:Array.from(window.crypto.getRandomValues(new Uint32Array(2)),(e=>e.toString(16))).join(""),roomName:"",volume:50,minimalVolume:10,dislikeThreshold:2,roomNameArray:[]}),computed:e(e({},B(["userId","userName"])),{hasSameRoomName(){return this.roomNameArray.includes(this.roomName)},errorMessage(){return this.hasSameRoomName?`already has room name: ${this.roomName}`:""===this.roomName&&"please enter your room name"}}),created(){_t.database().ref("room_list").on("value",this.roomListOnHandler)},methods:{roomListOnHandler(e){this.roomNameArray=Object.values(e.val())},createRoom(){_t.database().ref(this.roomKey).set({basic:{host_id:this.userId,room_name:this.roomName,room_key:this.roomKey},playing_state:{volume:this.volume,minimal_volume:this.minimalVolume,dislike_threshold:this.dislikeThreshold,dislike:0}}).then((()=>{const e=_t.database().ref("room_list");e.off("value",this.roomListOnHandler);const t={};t[this.roomKey]=this.roomName,e.update(t),localStorage.setItem("jukebox_room_key",this.roomKey),this.$router.push({name:"Room"})}))}}},Ql={class:"create-room"},Vl=i("h1",null,"Create Room",-1),Wl=i("label",null,"Host id : ",-1),Hl={style:{color:"var(--ignore)"}},Bl=i("label",null,"Room Key : ",-1),$l={style:{color:"var(--ignore)"}},Kl={class:"room-name"},zl=i("label",{for:"room-name"},"Room name : ",-1),Gl={for:"init-volume"},Yl=h("Initail volume : "),Jl={for:"minimal-volume"},Xl=h("Minimal volume : "),Zl={for:"dislike-threshold"},ec=h("Skip song threshold : ");Ul.render=function(e,t,o,a,s,u){return n(),r("div",Ql,[Vl,i("form",null,[i("p",null,[Wl,i("span",Hl,c(e.userId),1)]),i("p",null,[Bl,i("span",$l,c(s.roomKey),1)]),i("p",Kl,[zl,d(i("input",{id:"room-name","onUpdate:modelValue":t[1]||(t[1]=e=>s.roomName=e),type:"text",maxlength:"50",autocomplete:"off"},null,512),[[m,s.roomName,void 0,{trim:!0}]]),i("span",{class:[{active:u.errorMessage},"warnning"]},c(u.errorMessage),3)]),i("p",null,[i("label",Gl,[Yl,i("span",null,c(s.volume),1)]),d(i("input",{id:"init-volume","onUpdate:modelValue":t[2]||(t[2]=e=>s.volume=e),min:s.minimalVolume,max:"100",type:"range"},null,8,["min"]),[[m,s.volume]])]),i("p",null,[i("label",Jl,[Xl,i("span",null,c(s.minimalVolume),1)]),d(i("input",{id:"minimal-volume","onUpdate:modelValue":t[3]||(t[3]=e=>s.minimalVolume=e),min:"0",max:"100",type:"range"},null,512),[[m,s.minimalVolume]])]),i("p",null,[i("label",Zl,[ec,i("span",null,c(s.dislikeThreshold),1)]),d(i("input",{id:"dislike-threshold","onUpdate:modelValue":t[4]||(t[4]=e=>s.dislikeThreshold=e),min:"1",max:"5",type:"range"},null,512),[[m,s.dislikeThreshold]])]),i("button",{type:"button",class:"create-button",disabled:u.hasSameRoomName||0==s.roomName.length,onClick:t[5]||(t[5]=(...e)=>u.createRoom&&u.createRoom(...e))}," Create room ",8,["disabled"])])])};const tc=[{path:"/",name:"Lobby",meta:{requiresAuth:!1},component:bl},{path:"/doorscope/:roomKey",name:"Doorscope",meta:{requiresAuth:!1},component:bl},{path:"/room",name:"Room",component:pl,meta:{requiresAuth:!0},beforeEnter:()=>{const e=localStorage.getItem("jukebox_room_key");!function(e){Za=_t.database().ref(`${e}/playing_state`)}(e),function(e){ws=_t.database().ref(`user_log/${e}`)}(e),function(e){Ss=_t.database().ref(`${e}/urgent_queue`),Es=_t.database().ref(`${e}/normal_queue`),ks=_t.database().ref(`${e}/pending_queue`)}(e)}},{path:"/create",name:"Create",component:Ul,meta:{requiresAuth:!0}}],nc=S({history:E(),routes:tc});nc.beforeEach((async e=>{if(window.location.search.includes("?code=")){const[e,t]=window.location.href.slice(window.location.href.search(/(code=)[\w+]/)+5).split("#/");if(!e)return;window.history.replaceState(null,"","https://g100my.github.io/Jukebox/"),await async function(e,t){const n=localStorage.getItem("jukebox_code_verifier");localStorage.removeItem("jukebox_code_verifier");let r="client_id="+as;return r+="&grant_type=authorization_code",r+="&code="+e,r+="&redirect_uri=https://g100my.github.io/Jukebox/"+t,r+="&code_verifier="+n,fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:new Headers({"Content-Type":"application/x-www-form-urlencoded"}),body:r}).then((e=>{if(e.ok)return e.json();console.error("something wrong in fetchAccessToken",e)})).then((e=>{const{access_token:t,expires_in:n,refresh_token:r}=e,i=1e3*n+Date.now();Cs.commit("refreshToken",{access_token:t,expiredTime:i,refresh_token:r})}))}(e,"#"+t).then((()=>{gs.getMe().then((e=>{console.log(e),Cs.commit("updateUserData",e)}))}))}return window.location.search.includes("?error=")?{name:"Lobby"}:e.meta.requiresAuth&&!Cs.getters.isTokenValid?(console.log(Cs.getters.isTokenValid),{name:"Lobby"}):void 0})),k(I).use(nc).use(Cs).use(_s).mount("#app");export{ku as a,B as m,us as r};
